(function(globals){function __eval(e,t){"use strict";t&&t.route.params;return eval.call(window,e)}/*!
 * ClassJS v%VERSION%
 * Part of the Atma.js Project
 * http://atmajs.com/
 *
 * MIT license
 * http://opensource.org/licenses/MIT
 *
 * (c) 2012, %YEAR% Atma.js and other contributors
 */
!function(e,t){"use strict";function n(){return t(o,r)}var r,o="undefined"==typeof window||null==window.navigator?global:window;return r=e||o,"function"==typeof define&&define.amd?define(n):(n(),void("undefined"!=typeof module&&(module.exports=r.Class)))}(this,function(e,t){"use strict";function n(e){return"function"==typeof e}function r(e){return null!=e&&"object"==typeof e}function o(e){return null!=e&&"number"==typeof e.length&&"function"==typeof e.slice}function i(e){return"string"==typeof e}function l(e){return null==e?!1:"object"!=typeof e?!1:e.constructor===Object}function s(t){return void 0===t||t===e}function u(e,t){if(a(e))for(var n=0,r=e.length;r>n;n++)t(e[n],n);else t(e)}function a(e){return null!=e&&"object"==typeof e&&"number"==typeof e.length&&"function"==typeof e.splice}function c(e,t){return function(){return f(e,t,arguments)}}function f(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2]);case 4:return e.call(t,n[0],n[1],n[2],n[3]);case 5:return e.call(t,n[0],n[1],n[2],n[3],n[4])}return e.apply(t,n)}function h(e){return"function"==typeof e}function d(e){var t=m.call(arguments,1);return function(){return arguments.length>0&&(t=t.concat(m.call(arguments))),f(e,null,t)}}function p(){}function g(){}var m=Array.prototype.slice,v=Array.prototype.sort,y={ModelHost:null},b="__$class__";"function"!=typeof Array.isArray&&(Array.isArray=function(e){return e instanceof Array?!0:null==e||"object"!=typeof e?!1:void 0!==e.length&&"function"==typeof e.slice});var _,x,w,C,j,N;!function(){function t(e,t){if(null==t||"object"!=typeof t)return t;var n=this,o=n[e];return o[b]&&o.toJSON?r(o[b],t):t}function r(e,t){var n={};return n.json=t,n[b]=e,n}function o(e,t){var n;return null!=t&&"object"==typeof t&&t[b]&&(n=V(t[b]),"function"==typeof n?t=new n(t.json):console.error("<class:parse> Class was not registered",t[b])),t}function l(t,n){"function"==typeof t&&(t=t.prototype),null==n&&(n={});var r,o,i;for(o in t)if(i=t[o],r=null==i?null:typeof i,"function"!==r){var s=o.charCodeAt(0);if(!(95===s&&"_id"!==o||s>=65&&90>=s))if("object"!==r)n[o]=r;else{var u=i.constructor,a=u&&u.name;if("Object"!==a&&a&&e[a]===u){n[o]=a;continue}n[o]=l(i)}}return t.__proto__&&l(t.__proto__,n),n}_=function(e,t){M(y.ModelHost||V.Model,e,t)},x=function(e){return R(y.ModelHost||V.Model,e)},w=function(e,t){var r=i(e)?x(e):e;return!n(r)&&console.error("<class:patch> Not a Function",e),t.Base=r,r=V(t),i(e)&&_(e,r),r},C=function(e){return JSON.stringify(e,t)},j=function(e){return JSON.parse(e,o)},N=function(e){return l(e)}}();var k,O,S;!function(){function e(e,t){if(null!=t){"function"==typeof e&&(e=e.prototype),"function"==typeof t&&(t=t.prototype);var n,r;for(n in t)r=t[n],null!=r&&(e[n]=r)}}function t(e,t){var n;return n=e?function(t){var n=1===arguments.length&&c(t)?t:arguments;return f(e,this,n)}:p,function(){return this["super"]=n,f(t,this,arguments)}}function r(n,r,o,i,l){var a=i,c=i;if(a.constructor=n.prototype.constructor,null!=o&&(c[s]={},u(o,function(t){e(c[s],t)}),c=c[s]),null!=r&&(c[s]=r.prototype),null!=l)for(var f in l)a[f]=t(a[f],l[f]);n.prototype=a}function o(n,r,o,i,l){if(null!=r){var s=function(){};s.prototype=r.prototype,n.prototype=new s,n.prototype.constructor=n}if(null!=o&&u(o,function(t){delete t.constructor,e(n,t)}),null!=l){var a=n.prototype;for(var c in l)a[c]=t(a[c],l[c])}e(n,i)}function i(e){return n(e)?e.prototype:e}var s="__proto__",a=Object.prototype.toString,c=function(e){return"[object Arguments]"===a.call(e)};k=s in Object.prototype?r:o,O=function(e,t){if(null!=t)if(n(t))for(var r in t)t.hasOwnProperty(r)&&null==e[r]&&(e[r]=t[r]);else if(Array.isArray(t))for(var o=t.length,i=-1;++i<o;)O(e,t[i]);else if(t.Static){t=t.Static;for(var r in t)t.hasOwnProperty(r)&&null==e[r]&&(e[r]=t[r])}else;},S=function(e,t,n){var r,o;for(r in e)o=e[r],l(o)&&(null!=t&&l(t.prototype[r])&&I(o,t.prototype[r]),null!=n&&u(n,function(e){e=i(e),l(e[r])&&I(o,e[r])}))}}();var A,E,T="__$serialization";!function(){A=function(e){var t,n,r,o=this,i={};null==e&&(e=o[T]);var l;for(t in o)if(l=t,null!=e&&e.hasOwnProperty(t)&&(r=e[t],null!=r&&"object"==typeof r&&(r.key&&(l=r.key),r.hasOwnProperty("serialize")))){if(null==r.serialize)continue;i[l]=r.serialize(o[t])}else if(95!==t.charCodeAt(0)&&"Static"!==t&&"Validate"!==t&&(n=o[t],null!=n))if("_id"!==t){switch(typeof n){case"function":continue;case"object":var s=n.toJSON;if(null==s)break;if(s===A||s===E){i[l]=n.toJSON();continue}}i[l]=n}else i[l]=n;return null!=o._id&&(i._id=o._id),i},E=function(){for(var e,t=this,n=t.length,r=0,o=new Array(n);n>r;r++){if(e=t[r],null!=e&&"object"==typeof e){var i=e.toJSON;if(i===A||i===E){o[r]=e.toJSON();continue}if(null==i){o[r]=A.call(e);continue}}o[r]=e}return o}}();var D,R,M,I,P,L;!function(){D=function(e){n(e)&&(e=e.prototype);for(var t,r,o=1,i=arguments.length;i>o;o++){t=n(arguments[o])?arguments[o].prototype:arguments[o];for(r in t)if("Static"!==r||null==e.Static)e[r]=t[r];else for(r in t.Static)e.Static[r]=t.Static[r]}return e},R=function(e,t){for(var n=t.split("."),r=n.length,o=-1;++o<r;){if(null==e)return null;e=e[n[o]]}return e},M=function(e,t,n){for(var r,o=t.split("."),i=o.length,l=-1;++l<i-1;)r=o[l],null==e[r]&&(e[r]={}),e=e[r];e[o[l]]=n},I=function(e,t){for(var n in t)null==e[n]&&(e[n]=t[n]);return e},P=function(e,t){if(null==e&&(e={}),null==t)return e;var n,r;for(r in t)n=t[r],null!=n&&(e[r]=n);return e},function(){function e(e,n,r){var o,i,l;for(i in n){switch(i.charCodeAt(0)){case 63://! accept falsy value
if(l=e[i.substring(1)],!l)continue;if(o=t(l,n[i],r))return o+": "+i;continue;case 45:if(null!=e[i.substring(1)])return"Unexpected argument: "+i;continue}if(l=e[i],null==l)return"Argument expected: "+i;if(o=t(l,n[i],r),null!=o)return o+": "+i}}function t(t,n,r){if(null==n)return null;if("function"==typeof n){var o=n.call(r,t);if(null==o||o===!0)return;return o===!1?"Invalid argument":o}if(null==t)return"Expected argument is undefined";if("string"==typeof n)switch(n){case"string":return"string"!=typeof t||0===t.length?"String expected":null;case"number":return"number"!=typeof t?"Number expected":null;case"boolean":return"boolean"!=typeof t?"Boolean expected":null}if(n instanceof RegExp)return n.test(t)===!1?"Invalid argument":null;if(Array.isArray(n)){if(Array.isArray(t)===!1)return"Array expected";for(var o,i=-1,l=t.length;++i<l;)if(o=e(t[i],n[0]))return"Invalid item <"+i+"> "+o;return null}return typeof t!=typeof n?"Type missmatch":"object"==typeof t?e(t,n):null}L=function(t,n){return null==t?"Instance is undefined":(null==n&&(n=t.Validate),null!=n?e(t,n,t):void 0)}}()}();var $;!function(){function e(e,t,n){for(var r in t)n(R(e,r),t[r],r)}function t(e,t,n){for(var r in t)M(e,r,n(R(e,r),t[r],r))}function n(){var e=arguments;return function(t,n,r){for(var o,i=0,l=e.length;l>i;i++)if(o=e[i],o(t,n,r)===!1)return}}function r(e,t,n){return a(e)===!1?(console.warn("<patch> property is not an array",n),!1):void 0}function o(e,t){if(t.hasOwnProperty("$each"))for(var n=0,r=t.$each.length;r>n;n++)e.push(t.$each[n]);else e.push(t)}function i(e,t){e[t>0?"pop":"shift"]()}function l(e,t){return console.error("<patch> pull Not Implemented")}function s(e,t){return e+t}function u(e,t){return t}function c(){return void 0}var f=0,h=1,d={$push:[e,n(r,o)],$pop:[e,n(r,i)],$pull:[e,n(r,l)],$inc:[t,s],$set:[t,u],$unset:[t,c],$bit:[t,c]};$=function(e,t){for(var n in t){var r=d[n];r?r[f](e,t[n],r[h]):console.error("Unknown or not implemented patcher",n)}return e}}();var F={};(function(){!function(e){function t(){this._callbacks=[]}function n(e){function n(e){return function(){i+=1,o[e]=Array.prototype.slice.call(arguments),i===l&&r.done(o)}}var r=new t,o=[];if(!e||!e.length)return r.done(o),r;for(var i=0,l=e.length,s=0;l>s;s++)e[s].then(n(s));return r}function r(e,n){var o=new t;return 0===e.length?o.done.apply(o,n):e[0].apply(null,n).then(function(){e.splice(0,1),r(e,arguments).then(function(){o.done.apply(o,arguments)})}),o}function o(e){var t="";if("string"==typeof e)t=e;else{var n=encodeURIComponent;for(var r in e)e.hasOwnProperty(r)&&(t+="&"+n(r)+"="+n(e[r]))}return t}function i(){var e;if(window.XMLHttpRequest)e=new XMLHttpRequest;else if(window.ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){e=new ActiveXObject("Microsoft.XMLHTTP")}return e}function l(e,n,r,l){function s(){p.abort(),g.done(f,"",p)}var p,g=new t,m=l&&l["Content-Type"]||d.contentType;try{p=i()}catch(v){return g.done(c,""),g}if(r)if("GET"===e)n+="?"+o(r),r=null;else switch(m){case u:r=o(r);break;case a:try{r=JSON.stringify(r)}catch(y){return g.done(h,""),g}default:r=o(r)}p.open(e,n),r&&p.setRequestHeader("Content-Type",m);for(var b in l)l.hasOwnProperty(b)&&p.setRequestHeader(b,l[b]);var _=d.ajaxTimeout;if(_)var x=setTimeout(s,_);return p.onreadystatechange=function(){if(_&&clearTimeout(x),4===p.readyState){var e=!p.status||(p.status<200||p.status>=300)&&304!==p.status;g.done(e,p.responseText,p)}},p.send(r),g}function s(e){return function(t,n,r){return l(e,t,n,r)}}var u="application/x-www-form-urlencoded",a="application/json",c=1,f=2,h=3;t.prototype.then=function(e,n){var r;return this._isdone?r=e.apply(n,this.result):(r=new t,this._callbacks.push(function(){var t=e.apply(n,arguments);t&&"function"==typeof t.then&&t.then(r.done,r)})),r},t.prototype.done=function(){this.result=arguments,this._isdone=!0;for(var e=0;e<this._callbacks.length;e++)this._callbacks[e].apply(null,arguments);this._callbacks=[]};var d={Promise:t,join:n,chain:r,ajax:l,get:s("GET"),post:s("POST"),put:s("PUT"),del:s("DELETE"),patch:s("PATCH"),ENOXHR:c,ETIMEOUT:f,E_PREPAIR_DATA:h,ajaxTimeout:0,contentType:a};"function"==typeof define&&define.amd?define(function(){return d}):e.promise=d}(this)}).call(F),u(["get"],function(e){F[e]=function(t,n){this.promise[e](t).then(function(e,t,r){return e?void n.onError(e,t,r):void n.onSuccess(t)})}}),u(["del","post","put","patch"],function(e){F[e]=function(t,n,r){this.promise[e](t,n).then(function(e,t,n){r(e,t,n)})}});var U;!function(){U=function(t){if(this===V||null==this||this===e){var n=function(e){this[T]=P(this[T],t),U.call(this,e)};return n}null!=t&&(this.deserialize?this.deserialize(t):U.deserialize(this,t))},U.serialize=function(e){return n(e.toJSON)?e.toJSON():A.call(e,e[T])},U.deserialize=function(e,t){if(i(t))try{t=JSON.parse(t)}catch(l){return console.error("<json:deserialize>",t),e}if(o(t)&&n(e.push)){e.length=0;for(var s=0,u=t.length;u>s;s++)e.push(t[s]);return e}var a,c,f,h,d,p=e[T];if(null!=p){var g="__desAsKeys";if(a=p[g],null==a){a=p[g]={};for(f in p)"__desAsKeys"!==f&&p[f].hasOwnProperty("key")===!0&&(a[p[f].key]=f)}}for(f in t)h=t[f],c=f,e[c]=null!=p&&(d=p.hasOwnProperty(f)?p[f]:null,a[f]&&(c=a[f]),null!=d&&(r(d)&&(d=d.deserialize),i(d)&&(d=x(d)),n(d)))?h instanceof d?h:new d(h):h;return e}}();var H=function(){function e(e){this.route=r(e)}function t(e){var t=i.exec(e);return t?{optional:"?"===(t[2]||t[3]),parts:[t[1],t[4]]}:(t=l.exec(e))?{optional:"?"===t[3],parts:[t[1],t[4],t[5]]}:(console.error("Paths breadcrumbs should be matched by regexps"),{parts:[e]})}function n(e,n){for(var r=e.split(n),o=0,i=r.length;i>o;o++)r[o]=t(r[o]);return r}function r(e){var t=/[^\:\{]\?[^:]/.exec(e),r=null;return t&&(t=t.index+1,r=e.substring(t+1),e=e.substring(0,t)),{path:n(e,"/"),query:null==r?null:n(r,"&")}}function o(e,t,n){for(var r,o,i,l=[],s=0,u=e.length;u>s;s++)if(i=e[s],o=i.parts.slice(0),null!=o[1]){if(r=o[1],o[1]=t[r],null!=o[1])l.push(o.join(""));else if(!i.optional)return console.error("Object has no value, for not optional part - ",r),null}else l.push(o[0]);return l.join(n)}e.prototype={constructor:e,create:function(e){var t,n;return t=o(this.route.path,e,"/"),null==t?null:this.route.query&&(n=o(this.route.query,e,"&"),null==n)?null:t+(n?"?"+n:"")},hasAliases:function(e){for(var t,n=0,r=this.route.path.length;r>n;n++)if(t=this.route.path[n].parts[1],t&&null==e[t])return!1;return!0}};var i=/^([^:\?]*)(\??):(\??)([\w]+)$/,l=/^([^\{\?]*)(\{(\??)([\w]+)\})?([^\s]*)?$/;return e}();!function(){function e(e,t,n,r){return null==r?e:(null!=t?f(r,e,t):n.push(r),e)}function t(e){e._done=null,e._fail=null,e._always=null}function n(e,t,n){if(null!=e){for(var r,o=e.length,i=-1;++i<o;)r=e[i],r&&f(r,t,n);e.length=0}}g.prototype={_isAsync:!0,_done:null,_fail:null,_always:null,_resolved:null,_rejected:null,defer:function(){this._rejected=null,this._resolved=null},resolve:function(){var e=this._done,r=this._always;return this._resolved=arguments,t(this),n(e,this,arguments),n(r,this,[this]),this},reject:function(){var e=this._fail,r=this._always;return this._rejected=arguments,t(this),n(e,this,arguments),n(r,this,[this]),this},resolveDelegate:function(){return c(this.resolve,this)},rejectDelegate:function(){return c(this.reject,this)},then:function(e,t){return this.done(e).fail(t)},done:function(t){return e(this,this._resolved,this._done||(this._done=[]),t)},fail:function(t){return e(this,this._rejected,this._fail||(this._fail=[]),t)},always:function(t){return e(this,this._rejected||this._resolved,this._always||(this._always=[]),t)}}}();var z,q,B,J,X=function(){function e(){this._listeners={}}return e.prototype={constructor:e,on:function(e,t){return null!=t&&(this._listeners[e]||(this._listeners[e]=[])).push(t),this},once:function(e,t){return null!=t&&(t._once=!0,(this._listeners[e]||(this._listeners[e]=[])).push(t)),this},pipe:function(e){var t,n=this;return function(){t=m.call(arguments),t.unshift(e),f(n.trigger,n,t)}},trigger:function(){var e,t,n=m.call(arguments),r=n.shift(),o=this._listeners[r],i=0;if(null==o)return this;for(t=o.length;t>i;i++)e=o[i],f(e,this,n),e._once===!0&&(o.splice(i,1),i--,t--);return this},off:function(e,t){var n=this._listeners[e];if(null==n)return this;if(1===arguments.length)return n.length=0,this;for(var r=n.length,o=-1;++o<r;)n[o]===t&&(n.splice(o,1),o--,r--);return this}},e}(),V=function(e){var t,n;if(i(e)){if(t=e,1===arguments.length)return x(e);n=arguments[1],n[b]=t}else n=e;var r,l=n.Base,u=n.Extends,a=n.Static,h=n.Construct,d=null,p=n.Store,g=n.Self,m=n.Override;if(null!=l&&delete n.Base,null!=u&&delete n.Extends,null!=a&&delete n.Static,null!=g&&delete n.Self,null!=h&&delete n.Construct,null!=p&&(null==u?u=p:o(u)?u.unshift(p):u=[p,u],delete n.Store),null!=m&&delete n.Override,void 0===n.toJSON&&(n.toJSON=A),null==l&&null==u&&null==g){if(d=null==h?function(){}:h,n.constructor=d.prototype.constructor,null!=a)for(r in a)d[r]=a[r];return d.prototype=n,null!=t&&_(t,d),d}if(d=function(){if(null!=u)for(var e=u instanceof Array,t=e?u.length:1,n=0,r=null;t>n;n++)r=e?u[n]:u,"function"==typeof r&&f(r,this,arguments);if(null!=l&&f(l,this,arguments),null!=g&&s(this)===!1)for(var o in g)this[o]=c(g[o],this);if(null!=h){var i=f(h,this,arguments);if(null!=i)return i}return this["super"]=null,this},null!=t&&_(t,d),null!=a)for(r in a)d[r]=a[r];return null!=l&&O(d,l),null!=u&&O(d,u),S(n,l,u),k(d,l,u,n,m),n=null,a=null,d},K=function(){function e(e,n,r){var o,i=t(e,n,!0);return r.done(function(){o=m.call(arguments),o.unshift(null),i.apply(null,o)}).fail(function(e){i(e)})}function t(e,t,r){null==r&&(r=!0),e._timeout&&clearTimeout(e._timeout),e.defer(),e._wait++,t&&(e._result||(e._result={}),t in e._result&&console.warn("<await>",t,"already awaiting"),e._result[t]=null);var o=d(n,e,t,r);return e._timeout=setTimeout(o,K.TIMEOUT),o}function n(e,t,n){if(0===arguments.length)return e._wait=0,void e.reject("408: Timeout");if(0!==e._wait){var r=e._result;if(t){var o=m.call(arguments,3);r[t]={error:n?o.shift():null,arguments:o}}else n&&null!=arguments[3]&&(null==r&&(r=e._result={}),r.__error=arguments[3]);if(0===--e._wait){clearTimeout(e._timeout);var i,l,s=r&&r.__error;if(null==s)for(l in r)if(i=r[l],s=i&&i.error)break;if(s)return void e.reject(s,r);e.resolve(r)}}}return V({Base:g,_wait:0,_timeout:null,_result:null,_resolved:[],Construct:function(){for(var t,n=arguments.length,r=-1;++r<n;)t=arguments[r],null!=t&&"function"==typeof t.done&&e(this,null,t)},delegate:function(e,n){return t(this,e,n)},deferred:function(t){return e(this,t,new g)},Static:{TIMEOUT:2e3}})}(),G={fetch:null,save:null,del:null,onSuccess:null,onError:null,Static:{fetch:function(e){return(new this).fetch(e)}}};!function(){function e(e,n){return function(){var r=null==e._rejected,o=r?e._resolved:e._rejected,s=r?i:l;t([s,e,n].concat(o))}}function t(e){s.trigger.apply(s,e)}var n,r,o="start",i="fulfilled",l="rejected",s=new X;z=function(e){s.on(o,e),n=!0},q=function(e,t){s.on(i,e).on(l,t),r=!0},B=function(e){s.off(i,e).off(l,e).off(o,e)},J=function(i){return g.prototype.defer.call(this),n&&t([o,this,i]),r&&this.always(e(this,i)),this}}(),V.Remote=function(){function e(e,n){var r;try{r=JSON.parse(n)}catch(o){return void t(e,o)}e.deserialize(r),e.resolve(e)}function t(e,t,r){var o;if("string"==typeof t&&n(r))try{o=JSON.parse(t)}catch(i){o=i}e.reject(o||t)}function n(e){var t=e.getResponseHeader(s);return null!=t&&-1!==t.toLowerCase().indexOf(a)}function i(e,i,l){return function(s,u,a){if(n(a))try{u=JSON.parse(u)}catch(s){return console.error("<XHR> invalid json response",u),t(e,s,a)}if(i&&i(s,u),s)return t(e,u,a);if("save"===l&&r(u)){if(o(e))for(var c=e.length,f=u.length,h=-1;++h<c&&f>h;)U.deserialize(e[h],u[h]);else e.deserialize(u);return e.resolve(e)}e.resolve(u)}}function l(e){return new c(e)}var s="content-type",a="json",c=function(e){this._route=new H(e)};return D(c,G,U,g,{defer:J,serialize:function(){return o(this)?E.call(this):A.call(this)},deserialize:function(e){return U.deserialize(this,e)},fetch:function(e){return this.defer("fetch"),F.get(this._route.create(e||this),this),this},save:function(e){this.defer("save");var t=this.serialize(),n=this._route.create(this),r=this._route.hasAliases(this)?"put":"post";return F[r](n,t,i(this,e,"save")),this},patch:function(e){return this.defer("patch"),$(this,e),F.patch(this._route.create(this),e,i(this)),this},del:function(e){this.defer("del");var t=this.serialize(),n=this._route.create(this);return F.del(n,t,i(this,e)),this},onSuccess:function(t){e(this,t)},onError:function(e,n,r){t(this,n,r)}}),l.onBefore=z,l.onAfter=q,u(["get","post","put","delete"],function(e){l[e]=function(t,n){var r=n;null!=n.serialize&&(r=n.serialize()),null==r&&n.toJSON&&(r=n.toJSON());var o=new g;return F[e](t,r,i(o)),o}}),l}(),V.MongoStore=function(){function e(e,t){var n;return function(r){r&&(n=r),0===--e&&t(n)}}function t(){return l?l:n?"mongodb://"+S+":"+E+"/"+n:null}var n,l,s,u,d,p,v,y,b,_,x,w,C,j,N,k,O,S="127.0.0.1",E=27017,T={auto_reconnect:!0,native_parser:!0,w:1},R=function(e){e.ip&&(S=e.ip),e.port&&(E=e.port),e.db&&(n=e.db),e.params&&(T=e.params),l=e.connection};!function(){var e,r;u=function(t,n){if(null==e)return o(a(u,t,n));var r=e.collection(t);return null==r?n("<mongo> Collection Not Found: "+t):void n(null,r)},k=function(e){var t=new V.Deferred;return u(e,function(e,n){return e?t.reject(e):void t.resolve(n)}),t},s=function(t){return null==e?o(a(s,t)):void t(null,e)},O=function(){var e=new g;return s(function(t,n){return t?e.reject(t):void e.resolve(n)}),e},d=function(t,n,r){return null==e?o(a(d,t,n,r)):(n=l(n),void e.collection(t).findOne(n,function(e,t){r(e,t)}))},p=function(t,n,r,i){return null==e?o(a(p,t,n,r,i)):(null==r&&(r={}),n=l(n),void e.collection(t).find(n,r,function(e,t){return e?i(e):void t.toArray(function(e,t){i(e,t)})}))},v=function(t,n,r){return null==e?o(a(v,t,n,r)):void e.collection(t).count(n,r)},y=function(t,n,r){return null==e?o(a(y,t,n,r)):void e.collection(t).insert(n,{safe:!0},r)},b=function(t,n,r){return null==e?o(a(b,t,n,r)):null==n._id?r("<mongo:update> invalid ID"):void e.collection(t).update({_id:w(n._id)},n,{upsert:!0,multi:!1},function(e){r(e)})},_=function(e,t,n){b(e,t.shift(),function(r){return r?n(r):0===t.length?n():void _(e,t,n)})},C=function(t,n,r,i){return null==e?o(a(C,t,n,r,i)):void e.collection(t).update({_id:w(n)},r,function(e){i(e)})},x=function(t,n,r,i){return null==e?o(x.bind(null,t,n,i)):(n=l(n),void e.collection(t).remove(n,{justOne:r},function(e){i(e)}))},j=function(t,n,r){if(null==e)return o(a(j,t,n,r));var i=e.collection(t);return Array.isArray(n)?(n.push(r),void i.ensureIndex.apply(i,n)):void i.ensureIndex(n,r)},w=function(e){return i(e)&&24===e.length?N().ObjectID(e):e},N=function(){return N=function(){return r},r=require("mongodb"),N()};var o=function(){var o,i=[],l=!1;return function(s){function u(t,n){null==t&&(e=n);for(var r=i.length,o=-1;++o<r;)i[o](t);i.length=0,l=!1}return e?s():null==n?s('Database is not set. Call Class.MongoStore.settings({db:"myDbName"})'):(i.push(s),l?void 0:(N(),l=!0,(o=t())?void r.MongoClient.connect(o,T,u):s("<mongo> Invalid connection string")))}}(),l=function(e){if(null==e)return e;if(e.hasOwnProperty("$query")||e.hasOwnProperty("$limit"))return e;e.hasOwnProperty("_id")&&(e._id=w(e._id));var t={62:{0:"$gt",61:"$gte"},60:{0:"$lt",61:"$lte"}};for(var n in e){var r,o=e[n];if("string"==typeof o)switch(r=o.charCodeAt(0)){case 62:case 60:var i=t[r][0];61===o.charCodeAt(1)?(i=t[r][61],o=o.substring(2)):o=o.substring(1),e[n]={},e[n][i]=parseInt(o);continue}}return e},a=function(e){var t=m.call(arguments,1),n=t[t.length-1];return function(r){return r?n(r):(arguments.length>0&&(t=t.concat(arguments)),f(e,null,t))}}}();var M=function(){function e(e){var t,n="_id",o=[];if(i(e))t=e;else if(r(e)){t=e.collection,o=e.indexes||o,n=e.primaryKey||n;var l={};l[n]=1,o.push([l,{unique:!0}])}!t&&console.error("<MongoStore> should define a collection name"),this._coll=t,this._indexes=o,this._primaryKey=n}D(e,G,U,g,{_busy:!1,fetch:function(e){return this._ensureFree()===!1?this:(d(this._coll,e,c(this._fetched,this)),this)},save:function(){if(this._ensureFree()===!1)return this;var e=this.serialize(),t=null==e._id?y:b;return t(this._coll,e,c(this._inserted,this)),this},del:function(){return this._ensureFree()===!1?this:(this._id?x(this._coll,{_id:this._id},!0,c(this._completed,this)):this._completed("<class:patch> `_id` is not defined"),this)},patch:function(e){return this._ensureFree()===!1?this:null==this._id?this._completed("<class:patch> `_id` is not defined"):($(this,e),C(this._coll,this._id,e,c(this._completed,this)),this)},Static:{fetch:function(e){return(new this).fetch(e)},resolveCollection:function(){return k((new this)._coll)}},serialize:function(){return A.call(this)},deserialize:function(e){return U.deserialize(this,e),this._id&&(this._id=w(this._id)),this},_ensureFree:function(){return this._busy?(console.warn("<mongo:single> transport requested, but is busy for the same instance."),!1):(this.defer(),this._busy=!0,!0)},_completed:function(e){return this._busy=!1,e?this.reject(e):this.resolve(this)},_fetched:function(e,t){null==e&&(null==t?e={message:"Not Found",code:404}:this.deserialize(t)),this._completed(e)},_inserted:function(e,t){null!=t&&null==this._id&&(o(t)&&1===t.length?this._id=t[0]._id:console.error("<mongo:insert-single> expected an array in callback")),this._completed(e)}});var t=function(t){return new e(t)};return t.prototype=e.prototype,t}(),I=function(){function t(e){e||console.error("<MongoStore> should define a collection name"),this._coll=e}function n(e,t){var n=e._ctor,r=new n(t);null==r._id&&h(r.deserialize)&&r.deserialize(t),e[e.length++]=r}D(t,g,{fetch:function(e,t){return this._ensureFree()===!1?this:(p(this._coll,e,t,c(this._fetched,this)),this)},save:function(){if(this._ensureFree()===!1)return this;for(var t,n=[],r=[],o=[],i=this._coll,l=c(this._completed,this),s=0,u=this.length;u>s;s++)t=this[s],null!=t._id?o.push(t.serialize()):(n.push(t.serialize()),r.push(s));if(n.length&&o.length){var a=e(2,l);return y(i,n,this._insertedDelegate(this,a,r)),_(i,o,a),this}return n.length?(y(i,n,this._insertedDelegate(this,this._completed,r)),this):o.length?(_(i,o,l),this):this},del:function(e){if(null==e&&0!==arguments.length)return console.error("<MongoStore:del> - selector is specified, but is undefined"),this;if(this._ensureFree()===!1)return this;var t=null==e?this.toArray():this.remove(e);if(t&&t.length){for(var n,r=[],o=0,i=t.length;i>o;o++)n=t[o],n._id&&r.push(n._id);x(this._coll,{_id:{$in:r}},!1,c(this._completed,this))}else this._completed();return this},Static:{fetch:function(e,t){return(new this).fetch(e,t)},count:function(e){var t=new g;return v(this.prototype._coll,e,function(e,n){return null!=e?void t.reject(n):void t.resolve(n)}),t}},_busy:!1,_ensureFree:function(){return this._busy?(console.warn("<mongo:collection> requested transport, but is busy by the same instance."),!1):(this._busy=!0,this._resolved=null,this._rejected=null,!0)},_completed:function(e){this._busy=!1,e?this.reject(e):this.resolve(this)},_fetched:function(e,t){if(a(t))for(var r,o=0,i=t.length;i>o;o++)r=t[o],n(this,r);else t&&n(this,t);this._completed(e)},_insertedDelegate:function(e,t,n){function r(){t.call(e)}return function(t,i){if(o(i)===!1)return console.error("<mongo:bulk insert> array expected"),r();if(i.length!==n.length)return console.error("<mongo:bul insert> count missmatch",i.length,n.length),r();for(var l,s=0,u=n.length;u>s;s++)l=n[s],e[l]._id=i[s]._id;r()}}});var r=function(e){return new t(e)};return r.prototype=t.prototype,r}();return{Single:M,Collection:I,settings:R,resolveDb:O,resolveCollection:k,createId:function(e){return w(e)},ensureIndexes:function(t){function n(e){return e?l.reject(e):void l.resolve()}var r=t.prototype,o=r._indexes,i=r._coll,l=new g;if(null==o)return l.reject("<No indexes> "+i);for(var s=-1,u=o.length,a=e(u,n);++s<u;)j(i,o[s],a);return l}}}(),V.bind=function(e){for(var t,n=arguments,r=1,o=arguments.length;o>r;r++)t=n[r],e[t]=e[t].bind(e);return e},V.cfg=function(e,t){if(i(e))return 1===arguments.length?y[e]:void(y[e]=t);if(r(e))for(var n in e)V.cfg(n,e[n])},V.Model={},V.Serializable=U,V.Deferred=g,V.EventEmitter=X,V.Await=K,V.validate=L,V.stringify=C,V.parse=j,V.patch=w,V.properties=N,V.Collection=function(){function e(e,t){return t instanceof e?t:new e(t)}function t(){var e,t=arguments.length,o=arguments[t-1],i=arguments[t-2];return t>2&&(e=arguments[0]),o._ctor=i,D(o,r,n),null==e?V(o):V(e,o)}var n=function(){function t(e,t){if(null==t)return!1;if("function"==typeof t)return t(e);if("object"==typeof t){if(e.constructor===t.constructor&&e.constructor!==Object)return e===t;var n,r;for(var o in t){if(n=e[o],r=t[o],"string"==typeof r){var i=r[0],l=1;if("<"===i||">"===i)switch("="===r[1]&&(i+="=",l++),r=r.substring(l),i){case"<":if(n>=r)return!1;continue;case"<=":if(n>r)return!1;continue;case">":if(r>=n)return!1;continue;case">=":if(r>n)return!1;continue}}if(n!=r)return!1}return!0}return console.warn("No valid matcher",t),!1}function n(e,t){for(var n=this.length,r=-1;++r<n;)e.call(t||this,this[r],r);return this}var r={length:0,push:function(){for(var t=arguments.length,n=-1;++n<t;)this[this.length++]=e(this._ctor,arguments[n]);return this},pop:function(){var e=this[--this.length];return this[this.length]=null,e},shift:function(){if(0===this.length)return null;for(var e=this[0],t=this.length-1,n=0;t>n;n++)this[n]=this[n+1];return this[t]=null,this.length--,e},unshift:function(t){this.length++;for(var n=this.length;--n;)this[n]=this[n-1];return this[0]=e(this._ctor,t),this},splice:function(t,n){var r,o,i,l=this.length;if(t>=l)for(n=0,r=l,o=t;o>r;r++)this[r]=void 0;var s=n,u=t,a=t+s,c=arguments.length-2,f=l+c-s,h=a,d=l,p=f-l;if(p>0)for(r=d;--r>=h;)this[r+p]=this[r];if(0>p)for(r=h;d>r;)this[r+p]=this[r],r++;for(r=u,i=2;i<arguments.length;i)this[r++]=e(this._ctor,arguments[i++]);return this.length=f,this},slice:function(){return f(m,this,arguments)},sort:function(e){return v.call(this,e),this},reverse:function(){for(var e=m.call(this),t=this.length,n=-1;++n<t;)this[n]=e[t-n-1];return this},toString:function(){return m.call(this,0).toString()},each:n,forEach:n,where:function(e){for(var n,r=new this.constructor,o=0,i=this.length;i>o;o++)n=this[o],t(n,e)&&(r[r.length++]=n);return r},remove:function(e){for(var n=-1,r=[],o=0,i=this.length;i>o;o++)t(this[o],e)?r.push(this[o]):this[++n]=this[o];for(o=++n;i>o;o++)this[o]=null;return this.length=n,r},first:function(e){if(null==e)return this[0];var t=this.indexOf(e);return-1!==t?this[t]:null},last:function(e){if(null==e)return this[this.length-1];var t=this.lastIndexOf(e);return-1!==t?this[t]:null},indexOf:function(e,n){if(null==e)return-1;if(null!=n){if(0>n&&(n=0),n>=this.length)return-1}else n=0;for(var r=this.length;r>n;n++)if(t(this[n],e))return n;return-1},lastIndexOf:function(e,n){if(null==e)return-1;if(null!=n){if(n>=this.length&&(n=this.length-1),0>n)return-1}else n=this.length-1;for(;n>-1;n--)if(t(this[n],e))return n;return-1},map:function(e){for(var t=[],n=this.length,r=-1;++r<n;)t[r]=e(this[r]);return t},filter:function(e,t){for(var n=new this.constructor,r=this.length,o=-1;++o<r;)e.call(t||this,this[o])&&n.push(this[o]);return n}};return r}(),r={toArray:function(){for(var e=new Array(this.length),t=0,n=this.length;n>t;t++)e[t]=this[t];return e},toJSON:E};return t}(),function(){function e(e,t){if(e.length!==t.length)return!1;for(var n=e.length,r=0;n>r;r++)if(e[r]!==t[r])return!1;return!0}function t(t,n){if(0===n.length)return 0;for(var r=0,o=t.length;o>r;r++)if(e(t[r],n))return r+1;return t.push(n),t.length}function n(e){var n={},r=[];return function(){var o=t(r,arguments);return null==n[o]?n[o]=f(e,this,arguments):n[o]}}function r(e,t,n){return function(){e[n]=arguments;for(var r,o=0,i=t[n].length;i>o;o++)r=t[n][o],f(r,this,arguments);t[o]=null,e=null,t=null}}function o(e){var n={},o={},i=[];return function(){var l=m.call(arguments),s=l.pop(),u=t(i,l);return n[u]?void f(s,this,n[u]):o[u]?void o[u].push(s):(o[u]=[s],l=m.call(l),l.push(r(n,o,u)),void f(e,this,l))}}V.Fn={memoize:n,memoizeAsync:o}}(),t.Class=V}),function(e,t){"use strict";var n,r,o;"undefined"==typeof exports||e!==exports&&null!=e||(n=r=global),null==n&&(n="undefined"==typeof window?global:window),null==r&&(r=e||n),o=n.document,t(n,r,o)}(this,function(global,exports,document){"use strict";function fn_proxy(e,t){return function(){e.apply(t,arguments)}}function fn_doNothing(e){"function"==typeof e&&e()}function obj_inherit(e){"function"==typeof e&&(e=e.prototype);for(var t,n,r=1,o=arguments.length;o>r;r++){t="function"==typeof arguments[r]?arguments[r].prototype:arguments[r];for(n in t)e[n]=t[n]}return e}function obj_getProperty(e,t){for(var n=t.split("."),r=n.length,o=0;r>o;o++){if(null==e)return null;e=e[n[o]]}return e}function arr_invoke(e,t,n){if(null!=e&&e instanceof Array!=!1)for(var r=0,o=e.length;o>r;r++)"function"==typeof e[r]&&(null==t?e[r].call(n):e[r].apply(n,t))}function arr_ensure(e,t){if(!t)return e;for(var n,r=t.split("."),o=r.length-1,i=0;o>i;i++)n=r[i],e=e[n]||(e[n]={});return n=r[o],e[n]||(e[n]=[])}var bin={js:{},css:{},load:{}},isWeb=!!(global.location&&global.location.protocol&&/^https?:/.test(global.location.protocol)),reg_subFolder=/([^\/]+\/)?\.\.\//,cfg={path:null,loader:null,version:null,lockedToFolder:null,sync:null,eval:null==document},handler={},hasOwnProp={}.hasOwnProperty,emptyResponse={load:{}},__array_slice=Array.prototype.slice,XMLHttpRequest=global.XMLHttpRequest,Helper={reportError:function(e){console.error("IncludeJS Error:",e,e.message,e.url),"function"==typeof handler.onerror&&handler.onerror(e)}},XHR=function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&t&&t(e,n.responseText)},n.open("GET","object"==typeof e?e.url:e,!0),n.send()},path_getDir,path_getFile,path_getExtension,path_resolveCurrent,path_normalize,path_win32Normalize,path_resolveUrl,path_combine,path_isRelative;!function(){path_getDir=function(e){return e.substring(0,e.lastIndexOf("/")+1)},path_getFile=function(e){return e=e.replace("file://","").replace(/\\/g,"/").replace(/\?[^\n]+$/,""),/^\/\w+:\/[^\/]/i.test(e)?e.substring(1):e},path_getExtension=function(e){var t=e.indexOf("?");return-1===t?e.substring(e.lastIndexOf(".")+1):e.substring(e.lastIndexOf(".",t)+1,t)},path_resolveCurrent=function(){if(null==document)return"undefined"==typeof module?"":path_win32Normalize(module.parent.filename);var e=document.getElementsByTagName("script"),t=e[e.length-1],n=t&&t.getAttribute("src")||"";if("/"===n[0])return n;var r=window.location.pathname.replace(/\/[^\/]+\.\w+$/,"");return"/"!==r[r.length-1]&&(r+="/"),r+n},path_normalize=function(e){return e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")},path_win32Normalize=function(e){return e=e.replace(/\\/g,"/"),"file:"===e.substring(0,5)?e:"file:///"+e},path_resolveUrl=function(e,t){switch(cfg.path&&"/"===e[0]&&(e=cfg.path+e.substring(1)),e.substring(0,5)){case"file:":case"http:":return e}for("./"===e.substring(0,2)&&(e=e.substring(2)),"/"===e[0]?(isWeb===!1||cfg.lockedToFolder===!0)&&(e=e.substring(1)):null!=t&&null!=t.location&&(e=t.location+e);-1!==e.indexOf("../");)e=e.replace(reg_subFolder,"");return e},path_isRelative=function(e){var t=e.charCodeAt(0);switch(t){case 47:return!1;case 102:case 104:return/^file:|https?:/.test(e)===!1}return!0},path_combine=function(){for(var e,t="",n=arguments.length,r=-1;++r<n;)e=arguments[r],e&&(e=path_normalize(e),""!==t?("/"!==t[t.length-1]&&(t+="/"),"/"===e[0]&&(e=e.substring(1)),t+=e):t=e);return t}}();var tree_resolveUsage;!function(){function e(t,n){if(null==n)return void console.warn("<include:use> Not Found. Ensure to have it included before with correct alias",t);for(var r,o=n.includes,i=-1,l=o.length;++i<l;)if(r=o[i],r.route.alias===t)return r.resource.exports;return e(t,n.parent)}tree_resolveUsage=function(t,n){for(var r,o,i,l,s=[],u=n.length,a=-1;++a<u;)i=o=n[a],l=o.indexOf("."),-1!==l&&(i=o.substring(0,l),o=o.substring(l+1)),r=e(i,t.parent),i!==o&&(r=obj_getProperty(r,o)),"object"==typeof r&&null==r&&console.warn("<include:use> Used resource has no exports",i,t.url),s[a]=r;return s}}();var RoutesLib=function(){var e={},t=/([^\\\/]+)\.\w+$/;return{register:function(t,n,r){if("string"==typeof n&&path_isRelative(n)){var o=r||include,i=o.location||path_getDir(o.url||path_resolveCurrent());path_isRelative(i)&&(i="/"+i),n=i+n}e[t]=n instanceof Array?n:n.split(/[\{\}]/g)},resolve:function(t,n){var r,o,i,l,s,u,a,c,f=n.indexOf("?"),h=n.indexOf("::");if(-1!==h&&(r=n.substring(h+2),n=n.substring(0,h)),-1!==f){for(c=n.substring(f+1).split("&"),i={},s=0,a=c.length;a>s;s++)u=c[s].split("="),i[u[0]]=u[1];n=n.substring(0,f)}if(n=n.split("/"),l=e[t],null==l)return{path:n.join("/"),params:i,alias:r};for(o=l[0],s=1;s<l.length;s++)if(s%2===0)o+=l[s];else{var d=l[s]<<0;if(d>n.length-1&&(d=n.length-1),o+=n[d],s===l.length-2)for(d++;d<n.length;d++)o+="/"+n[d]}return{path:o,params:i,alias:r}},each:function(e,t,n,r,o){var i;if(null!=t)if("lazy"!==e||null!=o)if(t instanceof Array)for(var l=0;l<t.length;l++)this.each(e,t[l],n,r,o);else if("object"!=typeof t){if("string"==typeof t){var s=this.resolve(r,t);return r&&(r+="."+t),void n(r,s,o)}console.error("Include Package is invalid",arguments)}else for(i in t)hasOwnProp.call(t,i)&&this.each(e,t[i],n,i,o);else for(i in t)this.each(e,t[i],n,null,i)},getRoutes:function(){return e},parseAlias:function(e){var n=e.path,r=t.exec(n);return r&&r[1]}}},Routes=RoutesLib(),Events=function(e){function t(){Events.ready=fn_doNothing,null!=n&&(arr_invoke(n),n=null)}if(null==e)return{ready:fn_doNothing,load:fn_doNothing};var n=[];return"onreadystatechange"in e?e.onreadystatechange=function(){/complete|interactive/g.test(e.readyState)!==!1&&t()}:e.addEventListener?e.addEventListener("DOMContentLoaded",t):window.onload=t,{ready:function(e){n.unshift(e)}}}(document),ScriptStack=function(){function e(e,t){var n=document.createElement("script");n.type="text/javascript",n.src=e,"onreadystatechange"in n?n.onreadystatechange=function(){("complete"===this.readyState||"loaded"===this.readyState)&&t()}:n.onload=n.onerror=t,(o||(o=document.getElementsByTagName("head")[0])).appendChild(n)}function t(){function n(e){e&&"error"===e.type&&console.log("Script Loaded Error",o.url);for(var n=0,r=s.length;r>n;n++)if(s[n]===o){s.splice(n,1);break}return n===r?void console.error("Loaded Resource not found in stack",o):(2.5!==o.state&&o.readystatechanged(3),i=null,void t())}if(!l){if(0===s.length)return void r();if(null==i){var o=i=s[0];if(1!==o.state)return o.state=1,global.include=o,global.iparams=o.route.params,o.source?(__eval(o.source,o),void n()):void e(o.url,n)}}}function n(){if(!l){if(0===s.length)return void r();if(null==i){var e=s[0];if(!(e.state<2)){i=e,e.state=1,global.include=e,__eval(e.source,e);for(var t,o=0,u=s.length;u>o;o++)if(t=s[o],t===e){s.splice(o,1);break}2.5!==e.state&&e.readystatechanged(3),i=null,n()}}}}function r(){for(var e=-1,t=u.length;++e<t;)u[e]();u.length=0}var o,i,l,s=[],u=[];return{load:function(e,r,o){return this.add(e,r),!cfg.eval||o?void t():e.source?(e.state=2,void n()):void XHR(e,function(e,t){t||console.error("Not Loaded:",e.url),e.source=t,e.state=2,n()})},add:function(e,t){if(1===e.priority)return s.unshift(e);if(null==t)return s.push(e);for(var n=s.length,r=-1;++r<n;)if(s[r]===t)return s.splice(r,0,e);s.push(e)},moveToParent:function(e,t){var n,r=s.length,o=-1,i=-1;for(n=0;r>n;n++)if(s[n]===e){i=n;break}if(-1!==i){for(n=0;r>n;n++)if(s[n]===t){o=n;break}-1!==o&&(o>i||(s.splice(i,1),s.splice(o,0,e)))}},pause:function(){l=!0},resume:function(){l=!1,null==i&&this.touch()},touch:function(){var e=cfg.eval?n:t;e()},complete:function(e){return l!==!0&&0===s.length?void e():void u.push(e)}}}(),IncludeDeferred=function(){this.callbacks=[],this.state=-1};IncludeDeferred.prototype={on:function(e,t,n,r){return this===n&&-1===this.state?(t(this),this):(null==r&&(r=this.state<3||this===n?"unshift":"push"),e<=this.state?t(this):this.callbacks[r]({state:e,callback:t}),this)
},readystatechanged:function(e){var t,n,r,o;if(e>this.state&&(this.state=e),3===this.state){var i=this.includes;if(null!=i&&i.length)for(t=0;t<i.length;t++)if(4!==i[t].resource.state)return;this.state=4}if(t=0,n=this.callbacks.length,0!==n){for("js"===this.type&&4===this.state&&(o=global.include,global.include=this);n>t&&(r=this.callbacks[t],null==r||r.state>this.state||(this.callbacks.splice(t,1),n--,t--,r.callback(this),!(this.state<4)));t++);null!=o&&(global.include=o)}},ready:function(e){var t=this;return this.on(4,function(){Events.ready(function(){t.resolve(e)})},this)},done:function(e){var t=this;return this.on(4,function(){t.resolve(e)},this)},resolve:function(e){var t=this.includes,n=null==t?0:t.length;if(n>0&&null==this.response){this.response={};for(var r,o,i,l=0;n>l;l++)if(i=t[l],r=i.resource,o=i.route,"undefined"!=typeof r.exports){var s=r.type;switch(s){case"js":case"load":case"ajax":var u=o.alias||Routes.parseAlias(o),a="js"===s?this.response:this.response[s]||(this.response[s]={});if(u){a[u]=r.exports;break}console.warn("Resource Alias is Not defined",r)}}}var c=this.response||emptyResponse;return this._use?e.apply(null,[c].concat(this._use)):void e(c)}};var Include=function(IncludeDeferred){function Include(){IncludeDeferred.call(this)}function incl_getResource(e,t){var n=e;if(47!==e.charCodeAt(0)&&(n="/"+n),null!=t)return bin[t][n];for(var r in bin)if(bin[r].hasOwnProperty(n))return bin[r][n];return null}function embedPlugin(source){eval(source)}function enableModules(){return"undefined"==typeof Object.defineProperty?void console.warn("Browser do not support Object.defineProperty"):(Object.defineProperty(global,"module",{get:function(){return global.include}}),void Object.defineProperty(global,"exports",{get:function(){var e=global.include;return e.exports||(e.exports={})},set:function(e){global.include.exports=e}}))}function includePackage(e,t,n){var r=1===n.length?n[0]:__array_slice.call(n);return e instanceof Resource?e.include(t,r):new Resource("js").include(t,r)}function createIncluder(e){return function(){return includePackage(this,e,arguments)}}function doNothing(){return this}function stub_freeze(e){e.js=e.css=e.load=e.ajax=e.embed=e.lazy=e.inject=doNothing}function stub_release(e){for(var t=["js","css","load","ajax","embed","lazy"],n=t.length;-1!==--n;)e[t[n]]=createIncluder(t[n]);e.inject=e.js}return stub_release(Include.prototype),obj_inherit(Include,IncludeDeferred,{isBrowser:!0,isNode:!1,setCurrent:function(e){var t=new Resource("js",{path:e.id},e.namespace,null,null,e.id);t.state<3&&console.error("<include> Resource should be loaded",e),t.state=3,global.include=t},cfg:function(e){switch(typeof e){case"object":var t,n;for(t in e)switch(n=e[t],t){case"loader":for(var r in n)CustomLoader.register(r,n[r]);break;case"modules":n===!0&&enableModules();break;default:cfg[t]=n}break;case"string":if(1===arguments.length)return cfg[e];2===arguments.length&&(cfg[e]=arguments[1]);break;case"undefined":return cfg}return this},routes:function(e){if(null==e)return Routes.getRoutes();if(2===arguments.length)return Routes.register(e,arguments[1]),this;for(var t in e)Routes.register(t,e[t]);return this},promise:function(e){for(var t=e.split("."),n=global;t.length;){var r=t.shift();n=n[r]||(n[r]={})}return n},register:function(e){var t,n,r,o,i;for(t in e)for(r=e[t],o=r.length,i=-1;++i<o;){n=r[i];var l=n.id,s=n.url,u=n.namespace,a=n.parent&&incl_getResource(n.parent,"js"),c=new Resource,f=n.state;if(l||s){switch(s&&("/"===s[0]&&(s=s.substring(1)),c.location=path_getDir(s)),c.state=null==f?"js"===t?3:4:f,c.namespace=u,c.type=t,c.url=s||l,c.parent=a,t){case"load":case"lazy":var h=document.querySelector("#includejs-"+l.replace(/\W/g,""));if(null==h){console.error('"%s" Data was not embedded into html',l);break}c.exports=h.innerHTML,CustomLoader.exists(c)&&(c.state=3,CustomLoader.load(c,function(e,t){e.exports=t,e.readystatechanged(4)}))}(bin[t]||(bin[t]={}))[l]=c}}},instance:function(e){var t;return null==e?(t=new Include,t.state=4,t):(t=new Resource,t.state=4,t.location=path_getDir(e),t)},getResource:incl_getResource,getResources:function(){return bin},plugin:function(e,t){var n=[],r=0,o=0,i=0,l=function(e,n){o++,embedPlugin(n),o===r-1&&t&&(t(),t=null)};for(Routes.each("",e,function(e,t){n.push("/"===t.path[0]?t.path.substring(1):t.path)}),r=n.length;r>i;i++)XHR(n[i],l);return this},client:function(){return cfg.server===!0&&stub_freeze(this),this},server:function(){return cfg.server!==!0&&stub_freeze(this),this},use:function(){return null==this.parent?(console.error("<include.use> Parent resource is undefined"),this):(this._use=tree_resolveUsage(this,arguments),this)},pauseStack:fn_proxy(ScriptStack.pause,ScriptStack),resumeStack:fn_proxy(ScriptStack.resume,ScriptStack),allDone:function(e){ScriptStack.complete(function(){function t(){--r<1&&e()}var n=include.getPending("js"),r=n.length;if(0===r)return void e();for(var o=-1,i=r;++o<i;)n[o].on(4,t)})},getPending:function(e){var t,n,r,o=[];for(n in bin)if(null==e||e==n)for(r in bin[n])t=bin[n][r],t.state<4&&o.push(t);return o}}),Include}(IncludeDeferred),CustomLoader=function(){function e(e){return"string"==typeof e?!1:"function"==typeof e.ready||"function"==typeof e.process}function t(t){var n=path_getExtension(t),r=cfg.loader[n];if(e(r))return r;var o,i=r;if("object"==typeof i)for(var l in i){o=l,i=i[l];break}return cfg.loader[n]=new Resource("js",Routes.resolve(o,i),o,null,null,null,1)}function n(e,t){return function(n){e(t,n)}}function r(e,t,r,o){if(null==r.process)return void o(t,e);var i=n(o,t),l=r.process(e,t,i);"undefined"!=typeof l&&o(t,l)}function o(e,t,n){function o(e,o){r(o,e,t,n)}return"string"==typeof e.exports?void r(e.exports,e,t,n):t.load?t.load(e,o):void XHR(e,o)}var i={process:function(e){try{return JSON.parse(e)}catch(t){return console.error(t,e),null}}};return cfg.loader={json:i},{load:function(e,n){var r=t(e.url);return r.process?void o(e,r,n):void r.on(4,function(){o(e,r.exports,n)},null,"push")},exists:function(e){if(!e.url)return!1;var t=path_getExtension(e.url);return cfg.loader.hasOwnProperty(t)},register:function(e,t){if("string"==typeof t){var n=include;null==n.location&&(n={location:path_getDir(path_resolveCurrent())}),t=path_resolveUrl(t,n)}cfg.loader[e]=t}}}(),LazyModule={create:function(e,t){for(var n=e.split("."),r=global,o=n[n.length-1];n.length>1;){var i=n.shift();r=r[i]||(r[i]={})}n=null,Object.defineProperty(r,o,{get:function(){delete r[o];try{var n=__eval(t,global.include);null==n||n instanceof Resource||(r[o]=n)}catch(i){i.xpath=e,Helper.reportError(i)}finally{return t=null,e=null,r[o]}}})}},Resource=function(e,t,n,r){function o(e){var t=e.type,o=e.parent,l=e.url;if(null==document&&"css"===t)return e.state=4,e;if(r.exists(e)===!1)switch(t){case"js":case"embed":n.load(e,o,"embed"===t);break;case"ajax":case"load":case"lazy":XHR(e,i);break;case"css":e.state=4;var s=document.createElement("link");s.href=l,s.rel="stylesheet",s.type="text/css",document.getElementsByTagName("head")[0].appendChild(s)}else("js"===t||"embed"===t)&&n.add(e,e.parent),r.load(e,i);return e}function i(e,t){switch(t||console.warn("Resource cannt be loaded",e.url),e.type){case"js":case"embed":return e.source=t,e.state=2,void n.touch();case"load":case"ajax":e.exports=t;break;case"lazy":LazyModule.create(e.xpath,t);break;case"css":var r=document.createElement("style");r.type="text/css",r.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(r)}e.readystatechanged(4)}function l(e,t,n){if(null==e)return null;null==n&&(n=[]);for(var r,o=0,i=e.length;i>o;o++)r=e[o].resource,t===r.type&&n.push(r),null!=r.includes&&l(r.includes,t,n);return n}var s=function(t,r,i,l,s,u,a){e.call(this),this.childLoaded=fn_proxy(this.childLoaded,this);var c=r&&r.path;null!=c&&(this.url=c=path_resolveUrl(c,s)),this.type=t,this.xpath=l,this.route=r,this.parent=s,this.priority=a,this.namespace=i,null==u&&c&&(u=("/"===c[0]?"":"/")+c);var f=bin[t]&&bin[t][u];return f?(f.state<4&&"js"===t&&n.moveToParent(f,s),f):null==c?(this.state=3,this.location=path_getDir(path_resolveCurrent()),this):(this.state=0,this.location=path_getDir(c),(bin[t]||(bin[t]={}))[u]=this,cfg.version&&(this.url+=(-1===this.url.indexOf("?")?"?":"&")+"v="+cfg.version),o(this))};return s.prototype=obj_inherit(s,e,{childLoaded:function(){var e=this,t=e.includes;if(t&&t.length){if(e.state<3)return;for(var n=0;n<t.length;n++)if(4!==t[n].resource.state)return}e.readystatechanged(4)},create:function(e,t,n,r,o){var i;return this.state=this.state>=3?3:2,this.response=null,null==this.includes&&(this.includes=[]),i=new s(e,t,n,r,this,o),this.includes.push({resource:i,route:t}),i},include:function(e,n){var r=this;return t.each(e,n,function(t,n,o){(null==r.route||r.route.path!==n.path)&&r.create(e,n,t,o).on(4,r.childLoaded)}),this},pause:function(){this.state=2.5;var e=this;return function(){e.readystatechanged(3)}},getNestedOfType:function(e){return l(this.includes,e)}}),s}(Include,Routes,ScriptStack,CustomLoader);exports.include=new Include,exports.includeLib={Routes:RoutesLib,Resource:Resource,ScriptStack:ScriptStack,registerLoader:CustomLoader.register},function(){cfg.server=!0;var e,t,n=require("vm"),r=(global.module||module).constructor;!function(){function n(e){null!=o[e]&&(o[e].close(),o[e]=null)}var r=require("fs"),o={};e=function(e,t){if(cfg.sync)try{var n=r.readFileSync(e,"utf8");t(null,n)}catch(o){console.error("File Read - ",o)}else r.readFile(e,"utf8",t)},t=function(e,t){n(e),o[e]=r.watch(e,t)}}();var o,i,l;!function(){function e(e){if(null!=e){e.content=null,e.exports=null;var t=e.parent;return t.create(e.type,e.route,e.namespace,e.xpath).on(4,t.childLoaded)}}function t(e,t){var n=bin[e][t],r=n.includes;delete bin[e][t],null!=r&&r.forEach(function(e){var t=e.resource,n=t.type,r=t.url;"/"!==r[0]&&(r="/"+r),delete bin[n][r]})}o=function(e){var t;return function(){t&&clearTimeout(t),t=setTimeout(function(){var t;"object"==typeof cfg.autoreload&&(t=function(t){t!==!1&&cfg.autoreload.fileChanged(e,"include")}),l(e,t)},150)}},i=function(e){if(null!=e){var n,r,o,l,s=[];for(n in bin)for(r in bin[n])l=bin[n][r],o=r.indexOf(e),-1!==o&&o===r.length-e.length&&(t(n,r),s.push(l.parent&&l.parent.url?i(l.parent.url):l));return 0===s.length&&console.warn("<include:res:remove> Resource is not in cache",e),s}},l=function(t,n){var r=i(t).filter(function(e){return null!=e});if(0===r.length)return void(n&&n(!1));for(var o=r.length,l=l,s=-1;++s<l;)e(r[s]).done(function(){0===--o&&n()})}}(),XMLHttpRequest=function(){},XMLHttpRequest.prototype={constructor:XMLHttpRequest,open:function(e,t){this.url=t},send:function(){-1!==this.url.indexOf("file://")&&(this.url=path_getFile(this.url));var n=this;e(this.url,function(e,r){e&&(console.error(">>",e.code,e.path),r=""),n.readyState=4,n.responseText=r,n.onreadystatechange(),null==e&&cfg.autoreload&&t(n.url,o(n.url))})}},__eval=function(e,t,o){module.exports={},global.include=t,global.require=require,global.exports=module.exports,global.__filename=path_getFile(t.url),global.__dirname=path_getDir(global.__filename),global.module=module,o!==!0&&(e="(function(){ "+e+"\n}())");try{if(o)n.runInThisContext(e,global.__filename);else{var i=global.__filename;module=new r(i,module),module.paths=r._nodeModulePaths(path_getDir(i)),module.filename=i,module._compile(e,i),module.loaded=!0}}catch(l){console.error("Module Evaluation Error",t.url),console.error(l.stack)}if(null==t.exports){var s=module.exports;("object"!=typeof s||Object.keys(s).length)&&(t.exports=module.exports)}},function(){function e(t,n){if(n>=t.includes.length)return t.readystatechanged(4);var r=t.includes[n],o=r.resource,i=r.route.alias,l=o.exports;o.exports=null,o.type="js",o.includes=null,o.state=3,o.parent=null;for(var s in bin.load)if(bin.load[s]===o){delete bin.load[s];break}try{__eval(l,o,!0)}catch(u){console.error("<inject> Evaluation error",o.url,u),o.state=4}o.readystatechanged(3),o.on(4,function(){o.exports&&i&&(global[i]=o.exports),e(t,++n)})}var t;obj_inherit(Resource,{isBrowser:!1,isNode:!0,bin_remove:i,bin_tryReload:l,path_getFile:function(){return path_getFile(this.url)},path_getDir:function(){return path_getDir(path_getFile(this.url))},inject:function(){var t=1===arguments.length?arguments[0]:__array_slice.call(arguments);this.state=this.state>=3?3:2;var n=this,r=n.create();return r.url=this.url,r.location=this.location,r.load(t).done(function(){r.state=3,r.on(4,function(){var e=1,t=ruqq.arr.indexOf(n.includes,function(e){return e.resource===r});-1===t&&(t=n.includes.length-1,e=0),n.includes.splice.apply(n.includes,[t,e].concat(r.includes)),n.readystatechanged(3)}),e(r,0)}),n},instance:function(e){if("string"==typeof e){var n=module,o=new r(e,n);if(o.filename=path_getFile(e),o.paths=r._nodeModulePaths(path_getDir(o.filename)),null==i){for(var i,l=process.env.PATH||process.env.path,s=require("path").delimiter,u=l.split(s),a=u.length,c=/([\\\/]npm[\\\/])|([\\\/]npm$)/gi;--a>-1;)if(c.test(u[a])){i=u[a];break}i?(i=path_combine(i,"node_modules"),t=path_combine(path_getDir(path_normalize(process.mainModule.filename)),"node_modules")):(i=!1,console.warn("Could not resolve global NPM Directory from system path (%s)",s,l))}t&&o.paths.unshift(t),i&&o.paths.unshift(i),global.module=module=o,global.require=require=o.require.bind(o)}var f=new Resource;return f.state=4,f.location=e,f}})}(),obj_inherit(Include,{isBrowser:!1,isNode:!0,bin_tryReload:l,bin_remove:i})}()}),function(e,t){"use strict";function n(){return t(i,r,o)}var r,o,i="undefined"==typeof window||null==window.navigator?global:window;return"undefined"==typeof exports||null!=e&&e!==exports&&e!==i||(e=exports),o=i.document,r=e||i,"function"==typeof define&&define.amd?define(n):n()}(this,function(global,exports,document){"use strict";function util_interpolate(e,t,n,r,o,i,l){for(var s,u,a,c,f,h=e.length,d=-1,p=null,g="",m=!0;++d<h;)m===!0?null==p?g+=e[d]:p.push(e[d]):(c=e[d],u=null,a=c.indexOf(":"),-1===a?u=obj_getPropertyEx(c,n,r,i):(s=a>0?str_trim(c.substring(0,a)):"",""===s&&(s="expression"),c=c.substring(a+1),f=custom_Utils[s],u=f(c,n,r,o,i,l,t)),null!=u&&("object"==typeof u&&null==p&&(p=[g]),null==p?g+=u:p.push(u))),m=!m;return null==p?g:p}function Template(e){this.template=e,this.index=0,this.length=e.length}function fn_proxy(e,t){return function(){return fn_apply(e,t,arguments)}}function fn_apply(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2]);case 4:return e.call(t,n[0],n[1],n[2],n[3])}return e.apply(t,n)}function fn_doNothing(){}function str_trim(e){for(var t,n=e.length,r=0,o=n-1;n>r&&(t=e.charCodeAt(r),33>t);r++);for(;o>=r&&(t=e.charCodeAt(o),33>t);o--);return 0===r&&o===n-1?e:e.substring(r,o+1)}function is_Function(e){return"function"==typeof e}function is_Object(e){return null!=e&&"object"==typeof e}function is_Array(e){return null!=e&&"number"==typeof e.length&&"function"==typeof e.slice}function obj_inherit(e){"function"==typeof e&&(e=e.prototype);for(var t,n,r,o=1,i=arguments.length;i>o;o++){t="function"==typeof arguments[o]?arguments[o].prototype:arguments[o];for(n in t)r=Object.getOwnPropertyDescriptor(t,n),null!=r&&(r.hasOwnProperty("value")?e[n]=r.value:Object.defineProperty(e,n,r))}return e}function obj_extend(e,t){if(null==e&&(e={}),null==t)return e;var n,r;for(n in t)r=t[n],null!=r&&(e[n]=t[n]);return e}function obj_getProperty(e,t){for(var n=e,r=t.split("."),o=-1,i=r.length;null!=n&&++o<i;)n=n[r[o]];return n}function fn_isFunction(e){return"function"==typeof e}function fn_empty(){return!1}var regexpWhitespace=/\s/g,regexpEscapedChar={"'":/\\'/g,'"':/\\"/g,"{":/\\\{/g,">":/\\>/g,";":/\\>/g},hasOwnProp={}.hasOwnProperty,listeners=null,__cfg={allowCache:!0},_Array_slice=Array.prototype.slice;Template.prototype={skipWhitespace:function(){for(var e=this.template,t=this.index,n=this.length;n>t&&!(e.charCodeAt(t)>32);t++);return this.index=t,this},skipToAttributeBreak:function(){var e,t=this.template,n=this.index,r=this.length;do if(e=t.charCodeAt(++n),35===e&&123===t.charCodeAt(n+1))return this.index=n,this.sliceToChar("}"),void this.index++;while(46!==e&&35!==e&&62!==e&&123!==e&&32!==e&&59!==e&&r>n);this.index=n},sliceToChar:function(e){for(var t,n,r=this.template,o=this.index,i=o,l=!1;(n=r.indexOf(e,o))>-1&&(o=n,92===r.charCodeAt(o-1));)l=!0,o++;return t=r.substring(i,o),this.index=o,l?t.replace(regexpEscapedChar[e],e):t}};var is_Function,is_Array;!function(){is_Function=function(e){return"function"==typeof e},is_Array=function(e){return null!=e&&"object"==typeof e&&"number"==typeof e.length&&"function"==typeof e.splice}}();var obj_extend,obj_getProperty,obj_getPropertyEx,obj_toDictionary;!function(){function e(e,t,n,r){for(var o=e;r>n&&null!=o;)o=o[t[n]],n++;return o}obj_extend=function(e,t){null==e&&(e={});for(var n in t)hasOwnProp.call(t,n)!==!1&&(e[n]=t[n]);return e},obj_getProperty=function(e,t){if("."===t)return e;for(var n=e,r=t.split("."),o=-1,i=r.length;null!=n&&++o<i;)n=n[r[o]];return n},obj_getPropertyEx=function(t,n,r,o){if("."===t)return n;var i,l=t.split("."),s=n,u=-1,a=l.length,c=l[0];for("$c"===c?(s=o,u++):"$a"===c?(s=o&&o.attr,u++):"$u"===c?(s=customUtil_$utils,u++):"$ctx"===c&&(s=r,u++),i=u;null!=s&&++u<a;)s=s[l[u]];if(null==s&&-1===i)for(var f;;){if(null==o)break;if(f=o.scope,null!=f&&(s=e(f,l,0,a),null!=s))return s;o=o.parent}return s},obj_toDictionary=function(e){var t,n=[],r=0;for(t in e)n[r++]={key:t,value:e[t]};return n}}();var compo_renderMode_SERVER=1,compo_renderMode_CLIENT=2,compo_renderMode_BOTH=3,compo_getMetaInfo,compo_getRenderMode;!function(){compo_getMetaInfo=function(e){if(null==e)return{};var t,n="function"==typeof e?e.prototype:e;return t=n.$meta||{},t.mode=compo_getRenderMode(e),t},compo_getRenderMode=function(e){if(null==e)return compo_renderMode_BOTH;var t="function"==typeof e?e.prototype:e,n=t.$meta&&t.$meta.mode||t.mode;if("number"==typeof n)return n;if(null==n||"both"===n)return compo_renderMode_BOTH;var r=-1!==n.indexOf("server"),o=-1!==n.indexOf("client");return r&&o?compo_renderMode_BOTH:r?compo_renderMode_SERVER:compo_renderMode_CLIENT}}();var ExpressionUtil=function(){function e(e){for(var t,n,r=!1,o=39===e?"'":'"',i=u;(t=l.indexOf(o,u))>-1&&(u=t,92===l.charCodeAt(t-1));)r=!0,u++;return n=l.substring(i,u),r===!0&&(n=n.replace(regexpEscapedChar[o],o)),n}function t(){for(var e,t,n=u;;){if(e=l.charCodeAt(u),46===e){if(t===!0)return rt("Unexpected punc"),null;t=!0}if(!((e>=48&&57>=e||46===e)&&a>u))break;u++}return+l.substring(n,u)}function n(){var t,n=u,r=l.charCodeAt(u);if(34===r||39===r)return u++,t=e(r),u++,t;for(;;){if(u===a)break;if(r=l.charCodeAt(u),36!==r){if(!(r>47&&58!==r&&60!==r&&61!==r&&62!==r&&63!==r&&124!==r))break;u++}else u++}return l.substring(n,u)}function r(e){if(null==e&&u===a)return null;switch(e){case 40:return S;case 41:return A;case 44:return E;case 46:return T;case 43:return h;case 45:return f;case 42:return p;case 47:return d;case 37:return g;case 61:return l.charCodeAt(++u)!==e?(rt("Not supported (Apply directive) - view can only access model/controllers"),null):l.charCodeAt(u+1)===e?(u++,_):b;case 33:return 61===l.charCodeAt(u+1)?(u++,61===l.charCodeAt(u+1)?(u++,w):x):y;case 62:return 61===l.charCodeAt(u+1)?(u++,j):C;case 60:return 61===l.charCodeAt(u+1)?(u++,k):N;case 38:return l.charCodeAt(++u)!==e?(rt("Single Binary Operator AND"),null):v;case 124:return l.charCodeAt(++u)!==e?(rt("Single Binary Operator OR"),null):m;case 63:return D;case 58:return R}return e>=65&&90>=e||e>=97&&122>=e||95===e||36===e?M:e>=48&&57>=e?P:34===e||39===e?I:(rt("Unexpected / Unsupported directive"),null)}function o(o){l=o,u=0,a=o.length,s=new V;var i,c,O=s,F=B;e:for(;;)if(a>u&&(i=l.charCodeAt(u))<33)u++;else{if(u>=a)break;if(c=r(i),null==c&&a>u)break;switch(c){case S:O=nt(O,new K(O)),O=nt(O,new V(O)),u++;continue;case A:var H=L;F===J&&(F=B,H=U);do O=O.parent;while(null!=O&&O.type!==H);if(H===L&&(O=O.parent),null==O){rt("OutOfAst Exception - body closed");break e}u++;continue;case E:if(F!==J){F=B;do O=O.parent;while(null!=O&&O.type!==L);if(u++,null==O){rt("Unexpected punctuation, comma");break e}continue}do O=O.parent;while(null!=O&&O.type!==U);if(null==O){rt("OutOfAst Exception - next argument");break e}O=O.newArgument(),u++;continue;case D:s=new et(s),O=s.case1,u++;continue;case R:O=s.case2,u++;continue;case T:i=l.charCodeAt(u+1),i>=48&&57>=i?c=P:(c=M,u++)}if(O.type===L&&(O=nt(O,new K(O))),f!==c&&y!==c||null!=O.body)switch(c){case f:case h:case p:case d:case g:case v:case m:case b:case _:case x:case w:case C:case j:case N:case k:for(;O&&O.type!==$;)O=O.parent;if(null==O.body){rt("Unexpected operator",O);break e}O.join=c;do O=O.parent;while(null!=O&&O.type!==L);null==O&&console.error("Unexpected parent",O),u++;continue;case I:case P:if(null!=O.body&&null==O.join){rt("Directive Expected");break e}I===c&&(u++,nt(O,new G(e(i))),u++),P===c&&nt(O,new G(t(i)));continue;case M:var z=n();if("null"===z&&(z=null),"false"===z&&(z=!1),"true"===z&&(z=!0),"string"!=typeof z){nt(O,new G(z));continue}for(;a>u;){i=l.charCodeAt(u);{if(!(33>i))break;u++}}if(40===i){F=J,u++;var q=nt(O,new W(O,z));O=q.newArgument();continue}O=nt(O,new Q(O,z))}else O=nt(O,new Z(O,c)),u++}return null==O.body&&O.type===$&&rt("Unexpected end of expression"),tt(s),s}function i(e,t,n,r){var l,s;if(null==e)return null;if("."===e)return t;s="string"==typeof e?c.hasOwnProperty(e)===!0?c[e]:c[e]=o(e):e;var u,a,O,S=s.type;if(L===S){var A,E;e:for(u=0,O=s.body.length;O>u;u++)if(a=s.body[u],A=i(a,t,n,r),null!=E&&null!=E.join){if(E.join===v)if(l)l=A;else for(;O>u&&s.body[u].join!==m;u++);if(E.join===m){if(l)break e;if(A){l=A;break e}}switch(E.join){case f:l-=A;break;case h:l+=A;break;case d:l/=A;break;case p:l*=A;break;case g:l%=A;break;case x:l=l!=A;break;case w:l=l!==A;break;case b:l=l==A;break;case _:l=l===A;break;case C:l=l>A;break;case j:l=l>=A;break;case N:l=A>l;break;case k:l=A>=l}E=a}else E=a,l=A}if($===S)return i(s.body,t,n,r);if(H===S)return s.body;if(F===S||U===S)return ot(s,t,n,r);if(z===S)switch(l=i(s.body,t,n,r),s.prefix){case f:l=-l;break;case y:l=!l}return q===S&&(l=i(s.body,t,n,r),l=i(l?s.case1:s.case2,t,n,r)),l}var l,s,u=0,a=0,c={},f="-",h="+",d="/",p="*",g="%",m="||",v="&&",y="!",b="==",_="===",x="!=",w="!==",C=">",j=">=",N="<",k="<=",O=".",S=20,A=21,E=22,T=23,D=24,R=25,M=30,I=31,P=32,L=1,$=2,F=3,U=4,H=6,z=9,q=10,B=1,J=2,X={};X[O]=1,X[d]=2,X[p]=2,X[f]=3,X[h]=3,X[C]=4,X[j]=4,X[N]=4,X[k]=4,X[b]=5,X[_]=5,X[x]=5,X[w]=5,X[v]=6,X[m]=6;var V,K,G,W,Q,Y,Z,et;!function(){V=function(e){this.parent=e,this.type=L,this.body=[],this.join=null},K=function(e){this.parent=e},K.prototype={constructor:K,type:$,join:null,body:null},G=function(e){this.type=H,this.body=e,this.join=null},W=function(e,t){this.parent=e,this.type=U,this.body=t,this.arguments=[],this.next=null},W.prototype={constructor:W,newArgument:function(){var e=new V(this);return this.arguments.push(e),e}},Q=function(e,t){this.parent=e,this.type=F,this.body=t,this.next=null},Y=function(e,t){this.parent=e,this.body=t,this.next=null},Z=function(e,t){this.parent=e,this.prefix=t},Z.prototype={constructor:Z,type:z,body:null},et=function(e){this.body=e,this.case1=new V(this),this.case2=new V(this)},et.prototype={constructor:et,type:q,case1:null,case2:null}}();var tt,nt;!function(){function e(e){if(0===e.length)return null;var t=new V(e[0].parent);return t.join=e[e.length-1].join,t.body=e,t}nt=function(e,t){null==e&&console.error("<Mask:Ast> Current undefined",t);var n=e.type;return L===n?(e.body.push(t),t):$===n||z===n?e.body=t:F===n||U===n?e.next=t:(console.error("Unsupported - append:",e,t),t)},tt=function(t){if(t.type!==L)return void(null!=t.body&&"object"==typeof t.body&&tt(t.body));for(var n,r,o,i=t.body,l=0,s=i.length;s>l;l++)tt(i[l]);for(l=1;s>l&&(n=i[l],r=i[l-1],!(X[r.join]>X[n.join]));l++);if(l!==s){for(o=[i[0]],l=1;s>l;l++){n=i[l],r=i[l-1];var u=X[r.join];if(u>X[n.join]&&s-1>l){for(var a,c,f=l;++l<s&&(a=i[l].join,null!=a)&&!(u<=X[a]););c=i.slice(f,l+1),n=e(c),tt(n)}o.push(n)}t.body=o}}}();var rt,ot;!function(){ot=function(e,t,n,r){var o,l,s,u,a,c=e,f=e.body;if("$c"===f){l=r;var h=c.next,d=null!=h&&h.body;if(null!=d&&null==l[d])if(h.type===U&&"function"==typeof Compo.prototype[d])o=r,l=Compo.prototype[d],c=h;else for(;;){if(l=l.parent,null==l)break;if(null!=l[d]){o=l,l=l[d],c=h;break}}}else if("$a"===f)l=r&&r.attr;else if("$u"===f)l=customUtil_$utils;else if("$ctx"===f)l=n;else if(null!=t&&(o=t,l=t[f]),null==l)for(;null!=r&&(o=r.scope,null!=o&&(l=o[f]),null==l);)r=r.parent;if(null!=l)for(;;){if(c.type===U){for(s=[],u=-1,a=c.arguments.length;++u<a;)s[u]=i(c.arguments[u],t,n,r);l=l.apply(o,s)}if(null==l||null==c.next)break;if(c=c.next,f=c.body,o=l,l=l[f],null==l)break}return null==l&&(null==c||null!=c.next)&&rt("Mask - Accessor error - ",f),l},rt=function(e,t){console.error("Expression parser:",e,t,l.substring(u))}}();var it=function(){function e(r){if(null==r)return null;var o,i;if(L===r.type)for(var l=0,u=r.body.length;u>l;l++)i=e(r.body[l]),o=t(o,i);if(F===r.type){for(var a=r.body,c=r.next;null!=c;){if(U===c.type)return e(c);if(F!==c.type)return console.error("Ast Exception: next should be a symbol/function ref"),null;a+="."+c.body,c=c.next}return a}switch(r.type){case $:case z:case q:i=e(r.body),o=t(o,i)}if(q===r.type&&(i=e(s.case1),o=t(o,i),i=e(s.case2),o=t(o,i)),U===r.type){for(var l=0,u=r.arguments.length;u>l;l++)i=e(r.arguments[l]),o=t(o,i);i=null;var f=r;e:for(;f=f.parent;)switch(f.type){case F:i=f.body+(null==i?"":"."+i);break;case L:case $:break e;default:i=null;break e}null!=i&&(o=t(o,i)),r.next&&(i=e(r.next),o=t(o,{accessor:n(r),ref:i}))}return o}function t(e,t){if(null==e)return t;if(null==t)return e;if(("object"!=typeof e||null==e.length)&&(e=[e]),"object"!=typeof t||null==t.length)return-1===e.indexOf(t)&&e.push(t),e;for(var n=0,r=t.length;r>n;n++)-1===e.indexOf(t[n])&&e.push(t[n]);return e}function n(e){var t=e;e:for(;t.parent;){switch(t.parent.type){case L:case $:break e}t=t.parent}return r(t,e.next)}function r(e,t){if(e===t||null==e)return null;if("object"!=typeof e)return e;if(null!=e.length&&"function"==typeof e.splice){for(var n=[],o=0,i=e.length;i>o;o++)n[o]=r(e[o],t);return n}var l={};for(var s in e)null!=e[s]&&"parent"!==s&&(l[s]=r(e[s],t));return l}return function(t){return"string"==typeof t&&(t=o(t)),e(t)}}();return{parse:o,eval:i,varRefs:it,evalStatements:function(e,t,n,r){for(var l=o(e).body,s=[],u=l.length,a=-1;++a<u;)s[a]=i(l[a],t,n,r);return s}}}(),custom_Utils,custom_Statements,custom_Attributes,custom_Tags,custom_Tags_defs,customUtil_get,customUtil_$utils,customUtil_register,customTag_register;!function(){function e(){custom_Utils={expression:function(e,t,n,r,o){return ExpressionUtil.eval(e,t,n,o)}},custom_Statements={},custom_Attributes={"class":null,id:null,style:null,name:null,type:null},custom_Tags={div:null,span:null,input:null,button:null,textarea:null,select:null,option:null,h1:null,h2:null,h3:null,h4:null,h5:null,h6:null,a:null,p:null,img:null,table:null,td:null,tr:null,pre:null,ul:null,li:null,ol:null,i:null,b:null,strong:null,form:null},custom_Tags_defs={}}e(),function(e){function t(e){function t(e,t){this.tagName=e.tagName,this.attr=e.attr,this.expression=e.expression,this.nodes=e.nodes,this.nextSibling=e.nextSibling,this.parent=t,this.components=null}return t.prototype=e,t}customTag_register=function(n,r){null!=r&&"object"==typeof r&&(r.__Ctor=t(r)),e[n]=r}}(custom_Tags),function(e){function t(e){return"parsed"!==e.arguments?fn_proxy(e.process||n,e):r(e.process)}function n(e,t,n,r,o,i,l){return"node"===l?(this.nodeRenderStart(e,t,n,r,o),this.node(e,t,n,r,o)):(this.attrRenderStart(e,t,n,r,o,i),this.attr(e,t,n,r,o,i))}function r(e){return function(t,n,r,o,i){var l=ExpressionUtil.evalStatements(t,n,r,i);return e.apply(null,l)}}customUtil_$utils={},customUtil_register=function(n,r){return is_Function(r)?void(e[n]=r):(e[n]=t(r),void("parsed"===r.arguments&&(customUtil_$utils[n]=r.process)))},customUtil_get=function(t){return null!=t?e[t]:e}}(custom_Utils)}();var Dom;!function(){function e(e){if(null==this.nodes)return void(this.nodes=[e]);this.nodes.push(e);var t=this.nodes[this.nodes.length-2];t.nextSibling=e}function t(e,t){this.type=Dom.NODE,this.tagName=e,this.parent=t,this.attr={}}function n(e,t){this.content=e,this.parent=t}function r(e,t,n){this.tagName=e,this.parent=t,this.controller=n,this.attr={}}function o(){}var i=1,l=2,s=3,u=4,a=9,c=10,f=15;t.prototype={constructor:t,type:i,tagName:null,parent:null,attr:null,nodes:null,expression:null,appendChild:e,__single:null},n.prototype={type:l,content:null,parent:null},r.prototype={constructor:r,type:u,parent:null,attr:null,controller:null,nodes:null,components:null,model:null,modelRef:null},o.prototype={constructor:o,type:s,nodes:null,appendChild:e},Dom={NODE:i,TEXTNODE:l,FRAGMENT:s,COMPONENT:u,CONTROLLER:a,SET:c,STATEMENT:f,Node:t,TextNode:n,Fragment:o,Component:r}}();var parser_parse,parser_ensureTemplateFunction,parser_setInterpolationQuotes,parser_cleanObject,Parser;!function(e,t,n){function r(e){for(var t=-1;-1!==(t=e.indexOf(s,t))&&e.charCodeAt(t+1)!==f;)t++;if(-1===t)return e;for(var n,r=[],o=0,i=0;;){if(n=e.indexOf(a,t+2),-1===n)break;for(r[i++]=o===t?"":e.substring(o,t),r[i++]=e.substring(t+2,n),o=t=n+1;-1!==(t=e.indexOf(s,t))&&e.charCodeAt(t+1)!==f;)t++;if(-1===t)break}return o<e.length&&(r[i]=e.substring(o)),e=null,function(e,t,n,o,i,l){if(null==e){for(var c,f="",h=r.length,d=-1;++d<h;)c=r[d],f+=d%2===1?s+u+c+a:c;return f}return util_interpolate(r,e,t,n,o,i,l)}}function o(e,t,n,r){var o={2:"tag",3:"tag",5:"attribute key",6:"attribute value",8:"literal"}[n],i=e.substring(0,t).split("\n"),l=i.length,s=i[l-1].length,u=["Mask - Unexpected:",r,"at(",l,":",s,") [ in",o,"]"];console.error(u.join(" "),{stopped:e.substring(t),template:e})}var i,l,s="~",u="[",a="]",c=126,f=91,h=93;!function(){i=function(e,t,n,r,i){for(var s,u=0;n>t;t++)if(s=e.charCodeAt(t),34!==s)if(s!==r){if(s===i&&-1===--u)return t}else u++;else t=l(e,t+1,n,'"');return o(e,t,null,"Not closed brackets `"+String.fromCharCode(r)+"`"),t},l=function(e,t,n,r){for(var o;-1!==(o=e.indexOf(r,t))&&(t=o,92===e.charCodeAt(o-1));)t++;return t}}();var d=2,p=3,g=5,m=6,v=7,y=8,b=9;Parser={parse:function(l){for(var s,u,a,_,x,w,C,j,N=new n,k=N,O=d,S=p,A=0,E=l.length;;)if(E>A&&(w=l.charCodeAt(A))<33)A++;else{if(47===w){if(j=l.charCodeAt(A+1),47===j){for(A++;10!==w&&13!==w&&E>A;)w=l.charCodeAt(++A);continue}if(42===j){A=l.indexOf("*/",A+2)+2,1===A&&(console.warn("<mask:parse> block comment has no end"),A=E);continue}}if(S===g&&(null!=s&&(N.attr["class"]=r(s),s=null),null!=a&&(N.attr[a]=a,a=null,u=null)),null!=u){if(O===g)null==a?a=u:_=u,null!=a&&null!=_&&("class"!==a?N.attr[a]=_:s=null==s?_:s+" "+_,a=null,_=null);else if(S===p)x=new e(u,N),N.appendChild(x),N=x,O=g;else if(S===y){if(x=new t(u,N),N.appendChild(x),N.__single===!0)do N=N.parent;while(null!=N&&null!=N.__single);O=d}u=null}if(A>=E){O===g&&(null!=s&&(N.attr["class"]=r(s)),null!=a&&(N.attr[a]=a));break}if(O===b){for(N=N.parent;null!=N&&null!=N.__single;)N=N.parent;O=d}switch(w){case 123:S=O,O=d,A++;continue;case 62:S=O,O=d,A++,N.__single=!0;continue;case 59:if(null!=N.nodes){A++;continue}case 125:A++,S=O,O=b;continue;case 39:case 34:O===m?O=g:S=O=y,A++;var T,D=!1,R=!1,M=39===w?"'":'"';for(C=A;(T=l.indexOf(M,A))>-1&&(A=T,92===l.charCodeAt(T-1));)D=!0,A++;C===A&&(j=l.charCodeAt(A+1),(124===j||j===w)&&(R=!0,C=A+2,A=T=l.indexOf((124===j?"|":M)+M+M,C),-1===A&&(A=E))),u=l.substring(C,A),D===!0&&(u=u.replace(regexpEscapedChar[M],M)),u=r(u),A+=R?3:1;continue}if(O===d){if(S=p,O=p,46===w||35===w){u="div";continue}}else if(O===g)if(46===w)A++,a="class",O=v;else if(35===w)A++,a="id",O=v;else{if(61===w){A++,O=m;continue}if(40===w){C=1+A,A=1+i(l,C,E,w,41),N.expression=l.substring(C,A-1),N.type=Dom.STATEMENT;continue}if(null!=a){u=a;continue}}(O===m||O===v)&&(S=O,O=g);var I=null;for(C=A;E>A;){if(w=l.charCodeAt(A),w===c&&l.charCodeAt(A+1)===f){I=!0,++A;do w=l.charCodeAt(++A);while(w!==h&&E>A)}if(39===w||34===w||47===w||60===w||44===w){o(l,A,O,String.fromCharCode(w));break
}if(S!==m&&(46===w||35===w))break;if(33>w||61===w||62===w||59===w||40===w||123===w||125===w)break;A++}if(u=l.substring(C,A),!u){o(l,A,O,"<empty token>");break}if(I===!0&&O===p){o(l,A,O,"Tag Names cannt be interpolated (in dev)");break}I===!0&&(O===g&&"class"===a)==!1&&(u=r(u))}return null!=N.parent&&N.parent!==k&&N.parent.__single!==!0&&null!=N.nodes&&console.warn("Mask - ",N.parent.tagName,JSON.stringify(N.parent.attr),"was not proper closed."),null!=k.nodes&&1===k.nodes.length?k.nodes[0]:k},cleanObject:function(e){if(e instanceof Array){for(var t=0;t<e.length;t++)this.cleanObject(e[t]);return e}return delete e.parent,delete e.__single,null!=e.nodes&&this.cleanObject(e.nodes),e},setInterpolationQuotes:function(e,t){return e&&2===e.length?t&&1===t.length?(c=e.charCodeAt(0),f=e.charCodeAt(1),h=t.charCodeAt(0),s=e[0],u=e[1],void(a=t)):void console.error("Interpolation End must be of 1 Character"):void console.error("Interpolation Start must contain 2 Characters")},ensureTemplateFunction:r},parser_parse=Parser.parse,parser_ensureTemplateFunction=Parser.ensureTemplateFunction,parser_cleanObject=Parser.cleanObject,parser_setInterpolationQuotes=Parser.setInterpolationQuotes}(Dom.Node,Dom.TextNode,Dom.Fragment,Dom.Component),function(){function e(e,t,n,r){function o(e){return ExpressionUtil.eval(e,t,n,r)}if(o(e.expression))return e.nodes;for(;;){if(e=e.nextSibling,null==e||"else"!==e.tagName)break;var i=e.expression;if(null==i||""===i||o(i))return e.nodes}return null}custom_Statements["if"]={getNodes:e,render:function(t,n,r,o,i,l){var s=e(t,n,r,i);null!=s&&builder_build(s,n,r,o,i,l)}}}(),function(){function e(e,n,r,o,i,l,s,u){builder_build(t(r,e,n[0],n[1],n[2]),o,i,l,s,u)}function t(e,t,o,i,l){return"of"===l?is_Array(t)===!1?(console.warn("<ForStatement> Value is not enumerable",t),null):n(e,t,o,i):"in"===l?"object"!=typeof t?(console.warn("<ForStatement> Value is not an object",t),null):(is_Array(t)&&console.log("<mask:for> Consider to use `for..of` for Arrays"),r(e,t,o,i)):void 0}function n(e,t,n,r){for(var i,l=-1,s=t.length,u=new Array(s);++l<s;)i={},i[n]=t[l],r&&(i[r]=l),u[l]=o("for..of/item",e,i);return u}function r(e,t,n,r){var i,l,s,u=[],a=0;for(l in t)s=t[l],i={},i[n]=l,r&&(i[r]=s),u[a++]=o("for..in/item",e,i);return u}function o(e,t,n){return{type:Dom.COMPONENT,tagName:e,nodes:t,controller:{compoName:e,scope:n,renderEnd:l}}}function i(e,t){return{compoName:e,scope:t,renderEnd:l}}function l(e){this.elements=e}function s(e){f=e,d=e.length,h=0;var t,n,r,o,i;if(i=u(),40===i&&(o=!0,h++,u()),t=a(),i=u(),44===i){if(o!==!0)return c("Parenthese must be used in multiple var declarion");h++,u(),n=a()}if(o){if(i=u(),41!==i)return c("Closing parenthese expected");h++}i=u();var r;return 105===i&&110===f.charCodeAt(++h)&&(r="in"),111===i&&102===f.charCodeAt(++h)&&(r="of"),null==r?c("Invalid FOR statement. (in|of) expected"):(p[0]=t,p[1]=n,p[2]=r,p[3]=f.substring(++h),p)}function u(){for(var e;d>h;h++)if(e=f.charCodeAt(h),!(33>e))return e;return-1}function a(){for(var e,t=h;d>h;h++)if(e=f.charCodeAt(h),e>48&&57>e){if(t===h)return c("Variable name begins with a digit")}else if(!(36===e||95===e||e>=97&&122>=e||e>=65&&90>=e))break;return t===h?c("Variable declaration expected"):f.substring(t,h)}function c(e){throw new Error("<ForStatement parser> "+e+" `"+f.substring(h,20)+"`")}custom_Statements["for"]={render:function(t,n,r,o,i,l){s(t.expression);var u=ExpressionUtil.eval(p[3],n,r,i);null!=u&&e(u,p,t.nodes,n,r,o,i,l)},build:e,parseFor:s,createForItem:o,getNodes:t,getHandler:function(e,t){return i(e,t)}};var f,h,d,p=["prop1","prop2","in|of","expression"]}(),function(){function e(e,n,r,o,i,l){for(var s,u=n.length,a=-1,c=e;++a<u;)s=t(a,c,i),builder_build(c,n[a],r,o,s,l),null!=s.components&&arr_pushMany(i.components,s.components)}function t(e,t,n){return{type:Dom.COMPONENT,compoName:"each::item",scope:{index:e},parent:n,nodes:t,model:null,attr:null,components:null,elements:null,ID:null}}custom_Statements.each={render:function(t,n,r,o,i,l){var s=ExpressionUtil.eval(t.expression,n,r,i);null!=s&&e(t.nodes,s,r,o,i,l)},createItem:t,build:e}}(),custom_Statements["with"]={render:function(e,t,n,r,o,i){var l=ExpressionUtil.eval(e.expression,t,n,o);builder_build(e.nodes,l,n,r,o,i)}},function(){function e(e,n,r,o,i){if(null==n)return null;for(var l,s,u,a,c=n.length,f=-1;++f<c;)if(l=n[f],"default"!==l.tagName)if("case"===l.tagName)if(s=l.expression){if(t(s,r,o,i)==e){//! `==` comparison
u=l;break}}else console.warn("<mask:switch:case> Expression expected");else console.warn("<mask:switch> Case expected",l.tagName);else a=l;return null==u&&(u=a),null!=u?u.nodes:null}var t=ExpressionUtil.eval;custom_Statements["switch"]={render:function(n,r,o,i,l,s){var u=t(n.expression,r,o,l),a=e(u,n.nodes,r,o,l);null!=a&&builder_build(a,r,o,i,l,s)},getNodes:e}}(),function(){function e(e){this.parent=e,this.compoName="include",this.components=[],this.templates=null}custom_Statements.include={render:function(t,n,r,o,i,l){for(var s,u=ExpressionUtil.evalStatements(t.expression);null!=i&&(s=i.resource,null==s);)i=i.parent;var a=new e(i),c=Compo.pause(a,r);include.instance(s&&s.url).load.apply(s,u).done(function(e){a.templates=e.load,builder_build(t.nodes,n,r,o,a,l),c()})}}}(),custom_Statements["import"]={render:function(e,t,n,r,o,i){var l=e.expression,s=ExpressionUtil.evalStatements(l,t,n,o),u=s[0];if("string"!=typeof u)return void console.error("<mask:import> Invalid argument",l);for(;;){if("include"==o.compoName)break;if(o=o.parent,null==o)break}if(null!=o){var a=o.templates[u];null!=a&&builder_build(Parser.parse(a),t,n,r,o,i)}}};var builder_build=function(){function e(e,o,i,l){if(l=t(l),null==l.components||0===l.components.length)return e.toString();var s=e.firstChild,u=n(s),a={model:i._model.stringify(),ID:i._id},c={type:"m"},f=Meta.stringify(a,c),h=Meta.close(a,c);if(u){var d=r(u,"HTML");if(d){var p=r(d,"BODY");p?(p.insertBefore(new v(f),p.firstChild),p.appendChild(new v(h))):console.warn("Body not found")}return e.toString()}return f+e.toString()+h}function t(e,n){if(null==n&&(n={}),n.compoName=e.compoName,n.ID=e.ID,e.components){for(var r,o=[],i=e.components,l=0,s=i.length;s>l;l++)r=i[l],o.push(t(r));n.components=o}return n}function n(e,t){if(null==e)return null;if(e instanceof p==!1)return null;if(":document"===e.compoName)return e;if(null==t&&(t=0),4===t)return null;var r;return r=n(e.nextSibling,t),r?r:n(e.firstChild,++t)}function r(e,t){for(var n=e.firstChild;n&&n.tagName!==t;)n=n.nextSibling;return n}function o(e,t){if("object"==typeof e)return e;var n,r,o,l,u,a,c,f,h,d=0,p=e.length;for(n="up"===t?k:O;p>d;)u=e.charCodeAt(d),33>u||(a=s(e,d+1,p),46===u?(r="class",o=S,l=i(e.substring(d+1,a))):35===u?(r="id",o=S,l=e.substring(d+1,a)):91===u?(f=e.indexOf("=",d),-1===f&&console.error('Attribute Selector: should contain "="'),o=S,r=e.substring(d+1,f),u=e.charCodeAt(f+1),h=34===u||39===u?2:1,l=e.substring(f+h,a-h+1),a++):(o=null,r="tagName",l=e.substring(d,a).toUpperCase()),d=a,null!=c?(null==c.filters&&(c.filters=[]),c.filters.push({key:r,selector:l,prop:o})):c={key:r,prop:o,selector:l,nextKey:n,filters:null});return c}function i(e){return function(t){return-1!==l(t,e)}}function l(e,t,n){if(null==e)return-1;if(null==n&&(n=0),n=e.indexOf(t,n),-1===n)return-1;if(n>0&&e.charCodeAt(n-1)>32)return l(e,t,n+1);var r=e.length,o=t.length;return r-o>n&&e.charCodeAt(n+o)>32?l(e,t,n+1):n}function s(e,t,n){for(var r,o=!1,i=!1;n>t&&(r=e.charCodeAt(t),(34===r||39===r)&&(o=!o),92===r&&(i=!i),!(46===r||35===r||91===r||93===r||33>r)||o===!0||i===!0);)t++;return t}function u(e,t){"string"==typeof t&&(t=o(t));var n=t.prop?e[t.prop]:e,r=!1;if(null==n)return!1;if("function"==typeof t.selector?r=t.selector(n[t.key]):null!=t.selector.test?t.selector.test(n[t.key])&&(r=!0):n[t.key]===t.selector&&(r=!0),r===!0&&null!=t.filters)for(var i,l=0,s=t.filters.length;s>l;l++)if(i=t.filters[l],u(e,i)===!1)return!1;return r}function a(){}function c(e){this.doctype=e}function f(){}function h(e){this.tagName=e.toUpperCase(),this.attributes={}}function d(e){this.textContent=e}function p(e,t,n,r,o){var i,l,s,u,a=e.compoName||e.tagName,c=custom_Tags[a]||e.controller;if(null!=c&&(u=is_Function(c)?c.prototype.cache:c.cache),null!=u&&(i=Cache.getCompo(t,n,a,c)),null!=i)return this.compo=i,void(i.__cached&&(i.render=fn_empty));null!=c&&(is_Function(c)&&(i=new c(t)),null==i&&is_Function(c.__Ctor)&&(i=new c.__Ctor(e,o)),null==i&&(i=c)),null==i&&(i={model:e.model,expression:e.expression,modelRef:e.modelRef,container:e.container,mode:o.mode,modeModel:o.modeModel}),i.cache&&Cache.cacheCompo(t,n,a,i),this.compo=i,this.node=e,this.ID=this.compo.ID=++n._id,b===o.mode&&(i.mode=b),_===o.mode&&(i.mode=b),l=obj_extend(i.attr,e.attr),void 0!==l["x-mode"]&&(i.mode=l["x-mode"]),void 0!==l["x-mode-model"]&&(i.modeModel=l["x-mode-model"]),this.compoName=i.compoName=a,i.attr=l,i.parent=o,n.debug&&n.debug.breakOn===i.compoName,null==i.nodes&&(i.nodes=e.nodes);for(s in l)"function"==typeof l[s]&&(l[s]=l[s]("attr",t,n,r,o,s));return"function"==typeof i.renderStart&&i.renderStart(t,n,r),o&&(o.components||(o.components=[])).push(i),i.async===!0?void i.await(g(i,t,n,this)):(null!=i.tagName&&i.tagName!==e.tagName&&(i.nodes={tagName:i.tagName,attr:i.attr,nodes:i.nodes,type:1}),void("function"==typeof i.render&&i.render(t,n,this,i)))}function g(e,t,n,r,o){var i=r.appendChild(document.createComment(""));return function(){return m(e,t,n,i,o)}}function m(e,t,n,r,o){null!=e.tagName&&e.tagName!==e.compoName&&(e.nodes={tagName:e.tagName,attr:e.attr,nodes:e.nodes,type:1}),null!=e.model&&(t=e.model);var i=e.nodes,l=[];if(null!=i){for(var s=is_Array(i),u=s===!0?i.length:1,a=0,c=null,f=document.createDocumentFragment();u>a;a++)c=s===!0?i[a]:i,1===c.type&&"server:all"!==e.mode&&(c.attr["x-compo-id"]=e.ID),y(c,t,n,f,e,l);r.parentNode.insertBefore(f,r)}if(null==e.tagName){var h,d=e.handlers&&e.handlers.attr;for(var p in e.attr)h=null,d&&is_Function(d[p])&&(h=d[p]),null==h&&is_Function(custom_Attributes[p])&&(h=custom_Attributes[p]),null!=h&&h(node,e.attr[p],t,n,l[0],e)}if(e.onRenderEndServer&&e.onRenderEndServer(l,t,n,r.parentNode),null!=o&&o!==l){var g=o.length,m=l.length;for(j=-1;++j<m;)o[g+j]=l[j]}}function v(e){this.textContent=e||"",this.textContent&&(this.textContent=this.textContent.replace("<!--","").replace("-->",""))}function y(e,t,n,r,o,i){if(null==e)return r;if(null!=n._redirect||null!=n._rewrite)return r;var l,s,u,a,c=e.type;if(null==c&&(is_Array(e)?c=10:null!=e.tagName?c=1:null!=e.content&&(c=2)),1==c&&null!=custom_Tags[e.tagName]&&(c=4),10===c){for(u=0,a=e.length;a>u;u++)y(e[u],t,n,r,o);return r}if("else"===e.tagName)return r;if(15===c){var f=custom_Statements[e.tagName];if(null==f){if(null==custom_Tags[e.tagName])return console.error("<mask: statement is undefined",e.tagName),r;c=4}if(15===c)return f.render(e,t,n,r,o,i),r}if(1===c&&(":"===e.tagName[0]?(c=4,e.mode=x,e.controller=mock_TagHandler.create(e.tagName,null,x)):(r=E(e,t,n,r,o,i),i=null)),2===c)return T(e,t,n,r,o),r;if(4===c){l=document.createComponent(e,t,n,r,o),r.appendChild(l),r=l;var h=l.compo;if(null!=h){if(h.model&&o.model!==h.model){t=h.model;var d=n._model.tryAppend(h);-1!==d&&(l.modelID=d)}if(h.async)return l;if(h.render)return l;o=h,e=h,s=[]}}var p=e.nodes;if(null!=p)for(var g,m=is_Array(p),v=m===!0?p.length:1,b=0;v>b;b++)g=m===!0?p[b]:p,4===c&&1===g.type&&"server:all"!==o.mode&&(g.attr["x-compo-id"]=l.ID),y(g,t,n,r,o,s);if(r.nodeType===Dom.COMPONENT&&o.onRenderEndServer&&o.async!==!0&&o.onRenderEndServer(s,t,n,r,o),null!=i&&s&&i!==s)for(var b=0,_=s.length;_>b;b++)i.push(s[b]);return r}var b="server:all",_="server:children",x="client",w="none",C=function(){function e(e,t){this._models={},this._id=t||0,this.append(e)}return e.prototype={append:function(e){if(null==e)return-1;var t="m"+ ++this._id;return this._models[t]=e,t},tryAppend:function(e){if(b===e.mode)return-1;if(w===e.modeModel)return-1;var t;void 0!==e.modelRef&&(t={__ref:e.modelRef}),null==t&&(t=e.model);var n="m"+ ++this._id;return this._models[n]=t,n},stringify:function(){return Class.stringify(this._models)}},e}();obj_extend(Dom,{DOCTYPE:11});var N={area:1,base:1,br:1,col:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,menuitem:1,meta:1,param:1,source:1,track:1,wbr:1},k="parentNode",O="firstChild",S="attributes";!function(){a.prototype={parentNode:null,firstChild:null,lastChild:null,nextSibling:null,get length(){for(var e=0,t=this.firstChild;null!=t;)e++,t=t.nextSibling;return e},get childNodes(){for(var e=[],t=this.firstChild;null!=t;)e.push(t),t=t.nextSibling;return e},querySelector:function(e){var t=e;"string"==typeof e&&(t=o(e));for(var n,r=this.firstChild;null!=r;r=r.nextSibling)if(u(r,t))return r;if(null!=r)return r;for(r=this.firstChild;null!=r;r=r.nextSibling)if("function"==typeof r.querySelector&&(n=r.querySelector(t),null!=n))return n;return null},appendChild:function(e){if(null==e)return e;if(e.nodeType===Dom.FRAGMENT){var t=e;if(null==t.firstChild)return t;for(var n=t.firstChild;;){if(n.parentNode=this,null==n.nextSibling)break;n=n.nextSibling}return null==this.firstChild?this.firstChild=t.firstChild:t.lastChild.nextSibling=t.firstChild,t.lastChild=t.lastChild,t}return null==this.firstChild?this.firstChild=this.lastChild=e:(this.lastChild.nextSibling=e,this.lastChild=e),e.parentNode=this,e},insertBefore:function(e,t){var n=this.firstChild;if(n!==t)for(;null!=n&&n.nextSibling!==t;)n=n.nextSibling;if(null==n)return this.appendChild(e);if(e.nodeType===Dom.FRAGMENT){var r=e,o=r.firstChild;if(null==o)return r;for(;null!=o;)o.parentNode=this,o=o.nextSibling;return n===t&&n===this.firstChild?(this.firstChild=r.firstChild,r.lastChild.nextSibling=n,r):(n.nextSibling=r.firstChild,r.lastChild.nextSibling=t,r)}return e.parentNode=this,n===t&&n===this.firstChild?(this.firstChild=e,e.nextSibling=n,e):(n.nextSibling=e,e.nextSibling=t,e)}}}(),c.prototype={constructor:c,nodeType:Dom.DOCTYPE,toString:function(){return this.doctype}},f.prototype=obj_inherit(f,a,{nodeType:Dom.FRAGMENT,toString:function(){for(var e=this.firstChild,t="";null!=e;)t+=e.toString(),e=e.nextSibling;return t}}),function(){function e(e){null==e.attributes,this.attr=e.attributes,this.className=this.attr["class"]||""}e.prototype={get length(){return this.className.split(/\s+/).length},contains:function(e){return-1!==l(this.className,e)},remove:function(e){var t=l(this.className,e);if(-1!==t){var n=this.className;this.className=this.attr["class"]=n.substring(0,t)+n.substring(t+e.length)}},add:function(e){-1===l(this.className,e)&&(this.className=this.attr["class"]=this.className+(""===this.className?"":" ")+e)}},h.prototype=obj_inherit(h,a,{nodeType:Dom.NODE,setAttribute:function(e,t){this.attributes[e]=t},getAttribute:function(e){return this.attributes[e]},get classList(){return new e(this)},toString:function(){var e,t,n=this.tagName.toLowerCase(),r=this.attributes,o="<"+n;for(var i in r)e=r[i],o+=" "+i+'="'+("string"==typeof e?e.replace(/"/g,"&quot;"):e)+'"';var l=1===N[n],t=this.firstChild;if(null==t)return o+(l?"/>":"></"+n+">");for(o+=l?"/>":">",l&&(o+="<!--~-->");null!=t;)o+=t.toString(),t=t.nextSibling;return l?o+"<!--/~-->":o+"</"+n+">"},get value(){return this.attributes.value},set value(e){this.attributes.value=e},get selected(){return this.attributes.selected},set selected(e){return e?void(this.attributes.selected="selected"):void delete this.attributes.selected},get checked(){return this.attributes.checked},set checked(e){return e?void(this.attributes.cheched="cheched"):void delete this.attributes.cheched}})}(),function(){d.prototype={constructor:d,nodeType:Dom.TEXTNODE,nextSibling:null,toString:function(){return this.textContent?e(this.textContent):""}};var e=function(){function e(e){return t[e]}var t={"&":"&amp;","'":"&#39;",'"':"&quot;","<":"&lt;",">":"&gt;"};return function(t){return t.replace(/[&"'\<\>]/g,e)}}()}(),p.prototype=obj_inherit(p,a,{nodeType:Dom.COMPONENT,compoName:null,instance:null,components:null,ID:null,toString:function(){var e=this.firstChild,t=this.compo;if(void 0!==t.__cached)return console.log("from Cache size: ",t.__cached.length),t.__cached;var n,r,o,i=compo_getMetaInfo(t),l=i.mode;null!=t&&(n=t.compoName,r=t.attr,l=t.mode,o=t.nodes);var s={ID:this.ID,modelID:this.modelID,compoName:n,attr:r,expression:t.expression,mask:"client"===l?mask.stringify(o,0):null,nodes:i.serializeNodes!==!0?null:(t.serializeNodes||mask.stringify)(this.node)},u={single:null==this.firstChild,type:"t",mode:l},a=Meta.stringify(s,u);if(null!=t.toHtml)a+=t.toHtml();else for(var e=this.firstChild;null!=e;)a+=e.toString(),e=e.nextSibling;return"client"!==l&&(a+=Meta.close(s,u)),t.cache&&(t.__cached=a),a}}),v.prototype={nextSibling:null,parentNode:null,toString:function(){return""===this.textContent?"":"<!--"+this.textContent.replace(/>/g,"&gt;")+"-->"}},document={createDocumentFragment:function(){return new f},createElement:function(e){return new h(e)},createTextNode:function(e){return new d(e)},createComment:function(e){return new v(e)},createComponent:function(e,t,n,r,o){return new p(e,t,n,r,o)}},function(){function e(){}custom_Tags[":document"]=e,e.prototype={isDocument:!0,mode:"server",render:function(e,t,n){var r=this.attr,o=this.nodes,i=r.doctype||"html";delete r.doctype,n.appendChild(new c("<!DOCTYPE "+i+">"));for(var l,s,u,a,f={tagName:"html",type:Dom.NODE,attr:r,nodes:[]},h=0,d=o.length;d>h;h++)a=o[h],"head"!==a.tagName?"body"!==a.tagName?u=!0:s=a:l=a;if(null==s&&(s={nodeType:Dom.NODE,tagName:"body",nodes:[]}),null!=l&&f.nodes.push(l),null!=s&&f.nodes.push(s),u)for(var a,h=0,d=o.length;d>h;h++)a=o[h],"head"!==a.tagName&&"body"!==a.tagName&&s.nodes.push(a);var p=this.parent;return p.components=[],y(f,e,t,n,p),n}}}();var A=function(){function e(n){if(null==n)return null;var r;if(n instanceof Array){r=[];for(var o=0,i=n.length;i>o;o++)r[o]=e(n[o]);return r}if("object"==typeof n){if(~t.indexOf(n))return"[object Circular]";t.push(n),r={};for(var l in n)r[l]=e(n[l]);return r}return n}var t;return function(n){return"object"==typeof n&&null!=n&&(t=[],n=e(n),t=null),n}}(),E=function(){var e=function(e){return function(t){try{return e.createElement(t)}catch(n){return console.error(t,"element cannot be created. If this should be a custom handler tag, then controller is not defined"),null}}}(document);return function(t,n,r,o,i,l){var s=t.tagName,u=t.attr,a=e(s);if(null!=a){null!=l&&(l.push(a),u["x-compo-id"]=i.ID),null!=o&&o.appendChild(a);var c,f;for(c in u)is_Function(u[c])?(f=u[c]("attr",n,r,a,i,c),f instanceof Array&&(f=f.join(""))):f=u[c],f&&(is_Function(custom_Attributes[c])?custom_Attributes[c](t,f,n,r,a,i,o):a.setAttribute(c,f));return a}}}(),T=function(){var e=function(e){return function(t,n){t.appendChild(e.createTextNode(n))}}(document);return function(t,n,r,o,i){var l=t.content;if(is_Function(l)){var s=l("node",n,r,o,i);if("string"==typeof s)return void e(o,s);for(var u,a="",c=s.length,f=0;c>f;f++)if(u=s[f],"object"!=typeof u)a+=u;else{if(""!==a&&(e(o,a),a=""),null==u.nodeType){a+=u.toString();continue}o.appendChild(u)}return void(""!==a&&e(o,a))}e(o,l)}}();return function(t,n,r,o,i){null==o&&(o=new f),null==i&&(i=new Dom.Component),null==r&&(r={_model:null,_ctx:null}),null==r._model&&(r._model=new C(n,Cache.modelID)),null==r._id&&(r._id=Cache.controllerID);var l;return y(t,n,r,o,i),r.async===!0?(r.done(function(){return r.page&&"tree"===r.page.query.debug?void r.resolve(JSON.stringify(A(o))):(l=e(o,n,r,i),void r.resolve(l))}),null):r.page&&"tree"===r.page.query.debug?JSON.stringify(A(o)):l=e(o,n,r,i)}}(),cache={},Mask={render:function(e,t,n,r,o){return null!=r&&"function"!=typeof r.appendChild&&(console.error(".render(template[, model, ctx, container, controller]","Container should implement .appendChild method"),console.warn("Args:",arguments)),"string"==typeof e&&(e=hasOwnProp.call(cache,e)?cache[e]:cache[e]=parser_parse(e)),null==n&&(n={}),builder_build(e,t,n,r,o)},compile:parser_parse,parse:parser_parse,build:builder_build,registerHandler:customTag_register,getHandler:function(e){return null!=e?custom_Tags[e]:custom_Tags},registerStatement:function(e,t){custom_Statements[e]=is_Function(t)?{render:t}:t},getStatement:function(e){return null!=e?custom_Statements[e]:custom_Statements},registerAttrHandler:function(e,t,n){is_Function(t)&&(n=t),custom_Attributes[e]=n},getAttrHandler:function(e){return null!=e?custom_Attributes[e]:custom_Attributes},registerUtil:customUtil_register,getUtil:customUtil_get,$utils:customUtil_$utils,registerUtility:function(e,t){console.warn("@registerUtility - deprecated - use registerUtil(utilName, mix)",e),this.registerUtility=this.registerUtil,this.registerUtility(e,t)},getUtility:function(e){return console.warn("@getUtility - deprecated - use getUtil(utilName)",e),this.getUtility=this.getUtil,this.getUtility()},clearCache:function(e){"string"==typeof e?delete cache[e]:cache={}},Utils:{Expression:ExpressionUtil,getProperty:obj_getProperty,ensureTmplFn:Parser.ensureTemplateFunction},Dom:Dom,plugin:function(source){eval(source)},on:function(e,t){null==listeners&&(listeners={}),(listeners[e]||(listeners[e]=[])).push(t)},delegateReload:function(){},setInterpolationQuotes:Parser.setInterpolationQuotes,setCompoIndex:function(e){builder_componentID=e},cfg:function(){var e=arguments;if(0===e.length)return __cfg;var t;if(2===e.length)return t=e[0],void(__cfg[t]=e[1]);var n=e[0];if("object"==typeof n)for(t in n)__cfg[t]=n[t]}};Mask.renderDom=Mask.render;var Meta,mock_TagHandler;!function(){function e(e,t){function n(e){this.tagName=e.tagName,this.compoName=e.tagName,this.attr=e.attr,this.expression=e.expression,this.nodes=e.nodes,this.nextSibling=e.nextSibling,this.parent=t,this.components=null}return n.prototype=e,n}Meta=function(){function e(t){return"string"!=typeof t?e(JSON.stringify(t)):t}function t(e){if("#"===i[r]){r++;var t=i.indexOf(s);-1===t&&(t=i.length),e.ID=parseInt(i.substring(r,t),10),r=t}}function n(e){if(r>o-5)return!1;if(i[r++]!==s||" "!==i[r++])return r=-1,!1;var t=r,n=i,l=n.indexOf(":",t),u=n.substring(t,l),a=n.indexOf(s+" ",l),c=n.substring(l+1,a);return"attr"===u&&(c=JSON.parse(c)),e[u]=c,r=a,!0}var r,o,i,l=30,s=String.fromCharCode(l),u="<!--",a="-->";return{stringify:function(t,n){switch(n.mode){case"server":case"server:all":return""}var r=n.type,o=n.single,i=u+r;t.ID&&(i+="#"+t.ID),i+=s+" ";for(var l in t)"ID"!==l&&null!=t[l]&&(i+=l+":"+e(t[l])+s+" ");return o&&(i+="/"),i+=a},close:function(e,t){switch(t.mode){case"server":case"server:all":return""}return u+"/"+t.type+(e.ID?"#"+e.ID:"")+a},parse:function(e){r=0,i=e,o=e.length;var l={},s=e[r];for("/"===s&&(l.end=!0,r++),l.type=e[r++],t(l);n(l););return-1===r?{}:("/"===e[o-1]&&(l.single=!0),l)}}}();var t=function(){function e(e,t,n){this.meta={ID:n,name:e,value:t}}return e.prototype={toString:function(){var e=this.meta,t={type:"a",single:!0};return Meta.stringify(e,t)}},{create:function(t,n,r){return function(o,i,l,s,u,a,c){return"server"!==r&&c.insertBefore(new e(t,i,++s._id),u),"client"!==r?n(o,i,l,s,u,a):""}}}}();mock_TagHandler=function(){function e(){}return e.prototype={render:function(){},mode:"client"},{create:function(t,n,r){return"client"===r||"client"===n.prototype.mode?e:(n.prototype.mode=r,n)}}}();var n=function(){function e(e,t,n,r,o){this.meta={ID:o,utilType:e,utilName:t,value:n,attrName:r}}e.prototype={toString:function(){for(var e=this.meta,t={type:"u",single:null==this.firstChild},n=Meta.stringify(e,t),r=this.firstChild;null!=r;)n+=r.toString(),r=r.nextSibling;return null!=this.firstChild&&(n+=Meta.close(this)),n}};var t={node:"nodeRenderStart",attr:"attrRenderStart"};return{create:function(n,r,o){return function(i,l,s,u,a,c,f){if("server"!==o&&(u.parentNode.insertBefore(new e(f,n,i,c,++s._id),u),"partial"===o)){var h=t[f];if(is_Function(r[h]))return r[h](i,l,s,u,a)}return"client"!==o?r(i,l,s,u,a,c,f):""}}}}(),r=Mask.registerUtil;Mask.registerAttrHandler=function(e,n,r){if(null==r)return void(custom_Attributes[e]=n);if("string"==typeof r){var o=n;n=r,r=o}custom_Attributes[e]=t.create(e,r,n)},Mask.registerUtil=function(e,t,o){null==o&&is_Object(t)&&(o=t.mode),r(e,null==o?t:n.create(e,t,o))},Mask.registerUtility=Mask.registerUtil,Mask.registerHandler=function(t,n){return null!=n&&"object"==typeof n&&(n.__Ctor=e(n)),custom_Tags_defs.hasOwnProperty(t)&&obj_extend(n.prototype,custom_Tags_defs[t]),compo_getRenderMode(n)===compo_renderMode_CLIENT?void(custom_Tags[t]=mock_TagHandler.create(t,n,"client")):void(custom_Tags[t]=n)},Mask.compoDefinitions=function(e,t,n){var r=custom_Tags,o=custom_Tags_defs;for(var i in e)o[i]=e[i],void 0===r[i]?r[i]=mock_TagHandler.create(i,null,"client"):obj_extend(r[i].prototype,e[i]);for(var l in t)"client"===t[l].mode&&Mask.registerUtil(l,function(){},"client");for(var l in n)"client"===n[l].mode&&Mask.registerAttrHandler(l,function(){},"client")}}();var Compo=exports.Compo=function(mask){function _mask_ensureTmplFn(e){return"string"!=typeof e?e:_mask_ensureTmplFnOrig(e)}function is_Function(e){return"function"==typeof e}function is_Object(e){return null!=e&&"object"==typeof e}function is_Array(e){return null!=e&&"object"==typeof e&&"number"==typeof e.length&&"function"==typeof e.splice}function is_String(e){return"string"==typeof e}function is_notEmptyString(e){return"string"==typeof e&&""!==e}function is_rawObject(e){return null==e?!1:"object"!=typeof e?!1:e.constructor===Object}function domLib_initialize(){null!=domLib&&null!=domLib.fn&&(domLib.fn.compo=function(e){if(0===this.length)return null;var t=Anchor.resolveCompo(this[0]);return null==e?t:find_findSingle(t,selector_parse(e,Dom.CONTROLLER,"up"))},domLib.fn.model=function(e){var t=this.compo(e);if(null==t)return null;for(var n=t.model;null==n&&t.parent;)t=t.parent,n=t.model;return n},function(){var e=["append","prepend","before","after"];arr_each(["appendMask","prependMask","beforeMask","afterMask"],function(t,n){domLib.fn[t]=function(r,o,i,l){if(0===this.length)return console.warn("<jcompo> $.",t,"- no element was selected(found)"),this;this.length>1&&console.warn("<jcompo> $.",t," can insert only to one element. Fix is comming ..."),null==i&&(i=2>n?this.compo():this.parent().compo()),null==i&&(i={},console.warn("$.***Mask - controller not found, this can lead to memory leaks if template contains compos")),null==i.components&&(i.components=[]);for(var s=i.components,u=s.length,a=mask.render(r,o,l,null,i),c=this[e[n]](a),f=s.length;f>u;u++)Compo.signal.emitIn(s[u],"domInsert");return c}})}(),function(){function e(e,t){node_tryDispose(t)}function t(e,t){node_tryDisposeChildren(t)}var n=domLib.fn.remove,r=domLib.fn.empty;domLib.fn.removeAndDispose=function(){return this.each(e),n.call(this)},domLib.fn.emptyAndDispose=function(){return this.each(t),r.call(this)}}())}function SlotHandler(){}var Dom=mask.Dom,_array_slice=Array.prototype.slice,_Array_splice=Array.prototype.splice,_Array_indexOf=Array.prototype.indexOf,_mask_ensureTmplFnOrig=mask.Utils.ensureTmplFn,domLib,Class;!function(){function e(){for(var e,n,r,o=arguments,i=t.length;--i>-1;)if(e=t[i],null!=e)for(r=o.length;--r>-1;)if(n=e[o[r]],null!=n)return n}var t=[global.atma,exports,global];domLib=e("jQuery","Zepto","$"),Class=e("Class")}(),null!=global.document&&null==domLib&&console.warn("jQuery-Zepto-Kimbo etc. was not loaded before MaskJS:Compo, please use Compo.config.setDOMLibrary to define dom engine"),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1});var obj_extend,obj_copy;!function(){obj_extend=function(e,t){if(null==e&&(e={}),null==t)return e;for(var n in t)e[n]=t[n];return e},obj_copy=function(e){var t,n={};for(t in e)n[t]=e[t];return n}}();var arr_each,arr_remove;!function(){arr_each=function(e,t){for(var n=e.length,r=-1;++r<n;)t(e[r],r)},arr_remove=function(e,t){if(null==e)return void console.error("Can not remove myself from parent",t);var n=e.indexOf(t);return-1===n?void console.error("Can not remove myself from parent",t,n):void e.splice(n,1)}}();var fn_proxy,fn_apply;!function(){fn_proxy=function(e,t){return function(){return fn_apply(e,t,arguments)}},fn_apply=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2]);case 4:return e.call(t,n[0],n[1],n[2],n[3])}return e.apply(t,n)}}();var selector_parse,selector_match;!function(){function e(e){return function(n){return t(n,e)}}function t(e,n,r){if("string"!=typeof e)return!1;if(null==r&&(r=0),r=e.indexOf(n,r),-1===r)return!1;if(r>0&&e.charCodeAt(r-1)>32)return t(e,n,r+1);var o=e.length,i=n.length;return o-i>r&&e.charCodeAt(r+i)>32?t(e,n,r+1):!0}selector_parse=function(t,n,r){if(null==t&&console.error("<compo>selector is undefined",n),"object"==typeof t)return t;var o,i,l;if(null==o)switch(t[0]){case"#":o="id",t=t.substring(1),i="attr";break;case".":o="class",t=e(t.substring(1)),i="attr";break;default:o=n===Dom.SET?"tagName":"compoName"}return l="up"===r?"parent":n===Dom.SET?"nodes":"components",{key:o,prop:i,selector:t,nextKey:l}},selector_match=function(e,t,n){is_String(t)&&(null==n&&(n=Dom[e.compoName?"CONTROLLER":"SET"]),t=selector_parse(t,n));var r=t.prop?e[t.prop]:e;return null==r?!1:is_Function(t.selector)?t.selector(r[t.key]):null!=t.selector.test?t.selector.test(r[t.key]):r[t.key]==t.selector}}();var find_findSingle;!function(){find_findSingle=function(e,t){if(is_Array(e)){for(var n,r=e.length,o=-1;++o<r;)if(n=find_findSingle(e[o],t),null!=n)return n;return null}return selector_match(e,t)?e:(e=e[t.nextKey],null==e?null:find_findSingle(e,t))}}();var dom_addEventListener,node_tryDispose,node_tryDisposeChildren;!function(){dom_addEventListener=function(e,t,n){return null!=EventDecorator&&(t=EventDecorator(t)),null!=domLib?domLib(e).on(t,n):null!=e.addEventListener?e.addEventListener(t,n,!1):void(e.attachEvent&&e.attachEvent("on"+t,n))},node_tryDispose=function(e){if(e.hasAttribute("x-compo-id")){var t=e.getAttribute("x-compo-id"),n=Anchor.getByID(t);if(n){if(null==n.$||1===n.$.length)return compo_dispose(n),void compo_detachChild(n);var r=_Array_indexOf.call(n.$,e);-1!==r&&_Array_splice.call(n.$,r,1)}}node_tryDisposeChildren(e)},node_tryDisposeChildren=function(e){for(var t=e.firstChild;null!=t;)1===t.nodeType&&node_tryDispose(t),t=t.nextSibling}}();var domLib_find,domLib_on;!function(){domLib_find=function(e,t){return e.filter(t).add(e.find(t))},domLib_on=function(e,t,n,r){return null==n?e.on(t,r):(e.on(t,n,r).filter(n).on(t,r),e)}}();var Children_={select:function(e,t){for(var n in t){var r=t[n],o=null,i=null;if(r instanceof Array&&(i=r[0],o=r.splice(1)),"string"==typeof r&&(i=r),null==r||null==i)return console.error("Unknown component child",n,t[n]),void console.warn("Is this object shared within multiple compo classes? Define it in constructor!");var l=i.indexOf(":"),s=i.substring(0,l);s=Compo.config.selectors[s],null==s?e.compos[n]=e.$[0].querySelector(i):(i=i.substring(++l).trim(),e.compos[n]=s(e,i));var u=e.compos[n];null!=o&&(null!=u.$&&(u=u.$),Events_.on(e,o,u))}}},Events_={on:function(e,t,n){null==n&&(n=e.$);for(var r,o=t instanceof Array,i=o?t.length:1,l=0;o?i>l:1>l;l++)if(r=o?t[l]:t,r instanceof Array)null!=EventDecorator&&(r[0]=EventDecorator(r[0])),n.on.apply(n,r);else for(var s in r){var u,a,c="string"==typeof r[s]?e[r[s]]:r[s],f=s.indexOf(":");-1!==f?(u=s.substring(0,f),a=s.substring(f+1).trim()):u=s,null!=EventDecorator&&(u=EventDecorator(u)),domLib_on(n,u,a,fn_proxy(c,e))}}},EventDecorator=null,EventDecos=function(){var e=function(){if(null==document)return!1;if("createTouch"in document)return!0;try{return!!document.createEvent("TouchEvent").initTouchEvent}catch(e){return!1}}();return{touch:function(t){return e===!1?t:"click"===t?"touchend":"mousedown"===t?"touchstart":"mouseup"===t?"touchend":"mousemove"===t?"touchmove":t}}}(),Pipes=function(){function e(e,t){return function(n){new i(e).emit(t,n)}}function t(e,t){return null==t.pipes[e]?void console.error("Controller has no pipes to be added to collection",e,t):(null==l[e]&&(l[e]=[]),void l[e].push(t))}function n(e,t){for(var n=l[e],r=n.length;--r>-1;)n[r]===t&&n.splice(r,1)}function r(){var e=this,t=e.pipes;for(var r in t)n(r,e)}function o(e){var n=e.pipes;if(null==n)return void console.error("Controller has no pipes",e);for(var o in n)t(o,e);Compo.attachDisposer(e,r.bind(e))}function i(e){return this instanceof i==!1?new i(e):(this.pipeName=e,this)}var l={};return mask.registerAttrHandler("x-pipe-signal","client",function(t,n,r,o,i){for(var l,s=n.split(";"),u=s.length,a=-1;++a<u;)if(l=s[a].trim(),""!==l){var c,f,h=l.indexOf(":"),d=l.substring(0,h),p=l.substring(h+1).trim(),g=p.indexOf(".");if(-1===g)return void console.error('define pipeName "click: pipeName.pipeSignal"');c=p.substring(0,g),f=p.substring(++g);var m=e(c,f);!d&&console.error("Signal: event type is not set",n),dom_addEventListener(i,d,m)}}),i.prototype={constructor:i,emit:function(e){var t,n=l[this.pipeName],r=this.pipeName;if(null==n)return void console.warn("Pipe.emit: No signals were bound to:",r);2===arguments.length&&is_Array(arguments[1])?t=arguments[1]:arguments.length>1&&(t=_array_slice.call(arguments,1));for(var o,i,s,u,a=n.length;-1!==--a;)o=n[a],i=o.pipes[r],null!=i&&(s=i[e],is_Function(s)&&(s.apply(o,t),u=!0));u||console.warn("Pipe `%s` has not slots for `%s`",r,e)}},i.addController=o,i.removeController=r,{addController:o,removeController:r,pipe:i}}(),Anchor=function(){var e={};return{create:function(t){return null==t.ID?void console.warn("Component should have an ID"):void(e[t.ID]=t)},resolveCompo:function(t){if(null==t)return null;var n,r,o;do{if(r=t.getAttribute("x-compo-id"),r&&(null==n&&(n=r),o=e[r],null!=o&&(o=Compo.find(o,{key:"ID",selector:n,nextKey:"components"}),null!=o)))return o;t=t.parentNode}while(t&&1===t.nodeType);return n&&console.warn("No controller for ID",n),null},removeCompo:function(t){null!=t.ID&&delete e[t.ID]},getByID:function(t){return e[t]}}}(),Compo=function(){function Compo(e){if(this instanceof Compo)return null;var t;if(null==e&&(e={}),hasInclude&&global.include&&(e.__resource=global.include.url),null!=e.attr)for(var n in e.attr)e.attr[n]=_mask_ensureTmplFn(e.attr[n]);var r=e.slots;if(null!=r)for(var n in r)"string"==typeof r[n]&&("function"!=typeof e[r[n]]&&console.error("Not a Function @Slot.",r[n]),r[n]=e[r[n]]);e.hasOwnProperty("constructor")&&(t=e.constructor),t=compo_createConstructor(t,e),null==t&&(t=function(){});for(var n in Proto)null==e[n]&&(e[n]=Proto[n]);return t.prototype=e,e=null,t}var hasInclude=!!(global.include||"undefined"!=typeof global.atma&&global.atma.include||"undefined"!=typeof exports&&exports.include),compo_dispose,compo_detachChild,compo_ensureTemplate,compo_attachDisposer,compo_createConstructor,compo_removeElements;!function(){compo_dispose=function(e){null!=e.dispose&&e.dispose(),Anchor.removeCompo(e);for(var t=e.components,n=t&&t.length||0;--n>-1;)compo_dispose(t[n])},compo_detachChild=function(e){var t=e.parent;if(null!=t){var n,r=e.$,o=t.$||t.elements;if(o&&r){var i,l,s=r.length;for(n=o.length;--n>-1;)for(i=o[n],l=s;--l>-1;)if(i===r[l]){o.splice(n,1);break}}var u=t.components;if(null!=u){for(n=u.length;--n>-1;)if(u[n]===e){u.splice(n,1);break}-1===n&&console.warn("<compo:remove> - i`m not in parents collection",e)}}},compo_ensureTemplate=function(e){if(null==e.nodes){null!=e.attr.template&&(e.template=e.attr.template,delete e.attr.template);var t=e.template;if(null!=t){if(is_String(t)){if(35===t.charCodeAt(0)&&/^#[\w\d_-]+$/.test(t)){var n=document.getElementById(t.substring(1));if(null==n)return void console.error("<compo> Template holder not found by id:",t);t=n.innerHTML}t=mask.parse(t)}"object"==typeof t&&(e.nodes=t)}}},compo_attachDisposer=function(e,t){if(null==e.dispose)return void(e.dispose=t);var n=e.dispose;e.dispose=function(){t.call(this),n.call(this)}},compo_createConstructor=function(e,t){var n=t.compos,r=t.pipes,o=t.attr;return null==n&&null==r&&null==t.attr?e:function(){null!=n&&(this.compos=obj_copy(this.compos)),null!=r&&Pipes.addController(this),null!=o&&(this.attr=obj_copy(this.attr)),is_Function(e)&&e.call(this)}},compo_removeElements=function(e){if(e.$)return void e.$.remove();var t=e.elements;if(t)for(var n=-1,r=t.length;++n<r;)t[n].parentNode&&t[n].parentNode.removeChild(t[n]);else{var o=e.components;if(o)for(var n=-1,r=o.length;++n<r;)compo_removeElements(o[n])}}}(),obj_extend(Compo,{create:function(e){var t;null==e&&(e={}),e.hasOwnProperty("constructor")&&(t=e.constructor),null==t&&(t=function(){});for(var n in Proto)null==e[n]&&(e[n]=Proto[n]);
return t.prototype=e,t},createClass:function(e){if(null!=e.attr)for(var t in e.attr)e.attr[t]=_mask_ensureTmplFn(e.attr[t]);hasInclude&&global.include&&(e.__resource=global.include.url);var n=e.slots;if(null!=n)for(var t in n)"string"==typeof n[t]&&("function"!=typeof e[n[t]]&&console.error("Not a Function @Slot.",n[t]),n[t]=e[n[t]]);var r;e.hasOwnProperty("constructor")&&(r=e.constructor),null==r&&(r=e.Construct),e.Construct=compo_createConstructor(r,e);var o=e.Extends;return null==o?e.Extends=Proto:is_Array(o)?o.unshift(Proto):e.Extends=[Proto,o],Class(e)},render:function(e,t,n,r){compo_ensureTemplate(e);var o=[];return mask.render(null==e.tagName?e.nodes:e,t,n,r,e,o),e.$=domLib(o),null!=e.events&&Events_.on(e,e.events),null!=e.compos&&Children_.select(e,e.compos),e},initialize:function(e,t,n,r,o){var i;null==r&&(n&&null!=n.nodeType?(r=n,n=null):t&&null!=t.nodeType&&(r=t,t=null)),"string"==typeof e&&(i=e,e=mask.getHandler(i),e||console.error("Compo not found:",e));var l={controller:e,type:Dom.COMPONENT,tagName:i};null==o&&null!=r&&(o=Anchor.resolveCompo(r)),null==o&&(o=new Dom.Component);var s=mask.render(l,t,n,null,o),u=o.components[o.components.length-1];return null!=r&&(r.appendChild(s),Compo.signal.emitIn(u,"domInsert")),u},find:function(e,t){return find_findSingle(e,selector_parse(t,Dom.CONTROLLER,"down"))},closest:function(e,t){return find_findSingle(e,selector_parse(t,Dom.CONTROLLER,"up"))},dispose:compo_dispose,ensureTemplate:compo_ensureTemplate,attachDisposer:compo_attachDisposer,config:{selectors:{$:function(e,t){var n=domLib_find(e.$,t);return 0===n.length&&console.error("<compo-selector> - element not found -",t,e),n},compo:function(e,t){var n=Compo.find(e,t);return null==n&&console.error("<compo-selector> - component not found -",t,e),n}},setDOMLibrary:function(e){domLib!==e&&(domLib=e,domLib_initialize())},eventDecorator:function(e){return"function"==typeof e?void(EventDecorator=e):"string"==typeof e?void(EventDecorator=EventDecos[e]):"boolean"==typeof e&&e===!1?void(EventDecorator=null):void 0}},pipe:Pipes.pipe,resource:function(e){for(var t=e;null!=t;){if(t.resource)return t.resource;t=t.parent}return include.instance()},plugin:function(source){eval(source)},Dom:{addEventListener:dom_addEventListener}}),function(){function e(e,t,n){return null==e[t]&&(e[t]=[]),e[t].push(n),e}function t(e,t,n){var r=e[t];if(null!=r)for(var o,i=0,l=r.length;l>i;i++)o=r[i],null!=o&&(r[i]=null,null!=n?o.apply(this,n):o())}var n={done:function(t){return e(this,"_cbs_done",t)},fail:function(t){return e(this,"_cbs_fail",t)},always:function(t){return e(this,"_cbs_always",t)},resolve:function(){this.async=!1,t(this,"_cbs_done",arguments),t(this,"_cbs_always",arguments)},reject:function(){this.async=!1,t(this,"_cbs_fail",arguments),t(this,"_cbs_always")}},r={async:!0,await:function(e){this.resume=e}};Compo.pause=function(e,t){if(null==t.async){t.defers=[],t._cbs_done=null,t._cbs_fail=null,t._cbs_always=null;for(var o in n)t[o]=n[o]}t.async=!0;for(var o in r)e[o]=r[o];return t.defers.push(e),function(){Compo.resume(e,t)}},Compo.resume=function(e,t){e.resume&&e.resume(),e.async=!1;for(var n,r=!1,o=0,i=t.defers.length;i>o;o++)n=t.defers[o],n!==e?r===!1&&(r=null!=n):t.defers[o]=null;r===!1&&t.resolve()}}();var Proto={type:Dom.CONTROLLER,tagName:null,compoName:null,nodes:null,attr:null,model:null,slots:null,pipes:null,compos:null,events:null,async:!1,onRenderStart:null,onRenderEnd:null,render:null,renderStart:function(e,t,n){if(1===arguments.length&&null!=e&&e instanceof Array==!1&&null!=e[0]){var r=arguments[0];e=r[0],t=r[1],n=r[2]}null==this.nodes&&compo_ensureTemplate(this),is_Function(this.onRenderStart)&&this.onRenderStart(e,t,n)},renderEnd:function(e,t,n,r){if(1===arguments.length&&e instanceof Array==!1){var o=arguments[0];e=o[0],t=o[1],n=o[2],r=o[3]}Anchor.create(this,e),this.$=domLib(e),null!=this.events&&Events_.on(this,this.events),null!=this.compos&&Children_.select(this,this.compos),is_Function(this.onRenderEnd)&&this.onRenderEnd(e,t,n,r)},appendTo:function(e){var t="string"==typeof e?document.querySelector(e):e;if(null==t)return console.warn("Compo.appendTo: parent is undefined. Args:",arguments),this;for(var n=this.$,r=0,o=n.length;o>r;r++)t.appendChild(n[r]);return this.emitIn("domInsert"),this},append:function(e,t,n){var r;if(null==this.$){var o="string"==typeof e?mask.compile(e):e;return r=n?find_findSingle(this,selector_parse(n,Dom.CONTROLLER,"down")):this,null==r.nodes?(this.nodes=o,this):(r.nodes=[this.nodes,o],this)}var i=mask.render(e,t,null,null,this);return r=n?this.$.find(n):this.$,r.append(i),this.emitIn("domInsert"),this},find:function(e){return find_findSingle(this,selector_parse(e,Dom.CONTROLLER,"down"))},closest:function(e){return find_findSingle(this,selector_parse(e,Dom.CONTROLLER,"up"))},on:function(){var e=_array_slice.call(arguments);return arguments.length<3?(console.error("Invalid Arguments Exception @use .on(type,selector,fn)"),this):(null!=this.$&&Events_.on(this,[e]),null==this.events?this.events=[e]:is_Array(this.events)?this.events.push(e):this.events=[e,this.events],this)},remove:function(){return compo_removeElements(this),compo_detachChild(this),compo_dispose(this),this.$=null,this},slotState:function(e,t){return Compo.slot.toggle(this,e,t),this},signalState:function(e,t){return Compo.signal.toggle(this,e,t),this},emitOut:function(e){return Compo.signal.emitOut(this,e,this,arguments.length>1?_array_slice.call(arguments,1):null),this},emitIn:function(e){return Compo.signal.emitIn(this,e,this,arguments.length>1?_array_slice.call(arguments,1):null),this}};return Compo.prototype=Proto,Compo}();return function(){function e(t,n,r,o,i){if(null==t)return!1;var l=!1,s=null!=t.slots&&t.slots[n];if("string"==typeof s&&(s=t[s]),"function"==typeof s){l=!0;var u=null!=t.slots.__disabled&&t.slots.__disabled[n];if(u!==!0){var a=null==o?s.call(t,r):s.apply(t,[r].concat(o));if(a===!1)return!0;null!=a&&"object"==typeof a&&null!=a.length&&(o=a)}}if(-1===i&&null!=t.parent)return e(t.parent,n,r,o,i)||l;if(1===i&&null!=t.components)for(var c,f=t.components,h=f.length,d=0;h>d;d++)c=e(f[d],n,r,o,i),!l&&(l=c);return l}function t(e,n,r,o){if(null==e)return!1;var i=e.slots;if(null!=i&&null!=i[n]&&("string"==typeof i[n]&&(i[n]=e[i[n]]),"function"==typeof i[n])){if(o!==!0)return!0;if(null==i.__disabled||i.__disabled[n]!==!0)return!0}if(-1===r&&null!=e.parent)return t(e.parent,n,r);if(1===r&&null!=e.components)for(var l=0,s=e.components.length;s>l;l++)if(t(e.components[l],n,r))return!0;return!1}function n(n,r){return t(n,r,-1)===!1?null:function(t){var o=arguments.length>1?_array_slice.call(arguments,1):null;e(n,r,t,o,-1)}}function r(e,t,n){var r=e.slots;null!=r&&r.hasOwnProperty(t)!==!1&&(null==r.__disabled&&(r.__disabled={}),r.__disabled[t]=n===!1)}function o(e,t,n){if(r(e,t,n),null!=e.components)for(var i=0,l=e.components.length;l>i;i++)o(e.components[i],t,n)}function i(e,t,n){return null==e.$?void console.warn("Controller has no elements to toggle state"):void domLib().add(e.$.filter("[data-signals]")).add(e.$.find("[data-signals]")).each(function(e,r){var o=r.getAttribute("data-signals");null!=o&&-1!==o.indexOf(t)&&r[n===!0?"removeAttribute":"setAttribute"]("disabled","disabled")})}function l(e,t,n){for(var l=e,s=e;null!=(l=l.parent);)r(l,t,n),null!=l.$&&0!==l.$.length&&(s=l);o(e,t,n),i(s,t,n)}function s(e,n,o){r(e,n,o),(o||!t(e,n,-1,!0)&&!t(e,n,1,!0))&&i(e,n,o)}mask.registerAttrHandler("x-signal","client",function(e,t,r,o,i,l){for(var s,u=t.split(";"),a="",c=u.length,f=-1;++f<c;)if(s=u[f].trim(),""!==s){var h=s.indexOf(":"),d=s.substring(0,h),p=s.substring(h+1).trim(),g=n(l,p);!d&&console.error("Signal: event type is not set",t),g&&(a+=","+p+",",dom_addEventListener(i,d,g)),!g&&console.warn("No slot found for signal",p,l)}""!==a&&i.setAttribute("data-signals",a)}),obj_extend(Compo,{signal:{toggle:l,emitOut:function(t,n,r,o){var i=e(t,n,r,o,-1);!i&&console.warn("Signal %c%s","font-weight:bold;",n,"was not captured")},emitIn:function(t,n,r,o){e(t,n,r,o,1)},enable:function(e,t){l(e,t,!0)},disable:function(e,t){l(e,t,!1)}},slot:{toggle:s,enable:function(e,t){s(e,t,!0)},disable:function(e,t){s(e,t,!1)},invoke:function(e,t,n,r){var o=e.slots;return null==o||"function"!=typeof o[t]?(console.error("Slot not found",t,e),null):null==r?o[t].call(e,n):o[t].apply(e,[n].concat(r))}}})}(),domLib_initialize(),mask.registerHandler(":slot",SlotHandler),SlotHandler.prototype={constructor:SlotHandler,renderEnd:function(){this.slots={},this.expression=this.attr.on,this.slots[this.attr.signal]=this.handle},handle:function(){var e=this.expression;mask.Utils.Expression.eval(e,this.model,global,this)}},Compo}(Mask),jmask=exports.jmask=function(e){function t(e){return"string"!=typeof e?e:_(e)}function n(e,t){if(null==e&&(e={}),null==t)return e;for(var n in t)e[n]=t[n];return e}function r(e,t){for(var n=0,r=e.length;r>n;n++)t(e[n],n)}function o(e,t){if(null==e)return void console.error("Can not remove myself from parent",t);var n=e.indexOf(t);return-1===n?void console.error("Can not remove myself from parent",t,n):void e.splice(n,1)}function i(e){return null!=e&&"object"==typeof e&&null!=e.length&&"function"==typeof e.slice}function l(e,t,n){if(null==e&&console.warn("selector is null for type",t),"object"==typeof e)return e;var r,o,i,l,u,c,f,h,d,p=0,g=e.length;for(r="up"===n?C:t===v.SET?j:N;g>p;)u=e.charCodeAt(p),33>u||(c=a(e,p+1,g),46===u?(o="class",i=k,l=s(e.substring(p+1,c))):35===u?(o="id",i=k,l=e.substring(p+1,c)):91===u?(h=e.indexOf("=",p),-1===h&&console.error('Attribute Selector: should contain "="'),i=k,o=e.substring(p+1,h),u=e.charCodeAt(h+1),d=34===u||39===u?2:1,l=e.substring(h+d,c-d+1),c++):(i=null,o=t===v.SET?"tagName":"compoName",l=e.substring(p,c)),p=c,null!=f?(null==f.filters&&(f.filters=[]),f.filters.push({key:o,selector:l,prop:i})):f={key:o,prop:i,selector:l,nextKey:r,filters:null});return f}function s(e){return function(t){return u(t,e)}}function u(e,t,n){if("string"!=typeof e)return!1;if(null==n&&(n=0),n=e.indexOf(t,n),-1===n)return!1;if(n>0&&e.charCodeAt(n-1)>32)return u(e,t,n+1);var r=e.length,o=t.length;return r-o>n&&e.charCodeAt(n+o)>32?u(e,t,n+1):!0}function a(e,t,n){for(var r,o=!1,i=!1;n>t&&(r=e.charCodeAt(t),(34===r||39===r)&&(o=!o),92===r&&(i=!i),!(46===r||35===r||91===r||93===r||33>r)||o===!0||i===!0);)t++;return t}function c(e,t,n){"string"==typeof t&&(null==n&&(n=v[e.compoName?"CONTROLLER":"SET"]),t=l(t,n));var r=t.prop?e[t.prop]:e,o=!1;if(null==r)return!1;if("function"==typeof t.selector?o=t.selector(r[t.key]):null!=t.selector.test?t.selector.test(r[t.key])&&(o=!0):r[t.key]===t.selector&&(o=!0),o===!0&&null!=t.filters)for(var i,s=0,u=t.filters.length;u>s;s++)if(i=t.filters[s],c(e,i,n)===!1)return!1;return o}function f(e,t){if(null==t)return e;for(var n,r=[],o=0,i=e.length;i>o;o++)n=e[o],c(n,t)&&r.push(n);return r}function h(e,t,n){if(null==e)return n;if(null==n&&(n=[]),e instanceof Array){for(var r=0,o=e.length;o>r;r++)h(e[r],t,n);return n}c(e,t)&&n.push(e);var i=e[t.nextKey];return null!=i&&h(i,t,n),n}function d(e,t){var r={type:1,tagName:1,compoName:1,controller:1},o={parent:t};for(var i in e)1===r[i]&&(o[i]=e[i]);e.attr&&(o.attr=n({},e.attr));var l=e.nodes;if(null!=l&&l.length>0){o.nodes=[];for(var s=l instanceof Array,u=s===!0?l.length:1,a=0;u>a;a++)o.nodes[a]=d(s===!0?l[a]:l,o)}return o}function p(e){for(var t,n=e;null!=n;)t=n,n=n.nodes&&n.nodes[0];return t}function g(e,t,n,r){if(v.TEXTNODE===e.type)return"function"==typeof e.content?e.content("node",t,n,null,r):e.content;var o="";if(null!=e.nodes)for(var i,l=0,s=e.nodes.length;s>l;l++)i=e.nodes[l],o+=g(i,t,n,r);return o}function m(e){return this instanceof m==!1?new m(e):null==e?this:e.type===v.SET?e:this.add(e)}var v=e.Dom,y=e.render,b=e.parse,_=e.Utils.ensureTmplFn,x=(global.Compo||e.Compo||Compo).signal.emitIn,w=function(){function e(e,n){return e===n?(t=!0,0):1}var t=!1;return function(n){var r,o,i,l;if(t=!1,n.sort(e),t===!1)return n;for(r=[],o=0,i=0,l=n.length-1;l>o;)n[o++]===n[o]&&(r[i++]=o);for(;i--;)n.splice(r[i],1);return n}}(),C="parent",j="nodes",N="components",k="attr";return m.prototype={constructor:m,type:v.SET,length:0,components:null,add:function(e){var t,n;if("string"==typeof e&&(e=b(e)),i(e)){for(t=0,n=e.length;n>t;t++)this.add(e[t]);return this}"function"==typeof e&&null!=e.prototype.type&&(e={controller:e,type:v.COMPONENT});var r=e.type;if(!r)return console.error("Only Mask Node/Component/NodeText/Fragment can be added to jmask set",e),this;if(r===v.FRAGMENT){var o=e.nodes;for(t=0,n=o.length;n>t;)this[this.length++]=o[t++];return this}if(r===v.CONTROLLER){if(null!=e.nodes&&e.nodes.length)for(t=e.nodes.length;0!==t;)e.nodes[--t].parent=e;null!=e.$&&(this.type=v.CONTROLLER)}return this[this.length++]=e,this},toArray:function(){return Array.prototype.slice.call(this)},render:function(e,t,n,r){if(this.components=[],1===this.length)return y(this[0],e,t,n,r||this);null==n&&(n=document.createDocumentFragment());for(var o=0,i=this.length;i>o;o++)y(this[o],e,t,n,r||this);return n},prevObject:null,end:function(){return this.prevObject||this},pushStack:function(e){var t;return t=m(e),t.prevObject=this,t},controllers:function(){return null==this.components&&console.warn("Set was not rendered"),this.pushStack(this.components||[])},mask:function(t){var n;if(null!=t)return this.empty().append(t);if(arguments.length)return this;if(0===this.length)n=new v.Node;else if(1===this.length)n=this[0];else{n=new v.Fragment,n.nodes=[];for(var r=-1;++r<this.length;)n.nodes[r]=this[r]}return e.stringify(n)},text:function(e,t,n){if("string"==typeof e&&1===arguments.length){for(var r,o=[new v.TextNode(e)],i=0,l=this.length;l>i;i++)r=this[i],r.nodes=o;return this}for(var r,s="",i=0,l=this.length;l>i;i++)r=this[i],s+=g(r,e,t,n);return s}},r(["append","prepend"],function(e){m.prototype[e]=function(t){for(var n,r,o=m(t),i=0,l=this.length;l>i;i++){r=this[i],n=o.toArray();for(var s=0,u=n.length;u>s;s++)n[s].parent=r;r.nodes=null!=r.nodes?"append"===e?r.nodes.concat(n):n.concat(r.nodes):n}return this}}),r(["appendTo"],function(e){m.prototype[e]=function(e,t,n,r){return null==r&&(r=this),null!=e.nodeType&&"function"==typeof e.appendChild?(e.appendChild(this.render(t,n,null,r)),x(r,"domInsert"),this):(m(e).append(this),this)}}),function(){function e(e){for(var t,n,r=e.split(";"),o={},i=0,l=r.length;l>i;i++)n=r[i],t=n.indexOf(":"),o[n.substring(0,t).trim()]=n.substring(t+1).trim();return o}function o(e){var t=[],n=0;for(var r in e)t[n++]=r+":"+e[r];return t.join(";")}r(["add","remove","toggle","has"],function(e){m.prototype[e+"Class"]=function(t){var n,r,o,i,l,s=this.length,u=0;if("string"!=typeof t){if("remove"===e)for(;s>u;u++)this[0].attr["class"]=null;return this}for(;s>u;u++)if(i=this[u],null!=i.attr){if(l=i.attr["class"],null==l)l=t;else{for(l=" "+l+" ",null==n&&(n=t.split(" "),o=n.length),r=0;o>r;r++)if(n[r]){var a=l.indexOf(" "+n[r]+" ")>-1;if("has"!==e)a!==!1||"add"!==e&&"toggle"!==e?a!==!0||"remove"!==e&&"toggle"!==e||(l=l.replace(" "+n[r]+" "," ")):l+=n[r]+" ";else if(a)return!0}l=l.trim()}"has"!==e&&(i.attr["class"]=l)}return"has"===e?!1:this}}),r(["attr","removeAttr","prop","removeProp"],function(e){m.prototype[e]=function(n,r){if(!n)return this;for(var o,i=this.length,l=0,s=arguments.length;i>l;l++)switch(o=this[l],e){case"attr":case"prop":if(1===s){if("string"==typeof n)return o.attr[n];for(var u in n)o.attr[u]=t(n[u])}else 2===s&&(o.attr[n]=t(r));break;case"removeAttr":case"removeProp":o.attr[n]=null}return this}}),n(m.prototype,{tag:function(e){if("string"==typeof e){for(var t=0,n=this.length;n>t;t++)this[t].tagName=e;return this}return this[0]&&this[0].tagName},css:function(t,n){var r,i,l,s=arguments.length,u=this.length,a=0;if(1===s&&"string"==typeof t)return 0===u?null:"string"==typeof this[0].attr.style?e(this[0].attr.style)[t]:null;for(;u>a;a++)if(l=this[a].attr.style,"function"!=typeof l){if(1===s&&"object"==typeof t){if(null==l){this[a].attr.style=o(t);continue}r=e(l);for(i in t)r[i]=t[i];this[a].attr.style=o(r)}if(2===s){if(null==l){this[a].attr.style=t+":"+n;continue}r=e(l),r[t]=n,this[a].attr.style=o(r)}}return this}})}(),n(m.prototype,{clone:function(){for(var e=[],t=0,n=this.length;n>t;t++)e[t]=d(this[0]);return m(e)},wrap:function(e){var t,n=m(e),r=[];if(0===n.length)return console.log("Not valid wrapper",e),this;for(var o=0,i=this.length;i>o;o++){t=i>0?n.clone():n,p(t[0]).nodes=[this[o]],r[o]=t[0];var l=this[o].parent&&this[o].parent.nodes;if(null!=l)for(var s=0,u=l.length;u>s;s++)if(l[s]===this[o]){l.splice(s,1,r[o]);break}}return m(r)},wrapAll:function(e){var t=m(e);return 0===t.length?(console.error("Not valid wrapper",e),this):(this.parent().mask(t),p(t[0]).nodes=this.toArray(),this.pushStack(t))}}),r(["empty","remove"],function(e){m.prototype[e]=function(){for(var t,n=0,r=this.length;r>n;n++)t=this[n],"empty"!==e?"remove"!==e||null!=t.parent&&o(t.parent.nodes,t):t.nodes=null;return this}}),n(m.prototype,{each:function(e,t){for(var n=0;n<this.length;n++)e.call(t||this,this[n],n);return this},eq:function(e){return-1===e?this.slice(e):this.slice(e,e+1)},get:function(e){return 0>e?this[this.length-e]:this[e]},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments))}}),r(["filter","children","closest","parent","find","first","last"],function(e){m.prototype[e]=function(t){var n,r,o=[],i=null==t?null:l(t,this.type,"closest"===e?"up":"down");switch(e){case"filter":return m(f(this,i));case"children":for(n=0;n<this.length;n++)r=this[n],null!=r.nodes&&(o=o.concat(null==i?r.nodes:f(r.nodes,i)));break;case"parent":for(n=0;n<this.length;n++)r=this[n].parent,!r||r.type===v.FRAGMENT||i&&c(r,i)||o.push(r);w(o);break;case"closest":case"find":if(null==i)break;for(n=0;n<this.length;n++)h(this[n][i.nextKey],i,o);break;case"first":case"last":var s;for(n=0;n<this.length;n++)if(s="first"===e?n:this.length-n-1,r=this[s],null==i||c(r,i)){o[0]=r;break}}return this.pushStack(o)}}),m}(Mask),Cache=function(){function e(e){this.__cacheInfo=new t(e.cache)}function t(e){if(e.byProperty){var t=e.byProperty,n=t.indexOf("."),r=t.substring(0,n);switch(t=t.substring(n+1),r){case"model":case"ctx":break;default:return console.error('[CompoCache] - property accessor not valid - should be "[model/ctx].[accessor]"'),null}this.propObjName=r,this.propAccessor=t}return this.expire=e.expire,this}var n=0,r=0,o={};return e.prototype={__null:null,__value:null},t.prototype={prop:void 0,propObjName:null,propAccessor:null,expire:null,getKey:function(e,t){if(null==this.propAccessor)return"__value";var n,r,o=this.propObjName,i=this.propAccessor;return"model"===o&&(n=e),"ctx"===o&&(n=t),r=obj_getProperty(n,i),"undefined"==typeof r?"__value":null==r?"__null":r}},{get controllerID(){return n},get modelID(){return r},cacheCompo:function(t,i,l,s){if(__cfg.allowCache!==!1){var u=o[l];null==u&&(u=o[l]=new e(s));var a=u.__cacheInfo;null!=a&&(u[a.getKey(t,i)]=s,n=i._id,r=i._model._id)}},getCompo:function(e,t,n){if(__cfg.allowCache!==!1){var r=o[n];if(null==r)return null;var i=r.__cacheInfo,l=r[i.getKey(e,t)];return null==l||null==l.__cached?null:l}},getCache:function(){return o}}}();!function(e){var t;!function(){function n(e){for(var t="";e--;)t+=" ";return t}function r(e,t,r){var i,l;null==t&&(t=0),null==r&&(i=!0,r=[]);var s=r.length;if(e.type===h.FRAGMENT&&(e=e.nodes),e instanceof Array)for(l=0;l<e.length;l++)o(e[l],t,r);else o(e,t,r);var u=n(t);for(l=s;l<r.length;l++)r[l]=u+r[l];return i?r.join(0===f?"":"\n"):void 0}function o(e,t,n){if("string"==typeof e.content)return void n.push(a(e.content));if("function"==typeof e.content)return void n.push(a(e.content()));if(l(e))return void n.push(i(e)+";");if(s(e)){var o=c?">":" > ";return n.push(i(e)+o),void r(u(e),f,n)}n.push(i(e)+"{"),r(e.nodes,f,n),n.push("}")}function i(e){var t=e.tagName,n=e.attr.id||"",r=e.attr["class"]||"";"function"==typeof n&&(n=n()),"function"==typeof r&&(r=r()),n&&(n=-1!==n.indexOf(" ")?"":"#"+n),r&&(r="."+r.split(" ").join("."));var o="";for(var i in e.attr)if("id"!==i&&"class"!==i){var l=e.attr[i];"function"==typeof l&&(l=l()),(c===!1||/[^\w_$\-\.]/.test(l))&&(l=a(l)),o+=" "+i,i!==l&&(o+="="+l)}"div"===t&&(n||r)&&(t="");var s="";return e.expression&&(s="("+e.expression+")"),t+n+r+o+s}function l(e){return null==e.nodes||e.nodes instanceof Array&&0===e.nodes.length}function s(e){return e.nodes&&(e.nodes instanceof Array==!1||1===e.nodes.length)}function u(e){return e.nodes instanceof Array?e.nodes[0]:e.nodes}function a(e){return-1===e.indexOf("'")?"'"+e.trim()+"'":-1===e.indexOf('"')?'"'+e.trim()+'"':'"'+e.replace(/"/g,'\\"').trim()+'"'}t=function(t,n){return null==t?"":("string"==typeof t&&(t=e.parse(t)),null==n?(f=0,c=!0):"number"==typeof n?(f=n,c=0===f):(f=n&&n.indent||4,c=0===f||n&&n.minimizeAttributes),r(t))};var c,f,h=e.Dom}(),e.stringify=t}(Mask),function(e){function t(){this.attr={"debugger":null,use:null,repeat:null,"if":null,"else":null,each:null,log:null,visible:null,model:null},this.model=null,this.modelRef=null,this.nodes=null,this.parent=null,this.container=null,this.template=null}function n(e,t,n,r){null==e.nodes&&Compo.ensureTemplate(e);var l=e.attr.each||e.attr.foreach,s=ExpressionUtil.eval(l,t,n,e),u=e.nodes;if(e.nodes=null,null!=s){"number"!=typeof s.length&&(s=obj_toDictionary(s)),e.nodes=[],e.model=s,e.modelRef=l,e.template=u,e.container=r;var a=s.length,c=-1;if(null!=a){for(;++c<a;)e.nodes[c]=o("%.each.item",u,s[c],c,r,e);e.append=i.append}}}function r(e,t,n,r){var i=e.attr.repeat.split(".."),l=+i[0],s=+i[1],u=e.nodes;(isNaN(l)||isNaN(s))&&console.error("Repeat attribute(from..to) invalid",e.attr.repeat),e.nodes=[];for(var a=-1;++a<s;)e.nodes[a]=o("%.repeat.item",u,t,a,r,e)}function o(e,t,n,r,o,i){return{type:Dom.COMPONENT,compoName:e,attr:{},nodes:t,model:n,container:o,parent:i,index:r}}e.registerHandler("%",t),t.prototype={renderStart:function(e,t,o){var i=this.attr;if(null!=i.each||null!=i.foreach)return void n(this,e,t,o);if(null!=i["if"])return this.state=ExpressionUtil.eval(i["if"],e,t,this.parent),void(this.state||(this.nodes=null));if(null!=i["else"]){var l=this.parent.components,s=l&&l[l.length-1];return null!=s&&"%"===s.compoName&&null!=s.attr["if"]?void(s.state&&(this.nodes=null)):void console.error("Previous Node should be \"% if='condition'\"",s,this.parent)}if(null!=i.use){var u=i.use;return this.model=obj_getProperty(e,u),void(this.modelRef=u)}if(null==i["debugger"]){if(null!=i.visible){var a=ExpressionUtil.eval(i.visible,e,t,this.parent);return void(a||(this.nodes=null))}if(null!=i.log){var c=i.log,f=obj_getProperty(e,c);return void console.log("Key: %s, Value: %s",c,f)}null!=i.repeat&&r(this,e,t,o)}},render:null,renderEnd:null,append:null};var i={append:function(t){var n=new Component;n.nodes=this.template,n.model=t,e.render(n,t,null,this.container,this)}}}(Mask),function(e){function t(){}function n(){}function r(){}var o={};e.templates=o,e.registerHandler(":template",t),t.prototype.render=function(){return null==this.attr.id?void console.warn("Template Should be defined with ID attribute for future lookup"):void(o[this.attr.id]=this.nodes)},e.registerHandler(":import",n),n.prototype={constructor:n,attr:null,template:null,renderStart:function(){if(this.attr.id){if(this.nodes=this.template,null==this.nodes&&(this.nodes=o[this.attr.id]),null==this.nodes){for(var e,t=this,n=":template[id="+this.attr.id+"]";null==e&&null!=(t=t.parent);)null!=t.nodes&&(e=jmask(t.nodes).filter(n).get(0));null!=e&&(this.nodes=e.nodes)}null==this.nodes&&console.warn("Template could be not imported",this.attr.id)}}},e.registerHandler(":html",r),r.prototype={mode:"server:all",render:function(e,t,n){var r=jmask(this.nodes).text(e,t,this);return r?n.insertAdjacentHTML?void n.insertAdjacentHTML("beforeend",r):void(this.toHtml=function(){return r}):void console.warn("No HTML for node",this)}}}(Mask),function(e,t){function n(e,t){return function(){return e.apply(t,arguments)}}function r(e){return e.parentNode.removeChild(e)}function o(e){if(null!=e)for(var t=e.length,n=-1;++n<t;)r(e[n])}function i(e,t){return t.parentNode.insertBefore(e,t.nextSibling)}function l(e,t){return t.parentNode.insertBefore(e,t)}function s(e,t,n,r){if(null==e.components)return i(n,r||e.placeholder);var o,s=e.components,u=null,a=!0,c=s.length,f=t-1;if(null==u)for(;++f<c;)if(o=s[f].elements,o&&o.length){u=o[0];break}if(null==u)for(a=!1,f=c>t?t:c;--f>-1;)if(o=s[f].elements,o&&o.length){u=o[o.length-1];break}return null==u&&(u=r||e.placeholder),a?l(n,u):i(n,u)}function u(t,n,r,o,i){return e.render(n,r,o,i,t)}function a(e,t){if(null==e)return!1;null!=e.elements&&(o(e.elements),e.elements=null),k.dispose(e);var n=t&&t.components||e.parent&&e.parent.components;return null==n?(console.error("Parent Components Collection is undefined"),!1):R(n,e)}function c(e){k.signal.emitIn(e,"domInsert")}function f(e,t){if("function"==typeof e.dispose){var n=e.dispose;return void(e.dispose=function(){t.call(this),n.call(this)})}e.dispose=t}function h(){}function d(){}function p(){}function g(e,t){if(null==t&&(t=[]),null==e.components)return t;for(var n,r=e.components,o=0,i=r.length;i>o;o++)n=r[o],"validate"!==n.compoName?g(n):t.push(n);return t}var m,v,y,b,_,x,w,C,j,N=global.jQuery||global.Zepto||global.$,k="undefined"!=typeof t?t:e.Compo||global.Compo,O=k.Dom.addEventListener,S=e.registerHandler,A=e.registerAttrHandler,E=e.registerUtil,T=Array.prototype.slice;!function(){function e(e,t){for(var n,r=-1,o=t.length-1;++r<o;)n=t[r],null==e[n]&&(e[n]={}),e=e[n];return e}function t(t,r,o,i){var l=i.length,s=l>1?e(t,i):t,u=i[l-1],a=s[u];return l>1&&n(t,i),"length"===u&&D(s)?(P(s,function(e,t,n,r){for(var i=o.length,l=-1;++l<i;)o[l](e,t,n,r)}),a):(Object.defineProperty(s,u,{get:function(){return a},set:function(e){var t=0,n=o.length;if(e!==a){if(a=e,D(e))for(t=0;n>t;t++)P(e,o[t]);if(null!=o.__dirties)return void(o.__dirties[r]=1);for(t=0;n>t;t++)o[t](e)}},configurable:!0}),a)}function n(e,t){for(var n,i=o(e),l="",s=0,u=t.length-1;u>s;s++)n=t[s],l+=n+".",r(l,e,n,i),e=e[n]}function r(e,t,n,r){var o,i=t[n];Object.defineProperty(t,n,{get:function(){return i},set:function(t){t!==i&&(o=i,i=t,r(e,o))},configurable:!0})}function o(e){return function(t,n){var r=e.__observers;if(null!=r)for(var o in r)if(0===o.indexOf(t)){var i=r[o].slice(0),l=i.length,s=0;if(0!==l){var u,a,c=m(e,o);for(s=0;l>s;s++)u=i[s],_(e,o,u),a=o.substring(t.length),_(n,a,u);for(s=0;l>s;s++)i[s](c);for(s=0;l>s;s++)y(e,o,i[s])}}}}function i(e,t,n){null==e.__observers&&Object.defineProperty(e,"__observers",{value:{__dirty:null},enumerable:!1});var r=e.__observers;return null!=r[t]?-1===I(r[t],n)&&r[t].push(n):r[t]=[n],r[t]}m=function(e,t){for(var n=t.split("."),r=n.length,o=-1;++o<r;){if(null==e)return null;e=e[n[o]]}return e},v=function(e,t,n){for(var r,o=t.split("."),i=o.length-1,l=-1;++l<i;)r=o[l],null==e[r]&&(e[r]={}),e=e[r];e[o[l]]=n},y=function(e,n,r){for(var o=n.split("."),l=o.length,s=-1,u=e;++s<l&&(u=u[o[s]],null!=u);)if(null!=u.__observers){var a=o.slice(s+1).join(".");if(u.__observers[a]){i(u,a,r);var c=i(e,n,r);if(1===c.length){var f=o.splice(0,s);0!==f.length&&t(e,n,c,f,!0)}return}}var c=i(e,n,r);1===c.length&&t(e,n,c,o,!0);var h=m(e,n);D(h)&&P(h,r)},b=function(e,t,n){for(var r=t.split("."),o=r.length,i=-1,l=e;++i<o&&(l=l[r[i]],null!=l);)if(null!=l.__observers){if(b(l,r.slice(i).join("."),n))return!0;break}var s=e.__observers;return null==s||null==s[t]?!1:-1!==I(s[t],n)},_=function(e,t,n){for(var r=t.split("."),o=r.length,i=-1,l=e;++i<o&&(l=l[r[i]],null!=l);)if(null!=l.__observers){_(l,r.slice(i).join("."),n);break}var s=e.__observers;if(null!=s&&null!=s[t]){var u=m(e,t);if(2===arguments.length)return void(s[t].length=0);R(s[t],n),D(u)&&L(u,n)}},x=function(e){if(D(e))return void $(e);var t=e.__observers;null!=t&&(t.__dirties={})},w=function(e){if(D(e))return void F(e);var t=e.__observers,n=null==t?null:t.__dirties;if(null!=n){for(var r in n){var o=e.__observers[r],i=m(e,r);if(null!=o)for(var l=0,s=o.length;s>l;l++)o[l](i)}t.__dirties=null}},C=function(e,t){if(null==t)return e;null==e&&(e={});for(var n in t)e[n]=t[n];return e},j=function(e,t){if(null==e)return!1;for(var n=t.split("."),r=n.length,o=-1;++o<r;)if(null==(e=e[n[o]]))return!1;return!0}}();var D,R,M,I,P,L,$,F;!function(){function e(e,n,r){return function(){return t(e,n,r,T.call(arguments))}}function t(e,t,n,r){var o=e.__observers&&e.__observers.__array,i=t.apply(e,r);if(null==o||0===o.length)return i;if(null!=e.__observers.__dirty)return e.__observers.__dirty=!0,i;for(var l,s=0,u=o.length;u>s;s++)l=o[s],"function"==typeof l&&l(e,n,r,i);return i}D=function(e){return null!=e&&"object"==typeof e&&null!=e.length&&"function"==typeof e.splice},R=function(e){if(null==e)return!1;for(var t,n=0,r=e.length,o=1,i=arguments.length,l=0;r>n;n++)for(t=e[n],o=1;i>o;o++)if(arguments[o]===t){e.splice(n,1),n--,r--,l++;break}return l+1===i},P=function(t,n){null==t.__observers&&Object.defineProperty(t,"__observers",{value:{__dirty:null},enumerable:!1});var r=t.__observers.__array;if(null==r&&(r=t.__observers.__array=[]),0===r.length)for(var o,i,l=0,s=["push","unshift","splice","pop","shift","reverse","sort","remove"],u=s.length;u>l;l++)i=s[l],o=t[i],null!=o&&(t[i]=e(t,o,i));r[r.length++]=n},L=function(e,t){var n=e.__observers&&e.__observers.__array;if(null!=n)for(var r=0,o=n.length;o>r;r++)if(n[r]===t){n[r]=null;for(var i=r;o>i;i++)n[i]=n[i+1];o--,n.length--}},$=function(e){null!=e.__observers&&(e.__observers.__dirty=!1)},F=function(e){var t=e.__observers,n=t&&t.__array;if(null!=n&&t.__dirty===!0){for(var r,o=0,i=n.length;i>o;o++)r=n[o],"function"==typeof r&&r(e);t.__dirty=null}},M=function(e,t){for(var n=0,r=e.length;r>n;n++)t(e[n])},I=function(e,t){return e.indexOf(t)}}();var U,H,z,q,B,J,X;!function(){var t=e.Utils.Expression,n=t.eval;J=t.parse,X=t.varRefs,U=function(e,t,r,o){if("."===e)return t;var i=n(e,t,r,o);return null==i?"":i},H=function(e,t,r,o,i){if("."===e)return void(D(t)&&P(t,i));var l,s=J(e),u=X(s);if(null!=u){if("string"==typeof u)return j(t,u)&&(l=t),null==l&&j(o,u)&&(l=o),null==l&&(l=t),void y(l,u,i);for(var a,c=null!=u.length&&"function"==typeof u.splice,f=c===!0?u.length:1,h=0;f>h;h++)if(a=c?u[h]:u,null!=a){if("object"==typeof a){if(l=n(a.accessor,t,r,o),null==l||"object"!=typeof l){console.error("Binding failed to an object over accessor",a);continue}a=a.ref}else l=j(t,a)?t:j(o,a)?o:t;null!=a&&"$c"!==a&&y(l,a,i)}}},z=function(e,t,r,o){if("function"==typeof r&&console.warn("[mask.binding] - expression unbind(expr, model, controller, callback)"),"."===e)return void L(t,o);var i,l=X(e);if(null!=l){if("string"==typeof l)return j(t,l)&&_(t,l,o),void(j(r,l)&&_(r,l,o));for(var i,s=null!=l.length&&"function"==typeof l.splice,u=s===!0?l.length:1,a=0;u>a;a++)if(i=s?l[a]:l,null!=i)if("object"!=typeof i)j(t,i)&&_(t,i,o),j(r,i)&&_(r,i,o);else{var c=n(i.accessor,t,null,r);c&&_(c,i.ref,o)}}},q=function(e,t,n,r,o){var i=0;return function(){if(++i>1)return i=0,void console.warn("<mask:bind:expression> Concurent binder detected",e);var l=U(e,t,n,r);if(arguments.length>1){var s=T.call(arguments);s[0]=l,o.apply(this,s)}else o(l);i--}},B=function(e){var t=0;return function(){return++t>1?(t=0,void console.warn("<mask:listener:expression> concurent binder")):(e(),void t--)}}}();var V,K;!function(){V=function(e,t,n){for(var r,o,i,l,s=e.split(";"),u=[],a=0,c=s.length;c>a;a++)r=s[a].split(":"),1===r.length||2===r.length?(i=2==r.length?r[0]:n,o=r[2==r.length?1:0],l=K(o.trim(),i,t),null!=l&&u.push(l)):console.error('Too much ":" in a signal def.',s[a]);return u},K=function(e,t,n){if(n!==!0)return{signal:e,type:t};var r=e.indexOf(".");return-1===r?(console.error("No pipe name in a signal",e),null):{signal:e.substring(r+1),pipe:e.substring(0,r),type:t}}}();var G=function(){function t(e,t,n,r){null==r&&(r=":bind"===n.compoName?"single":"dual");var o,l=n.attr;if(this.node=n,this.controller=n,this.model=e,this.element=t,this.value=l.value,this.property=l.property,this.setter=l.setter,this.getter=l.getter,this.dismiss=0,this.bindingType=r,this.log=!1,this.signal_domChanged=null,this.signal_objectChanged=null,this.locked=!1,null==this.property&&null==this.getter)switch(t.tagName){case"INPUT":if(o=t.getAttribute("type"),"checkbox"===o){this.property="element.checked";
break}this.property="element.value";break;case"TEXTAREA":this.property="element.value";break;case"SELECT":this.domWay=i.SELECT;break;default:this.property="element.innerHTML"}if(l.log&&(this.log=!0,"log"!==l.log&&(this.logExpression=l.log)),l["x-signal"]){var s=V(l["x-signal"],null,"dom")[0],u=s&&s.type;switch(u){case"dom":case"object":this["signal_"+u+"Changed"]=s.signal;break;default:console.error("Signal typs is not supported",s)}}if(l["x-pipe-signal"]){var s=V(l["x-pipe-signal"],!0,"dom")[0],u=s&&s.type;switch(u){case"dom":case"object":this["pipe_"+u+"Changed"]=s;break;default:console.error("Pipe type is not supported")}}if(l["dom-slot"]){this.slots={};var a=n.parent,c=a.parent;a.parent=this,this.parent=c,this.slots[l["dom-slot"]]=function(e,t){this.domChanged(e,t)}}var f=l["object-pipe-slot"]||l["x-pipe-slot"];if(f){var h=f,d=h.indexOf("."),p=h.substring(0,d),s=h.substring(d+1);this.pipes={},this.pipes[p]={},this.pipes[p][s]=function(){this.objectChanged()},k.pipe.addController(this)}if(l.expression){if(this.expression=l.expression,null==this.value&&"single"!==r){var g=X(this.expression);"string"==typeof g?this.value=g:console.warn("Please set value attribute in DualBind Control.")}}else this.expression=this.value}function n(e){var t=e.expression,n=e.model,r=e.objectChanged=e.objectChanged.bind(e);if(e.binder=q(t,n,e.cntx,e.node,r),H(t,n,e.cntx,e.node,e.binder),"dual"===e.bindingType){var o=e.node.attr;if(!o["change-slot"]&&!o["change-pipe-event"]){var i=e.element,l=o["change-event"]||o.changeEvent||"change",s=e.domChanged.bind(e);O(i,l,s)}if(!e.objectWay.get(e,e.expression))return setTimeout(function(){e.domWay.get(e)&&e.domChanged()}),e}return e.objectChanged(),e}function r(e,t,n){var o=e.slots;(null==o||"function"!=typeof o[t]||o[t].apply(e,n)!==!1)&&null!=e.parent&&r(e.parent,t,n)}var o={};e.registerBinding=function(e,t){o[e]=t},e.BindingProvider=t,t.create=function(e,n,r,i){var l,s=r.attr.bindingProvider,u=null==s?null:o[s];return"function"==typeof u?new u(e,n,r,i):(l=new t(e,n,r,i),null!=u&&C(l,u),l)},t.bind=function(e){return n(e)},t.prototype={constructor:t,dispose:function(){z(this.expression,this.model,this.controller,this.binder)},objectChanged:function(e){if(!(this.dismiss-->0)){if(this.locked===!0)return void console.warn("Concurance change detected",this);if(this.locked=!0,null==e&&(e=this.objectWay.get(this,this.expression)),this.domWay.set(this,e),this.log&&console.log("[BindingProvider] objectChanged -",e),this.signal_objectChanged&&r(this.node,this.signal_objectChanged,[e]),this.pipe_objectChanged){var t=this.pipe_objectChanged;k.pipe(t.pipe).emit(t.signal)}this.locked=!1}},domChanged:function(e,t){if(this.locked===!0)return void console.warn("Concurance change detected",this);this.locked=!0;var n=t||this.domWay.get(this),o=!0;if(this.node.validations)for(var i,l=0,s=this.node.validations.length;s>l;l++)if(i=this.node.validations[l],i.validate(n,this.element,this.objectChanged.bind(this))===!1){o=!1;break}if(o&&(this.dismiss=1,this.objectWay.set(this.model,this.value,n),this.dismiss=0,this.log&&console.log("[BindingProvider] domChanged -",n),this.signal_domChanged&&r(this.node,this.signal_domChanged,[n]),this.pipe_domChanged)){var u=this.pipe_domChanged;k.pipe(u.pipe).emit(u.signal)}this.locked=!1},objectWay:{get:function(e,t){return U(t,e.model,e.cntx,e.controller)},set:function(e,t,n){v(e,t,n)}},domWay:{get:function(e){if(e.getter){var t=e.node.parent;return null==t||"function"!=typeof t[e.getter]?(console.error("Mask.bindings: Getter should be a function",e.getter,e),null):t[e.getter]()}return m(e,e.property)},set:function(e,t){if(e.setter){var n=e.node.parent;if(null==n||"function"!=typeof n[e.setter])return void console.error("Mask.bindings: Setter should be a function",e.setter,e);n[e.setter](t)}else v(e,e.property,t)}}};var i={SELECT:{get:function(e){var t=e.element;return-1===t.selectedIndex?"":t.options[t.selectedIndex].getAttribute("name")},set:function(e,t){for(var n,r=e.element,o=0,i=r.options.length;i>o;o++)if(n=r.options[o],n.getAttribute("name")==t)return void(r.selectedIndex=o)}}};return C(t,{addObserver:y,removeObserver:_}),t}();S(":visible",h),h.prototype={constructor:h,refresh:function(e,t){t.style.display=U(this.attr.check,e)?"":"none"},renderStart:function(e,t,n){this.refresh(e,n),this.attr.bind&&y(e,this.attr.bind,this.refresh.bind(this,e,n))}},function(){function e(){}S(":bind",e),e.prototype={constructor:e,renderStart:function(e,t,n){this.provider=G.create(e,n,this,"single"),this.provider.objectChanged()}}}(),S(":dualbind",d),d.prototype={constructor:d,renderStart:function(e,t,n,r){this.provider=G.create(t,r,this),this.provider.objectChanged()},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()},handlers:{attr:{"x-signal":function(){}}}},function(){function n(){}function r(e,t){this.fn=e,this.message=t}function o(e,t,n){console.warn("Validate Notification:",e,t);var r=N(e).next("."+l);return 0===r.length&&(r=N("<div>").addClass(l).html("<span></span><button>cancel</button>").insertAfter(e)),r.children("button").off().on("click",function(){r.hide(),n&&n()}).end().children("span").text(t).end().show()}function i(e){return N(e).next("."+l).hide()}var l="-validate-invalid";e.registerValidator=function(e,t){s[e]=t},S(":validate",n),n.prototype={constructor:n,attr:{},renderStart:function(e,t,o){if(this.element=o,this.attr.value){var i=n.resolveFromModel(e,this.attr.value);i&&(this.validators=[new r(i)])}},validate:function(e,t,n){null==t&&(t=this.element),this.attr&&(null==e&&this.attr.getter&&(e=m({node:this,element:t},this.attr.getter)),null==e&&this.attr.value&&(e=m(this.model,this.attr.value))),null==this.validators&&this.initValidators();for(var r,o=0,i=this.validators.length;i>o;o++)if(r=this.validators[o].validate(e),r&&!this.attr.silent)return this.notifyInvalid(t,r,n),!1;return this.makeValid(t),!0},notifyInvalid:function(e,t,n){return o(e,t,n)},makeValid:function(e){return i(e)},initValidators:function(){this.validators=[];for(var e in this.attr){switch(e){case"message":case"value":case"getter":continue}if(e in s!=!1){var t=s[e];this.validators.push(new r(t(this.attr[e],this),this.attr.message))}else console.error("Unknown Validator:",e,this)}}},n.resolveFromModel=function(e,t){return m(e.Validate,t)},n.createCustom=function(e,t){var o=new n;return o.element=e,o.validators=[new r(t)],o},r.prototype.validate=function(e){var t=this.fn(e);return t===!1?this.message||"Invalid - "+e:t},S(":validate:message",t({template:"div."+l+' { span > "~[bind:message]" button > "~[cancel]" }',onRenderStart:function(e){"string"==typeof e&&(e={message:e}),e.cancel||(e.cancel="cancel"),this.model=e},compos:{button:"$: button"},show:function(e,t){var n=this;this.model.message=e,this.compos.button.off().on(function(){n.hide(),t&&t()}),this.$.show()},hide:function(){this.$.hide()}}));var s={match:function(e){return function(t){return new RegExp(e).test(t)}},unmatch:function(e){return function(t){return!new RegExp(e).test(t)}},minLength:function(e){return function(t){return t.length>=parseInt(e,10)}},maxLength:function(e){return function(t){return t.length<=parseInt(e,10)}},check:function(e,t){return function(n){return U("x"+e,t.model,{x:n},t)}}}}(),S(":validate:group",p),p.prototype={constructor:p,validate:function(){for(var e,t=g(this),n=0,r=t.length;r>n;n++)if(e=t[n],!e.validate())return!1;return!0}},function(){function e(e,t,n){return e?null==t||""===t?e+" "+n:e.replace(t,n):n}function t(t,n,r,o,i){return function(n){switch(t){case"node":r.textContent=n;break;case"attr":var l,s,u=typeof r[i];if("boolean"===u)return void(o=r[i]=!!n);if("string"===u)return void(o=r[i]=e(r[i],o,n));l=r.getAttribute(i),s=e(l,o,n),r.setAttribute(i,s),o=n}}}function n(e,n,r,o,i,l,s,u){var a=t(u,n,i,e,s),c=q(n,r,o,l,a);H(n,r,o,l,c),f(l,function(){z(n,r,l,c)})}E("bind",{mode:"partial",current:null,element:null,nodeRenderStart:function(e,t,n,r,o){var i=U(e,t,n,o);return this.element=document.createTextNode(i),this.current=i},node:function(e,t,r,o,i){return n(this.current,e,t,r,this.element,i,null,"node"),this.element},attrRenderStart:function(e,t,n,r,o){return this.current=U(e,t,n,o)},attr:function(e,t,r,o,i,l){return n(this.current,e,t,r,o,i,l,"attr"),this.current}})}(),A("xx-visible",function(e,t,n,r,o,i){var l=q(t,n,r,i,function(e){o.style.display=e?"":"none"});H(t,n,r,i,l),f(i,function(){z(t,n,i,l)}),U(t,n,r,i)||(o.style.display="none")}),A("x-toggle","client",function(e,t,n,r,o,i){var l=t.substring(0,t.indexOf(":")),s=t.substring(l.length+1),u=X(s);"string"!=typeof u&&(u=u[0]),O(o,l,function(){var e=U(s,n,r,i);v(n,u,e)})}),A("x-class-toggle","client",function(e,t,n,r,o){var i=t.substring(0,t.indexOf(":")),l=t.substring(i.length+1).trim();O(o,i,function(){N(o).toggleClass(l)})}),function(e){function n(){this.attr={"debugger":null,use:null,log:null,"if":null,each:null,visible:null}}e.registerHandler("%%",n);var r=function(){var e={refresh:function(e){this.model=e,this.elements&&(o(this.elements),this.elements=[]),null!=k&&k.dispose(this),l(u(this,this.nodes,this.model,this.cntx),this.placeholder)},dispose:function(){z(this.expr,this.originalModel,this,this.binder)}};return function(t,n,r,o){var i=t.attr.use;C(t,{expr:i,placeholder:document.createComment(""),binder:q(i,n,r,t,e.refresh.bind(t)),originalModel:n,model:U(i,n,r,t),dispose:e.dispose}),H(i,n,r,t,t.binder),o.appendChild(t.placeholder)}}(),i=function(){return function(e,t,n){function r(e){console.log("Logger > Key: %s, Value: %s",o,e)}var o=e.attr.log,i=q(o,t,n,e,r),l=U(o,t,n,e);H(o,t,n,e,i),f(e,function(){z(o,t,e,i)}),r(l)}}(),h=function(){function e(e,t){return function(){return e.apply(t,arguments)}}var t={refresh:function(e){(null!=this.elements||e)&&(null==this.elements?(l(u(this,this.template,this.model,this.cntx),this.placeholder),this.$=N(this.elements)):(null==this.$&&(this.$=N(this.elements)),this.$[e?"show":"hide"]()),this.onchange&&this.onchange(e))},dispose:function(){z(this.expr,this.model,this,this.binder),this.onchange=null,this.elements=null}};return function(n,r,o,i){var l=n.attr["if"];C(n,{expr:l,template:n.nodes,placeholder:document.createComment(""),binder:q(l,r,o,n,e(t.refresh,n)),state:!!U(l,r,o,n)}),n.state||(n.nodes=null),H(l,r,o,n,n.binder),i.appendChild(n.placeholder)}}(),d=function(){var e={refresh:function(e){if(null!=this.elements||!e){if(null==this.elements)return l(u(this,this.template,this.model,this.cntx)),void(this.$=N(this.elements));null==this.$&&(this.$=N(this.elements)),this.$[e?"hide":"show"]()}}};return function(t,n,r,o){var i=t.parent.components,l=i&&i[i.length-1];return t.template=t.nodes,t.placeholder=document.createComment(""),null==l||"%%"!==l.compoName||null==l.attr["if"]?void console.error('Mask.Binding: Binded ELSE should be after binded IF - %% if="expression" { ...'):(l.onchange=e.refresh.bind(t),l.state&&(t.nodes=null),void o.appendChild(t.placeholder))}}(),p=function(){function n(e,t){var n=[];if(null==t||"object"!=typeof t||null==t.length)return n;for(var r,o=0,i=t.length;i>o;o++){switch(r=t[o],typeof r){case"string":case"number":case"boolean":r=t[o]=Object(r)}n[o]=new h(e.template,r,e)}return n}function r(e,t){for(var n=e.components,r=0,o=n.length,i=0,s=null,u=null,a=null,c=document.createDocumentFragment(),f=[];o>r;r++)if(a=n[r],null!=a.elements&&0!==a.elements.length)for(i=0,s=a.elements.length;s>i;i++)u=a.elements[i],u.parentNode.removeChild(u);e:for(i=0,s=t.length;s>i;i++){for(r=0;o>r;r++)if(t[i]===n[r].model){f[i]=n[r];continue e}console.warn("No Model Found for",t[i])}for(r=0,o=f.length;o>r;r++)if(a=f[r],null!=a.elements&&0!==a.elements.length)for(i=0,s=a.elements.length;s>i;i++)u=a.elements[i],c.appendChild(u);e.components=f,l(c,e.placeholder)}function o(e,t,r,o,i){if(null!=t&&null!=r){var l=t,h=t+r;for(h>e.components.length&&(h=e.components.length);h>l;l++)a(e.components[l],e)&&(l--,h--)}if(null!=o&&i&&i.length){var d=new f,p=n(e,i),g=u(d,p),m=d.components;s(e,o,g),c(d),null==e.components&&(e.components=[]),e.components.splice.apply(e.components,[o,0].concat(m))}}function i(e,t){for(var n,r=e.components,o=r.length;--o>-1;)n=r[o],-1!==t.indexOf(n.model)&&a(n,e)}var f=e.Dom.Component,h=function(){function e(e,t,n){this.nodes=e,this.model=t,this.parent=n}var t=f.prototype;e.prototype={compoName:"%%.each.item",constructor:d,renderEnd:function(e){this.elements=e}};for(var n in t)e.prototype[n]=t[n];return e}(),d={append:function(t){var n=new h(this.template,t,this);e.render(n,t,null,this.container,this)}},p={refresh:function(e,t,s,f){var h,d,p=0;if(null==t){if(null!=this.components)for(p=0,d=this.components.length;d>p;p++)h=this.components[p],a(h,this)&&(p--,d--);return this.components=[],this.nodes=n(this,e),l(u(this,this.nodes),this.placeholder),void M(this.components,c)}for(d=e.length;d>p;p++)switch(h=e[p],typeof h){case"string":case"number":case"boolean":e[p]=Object(h)}switch(t){case"push":o(this,null,null,e.length,e.slice(e.length-1));break;case"pop":o(this,e.length,1);break;case"unshift":o(this,null,null,0,e.slice(0,1));break;case"shift":o(this,0,1);break;case"splice":var g=s[0],m=1===s.length?this.components.length:s[1],v=s.length>2?e.slice(s[0],s.length-2+s[0]):null;o(this,g,m,g,v);break;case"sort":case"reverse":r(this,e);break;case"remove":null!=f&&f.length&&i(this,f)}},dispose:function(){z(this.expr,this.model,this,this.refresh)}};return function(e,r,o,i){null==e.nodes&&"undefined"!=typeof t&&t.ensureTemplate(e);var l=e.attr.each||e.attr.foreach,s=U(l,r,o,e);C(e,{expr:l,binder:q(l,r,o,e,p.refresh.bind(e)),template:e.nodes,container:i,placeholder:document.createComment(""),dispose:p.dispose}),i.appendChild(e.placeholder),H(e.expr,r,o,e,e.binder);for(var u in d)e[u]=d[u];e.nodes=n(e,s)}}(),g=function(){var e={refresh:function(){if(this.refreshing!==!0){this.refreshing=!0;for(var e=U(this.expr,this.model,this.cntx,this),t=0,n=this.elements.length;n>t;t++)this.elements[t].style.display=e?"":"none";this.refreshing=!1}},dispose:function(){z(this.expr,this.model,this,this.binder)}};return function(t,n,r){var o=t.attr.visible;C(t,{expr:o,binder:q(o,n,r,t,e.refresh.bind(t)),dispose:e.dispose}),H(o,n,r,t,t.binder),e.refresh.call(t)}}();n.prototype={constructor:n,elements:null,renderStart:function(e,t,n){var o=this.attr;if(null==o["debugger"])return null!=o.use?void r(this,e,t,n):null!=o.log?void i(this,e,t,n):(this.model=e,null!=o["if"]?void h(this,e,t,n):null!=o["else"]?void d(this,e,t,n):void((null!=o.each||null!=o.foreach)&&p(this,e,t,n)))},render:null,renderEnd:function(e){this.elements=e,null!=this.attr.visible&&g(this,this.model,this.cntx)}}}(e),function(){var r,i,u,f,h,d=e.getStatement();!function(){r=function(e,t,n,r,o){return d[e].getNodes(t,n,r,o)},i=function(e,t,n,r,o,i){if(null==e)return null;var l=[];return builder_build(e,t,n,r,o,l),null==i?l:(arr_pushMany(i,l),l)},u=function(e,t){e.placeholder=document.createComment(""),t.appendChild(e.placeholder)},f=function(e,t,r,o,i,l){e.parent=l,e.model=r,e.refresh=n(e.refresh,e),e.binder=q(e.expr,r,o,l,e.refresh),H(e.expr,r,o,l,e.binder)},h=function(e,t){if(null!=e)for(var n,r="function"==typeof e.splice,o=r?e.length:1,i=-1;++i<o;)n=r?e[i]:e,n.style.display=t?"":"none"}}(),function(){function t(){}function o(e,t,r,o,i,l,s,u){for(e.model=i,e.ctx=l,e.controller=u,e.refresh=n(e.refresh,e),e.binder=B(e.refresh),e.index=r,e.Switch=[{node:t,elements:null}],H(t.expression,i,l,u,e.binder);;){if(t=t.nextSibling,null==t||"else"!==t.tagName)break;e.Switch.push({node:t,elements:null}),t.expression&&H(t.expression,i,l,u,e.binder)}null!=r&&(e.Switch[r].elements=o)}e.registerHandler("+if",{$meta:{serializeNodes:!0},render:function(e,t,n,o,l){for(var s=this,u=r("if",s,e,t,o),a=0,c=s;;){if(c.nodes===u)break;if(a++,c=s.nextSibling,null==c||"else"!==c.tagName){a=null;break}}return this.attr["switch-index"]=a,i(u,e,t,n,o,l)},renderEnd:function(e,n,r,i,l){var s=new t,u=this.attr["switch-index"];return s.placeholder=document.createComment(""),i.appendChild(s.placeholder),o(s,this,u,e,n,r,i,l),s},serializeNodes:function(t){for(var n=[t];;){if(t=t.nextSibling,null==t||"else"!==t.tagName)break;n.push(t)}return e.stringify(n)}}),t.prototype={compoName:"+if",ctx:null,model:null,controller:null,index:null,Switch:null,binder:null,refresh:function(){for(var t,n=this,r=n.Switch,o=r.length,i=-1,s=n.index,u=n.model,a=n.ctx,c=n.controller;++i<o&&(t=r[i].node.expression,null!=t)&&!U(t,u,a,c););if(s!==i){if(null!=s&&h(r[s].elements,!1),i===o)return void(n.index=null);this.index=i;var f=r[i];if(null!=f.elements)return void h(f.elements,!0);var d=e.render(f.node.nodes,u,a,null,c),p=d.nodeType===Node.DOCUMENT_FRAGMENT_NODE?T.call(d.childNodes):d;l(d,n.placeholder),f.elements=p}},dispose:function(){for(var e,t,n=this.Switch,r=n.length,o=-1;++o<r;)e=n[o],t=e.node.expression,t&&z(t,this.model,this.controller,this.binder),e.node=null,e.elements=null;this.controller=null,this.model=null,this.ctx=null}}}(),function(){function t(){}function r(e,t,n,r,o){if(s=c.getNodes(e,t,n,r,o),a=null,null!=s){for(var i=t.length,l=-1;++l<i&&t[l].nodes!==s;);a=l===i?null:l}}function o(e,t,r,o,i,l,s,u){e.ctx=l,e.expr=t.expression,e.model=i,e.controller=u,e.index=r,e.nodes=t.nodes,e.refresh=n(e.refresh,e),e.binder=q(e.expr,i,l,u,e.refresh),e.Switch=new Array(t.nodes.length),null!=r&&(e.Switch[r]=o),H(t.expression,i,l,u,e.binder)}var s,a,c=d["switch"],f="switch-index";e.registerHandler("+switch",{$meta:{serializeNodes:!0},serializeNodes:function(t){return e.stringify(t)},render:function(e,t,n,o,l){var u=U(this.expression,e,t,o);return r(u,this.nodes,e,t,o),null==s?null:(this.attr[f]=a,i(s,e,t,n,o,l))},renderEnd:function(e,n,r,i,l){var s=new t,a=this.attr[f];return u(s,i),o(s,this,a,e,n,r,i,l),s}}),t.prototype={compoName:"+switch",ctx:null,model:null,controller:null,index:null,nodes:null,Switch:null,binder:null,refresh:function(t){var n=this,o=n.Switch,i=(o.length,n.index),u=n.model,c=n.ctx,f=n.controller;if(r(t,n.nodes,u,c,f),a!==i){if(null!=i&&h(o[i],!1),null==a)return void(n.index=null);this.index=a;var d=o[a];if(null!=d)return void h(d,!0);var p=e.render(s,u,c,null,f),g=p.nodeType===Node.DOCUMENT_FRAGMENT_NODE?T.call(p.childNodes):p;l(p,n.placeholder),o[a]=g}},dispose:function(){z(this.expr,this.model,this.controller,this.binder),this.controller=null,this.model=null,this.ctx=null;var e,t,n,r,o=this.Switch;for(e in o)if(t=o[e],null!=t)for(r=t.length,n=-1;++n<r;)null!=t[n].parentNode&&t[n].parentNode.removeChild(t[n])}}}(),function(){function r(e){this.expr=e.expression,this.nodes=e.nodes}function i(e,t,n,r,o){var i=[];return builder_build(e,t,n,r,o,i),i}d["with"];e.registerHandler("+with",{$meta:{serializeNodes:!0},render:function(e,t,n,r){var o=U(this.expression,e,t,r);return i(this.nodes,o,t,n,r)},renderEnd:function(e,t,o,i,l){var s=new r(this);return s.elements=e,s.model=t,s.parent=l,s.refresh=n(s.refresh,s),s.binder=q(s.expr,t,o,l,s.refresh),H(s.expr,t,o,l,s.binder),u(s,i),s}}),r.prototype={compoName:"+with",elements:null,binder:null,model:null,parent:null,refresh:function(e){if(o(this.elements),this.components){for(var n=this.components.length,r=-1;++r<n;)t.dispose(this.components[r]);this.components.length=0}var s=document.createDocumentFragment();this.elements=i(this.nodes,e,null,s,this),l(s,this.placeholder),c(this)},dispose:function(){z(this.expr,this.model,this.parent,this.binder),this.parent=null,this.model=null,this.ctx=null}}}(),function(){function t(e){for(var t,n=e.length,r=-1;++r<n;)switch(t=e[r],typeof t){case"string":case"number":case"boolean":e[r]=Object(t)}}function n(e,t){for(var n=e.node.components,r=0,o=n.length,i=0,s=null,u=null,a=null,c=document.createDocumentFragment(),f=[];o>r;r++)if(a=n[r],null!=a.elements&&0!==a.elements.length)for(i=0,s=a.elements.length;s>i;i++)u=a.elements[i],u.parentNode.removeChild(u);e:for(i=0,s=t.length;s>i;i++){for(r=0;o>r;r++)if(t[i]===e._getModel(n[r])){f[i]=n[r];continue e}console.warn("No Model Found for",t[i])}for(r=0,o=f.length;o>r;r++)if(a=f[r],null!=a.elements&&0!==a.elements.length)for(i=0,s=a.elements.length;s>i;i++)u=a.elements[i],c.appendChild(u);e.components=e.node.components=f,l(c,e.placeholder)}function r(e,t,n,r,o){var i=e.node,l=i.components;null==l&&(l=i.components=[]);var u=(e.prop1,e.prop2,e.type,e.ctx),c=e.node;if(null!=t&&null!=n){var f=t,h=t+n;for(h>l.length&&(h=l.length);h>f;f++)a(l[f],i)&&(f--,h--)}if(null!=r&&o&&o.length){var d,f=l.length,p=e._build(i,o,u,c),g=l.splice(f);for(s(i,r,p,e.placeholder),l.splice.apply(l,[r,0].concat(g)),f=0,d=g.length;d>f;f++)k.signal.emitIn(g[f],"domInsert")}}function o(e,t){for(var n,r=e.components,o=r.length;--o>-1;)n=r[o],-1!==t.indexOf(n.model)&&a(n,e.node)}var i={model:null,parent:null,refresh:function(e,i,s,u){var f,h=0,d=this.node,p=(this.model,this.ctx),g=this.node;if(null==i){var m=d.components;if(null!=m){for(var f=m.length,h=-1;++h<f;)a(m[h],d)&&(h--,f--);m.length=0}var v=this._build(d,e,p,g);return l(v,this.placeholder),void M(d.components,c)}var y=e;switch(t(e),i){case"push":r(this,null,null,y.length-1,y.slice(y.length-1));break;case"pop":r(this,y.length,1);break;case"unshift":r(this,null,null,0,y.slice(0,1));break;case"shift":r(this,0,1);break;case"splice":var b=s[0],_=1===s.length?this.components.length:s[1],x=s.length>2?y.slice(s[0],s.length-2+s[0]):null;r(this,b,_,b,x);break;case"sort":case"reverse":n(this,y);break;case"remove":null!=u&&u.length&&o(this,u)}},dispose:function(){z(this.expr,this.model,this.parent,this.binder)}};!function(){function n(e,t){this.prop1=t[o],this.prop2=t[l],this.type=t[s],this.expr=t[u],null==e.components&&(e.components=[]),this.node=e,this.components=e.components}var r=d["for"],o="for-prop-1",l="for-prop-2",s="for-type",u="for-expr";e.registerHandler("+for",{$meta:{serializeNodes:!0},serializeNodes:function(t){return e.stringify(t)},render:function(e,n,i,a,c){var f=r.parseFor(this.expression),h=this.attr;h[o]=f[0],h[l]=f[1],h[s]=f[2],h[u]=f[3];var d=U(f[3],e,n,a);null!=d&&(D(d)&&t(d),r.build(d,f,this.nodes,e,n,i,this,c))},renderEnd:function(e,t,r,o,i){var l=new n(this,this.attr);return l.placeholder=document.createComment(""),o.appendChild(l.placeholder),f(l,this,t,r,o,i),l},getHandler:function(e,t){return r.getHandler(e,t)}}),n.prototype={compoName:"+for",model:null,parent:null,refresh:i.refresh,dispose:i.dispose,_getModel:function(e){return e.scope[this.prop1]},_build:function(e,t,n,o){var i=r.getNodes(e.nodes,t,this.prop1,this.prop2,this.type);return builder_build(i,t,n,null,o)}}}(),function(){function n(e,t,n,r,i,l){for(var s,u=t.length,a=-1;++a<u;)s=o.createItem(a,e,i),builder_build(s,t[a],n,r,i,l)}function r(e){this.expr=e.expression,this.nodes=e.nodes,null==e.components&&(e.components=[]),this.node=e,this.components=e.components}var o=d.each;e.registerHandler("+each",{render:function(e,r,o,i,l){var s=this,u=U(s.expression,e,r,i);null!=u&&(t(u),n(s.nodes,u,r,o,s,l))},renderEnd:function(e,t,n,o,i){var l=new r(this,this.attr);return l.placeholder=document.createComment(""),o.appendChild(l.placeholder),f(l,this,t,n,o,i),l}}),r.prototype={compoName:"+each",refresh:i.refresh,dispose:i.dispose,_getModel:function(e){return e.model},_build:function(e,t,r,o){var i=document.createDocumentFragment();return n(e.nodes,t,r,i,o),i}}}()}()}()}(Mask,Compo),Mask.Compo=Compo,Mask.jmask=jmask,exports.mask=Mask}),function(e,t){"use strict";null==e&&(e="undefined"!=typeof window&&"undefined"!=typeof document?window:global),e.ruta=t(e)}(this,function(e){"use strict";function t(){return null==g&&(g=new v(y)),g}var n,r,o,i,l=e.mask||Mask,s=!0;!function(){function e(e){for(var t,n,r=e.trim().split(/\s+/),o=r.length,i=-1;++i<o;)if(n=r[i],0!==n.length&&(t=n[0],'"'===t||"'"===t))for(var l=i;o>i;i++)if(n=r[i],n[n.length-1]===t){var s=r.splice(l,i-l+1).join(" ").slice(1,-1);r.splice(l,0,s),o=r.length;break}return r}function t(e){for(var t,n,r,o=e.length,i=0,l={},s=[];o>i;i++)r=e[i],"-"!==r[0]?s.push(r):(t=r.replace(/^[\-]+/,""),o-1>i&&"-"!==e[i+1][0]?(n=e[i+1],i++):n=!0,l[t]=n);return{path:s,query:l}}n=function(e){for(var t=e.length,n=0,r=t-1;t>n&&"/"===e[n];n++);for(;r>n&&"/"===e[r];r--);return e.substring(n,r+1)},r=function(e){return e=n(e),""===e?[]:e.split("/")},o=function(e){return"/"+e.join("/")},i=function(n){"string"==typeof n&&(n=e(n));var r=t(n);return d(r)}}();var u,a;!function(){u=function(e,t){null==t&&(t="/");for(var n,r={},o=e.split(t),i=0,l=o.length;l>i;i++)n=o[i].split("="),r[n[0]]=null==n[1]?"":decodeURIComponent(n[1]);return r},a=function(e,t){null==t&&(t="/");var n,r="";for(n in e)r=(r?t:"")+n+"="+encodeURIComponent(e[n]);return r}}();var c,f,h;!function(){c=function(e,t){return new RegExp(e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),t)},f=function(e){if("^"===e[0])return new RegExp(e);for(var t=e.split("|"),n=0,r=t.length;r>n;n++)t[n]="^"+t[n]+"$";return new RegExp(t.join("|"))},h=function(e){var t=e.indexOf("("),n=e.lastIndexOf(")");if(-1===t||-1===n)return console.error("<ruta> Expected alias part with regexp",e),null;var r=e.substring(t+1,n);return{alias:e.substring(1,t),matcher:f(r)}}}();var d,p;!function(){d=function(e){var t=o(e.path);return null==e.query?t:t+"?"+a(e.query,"&")},p=function(e){var t=e.indexOf("?"),n=-1===t?e:e.substring(0,t);return{path:r(n),query:-1===t?null:u(e.substring(t+1),"&")}}}();var g,m=function(){function e(e,t){this.method=36===e.charCodeAt(0)?e.substring(1,e.indexOf(" ")).toUpperCase():null,null!=this.method&&(e=e.substring(this.method.length+2)),this.strict=s,this.value=t,this.definition=e,n(this,e)}function t(){this.routes=[]}var n,o;!function(){function e(e,t){for(var n in e)if(t.test(n))return e[n]}n=function(e,t){var n=t.charCodeAt(0);switch(n){case 33:e.strict=!0,t=t.substring(1);break;case 94:e.strict=!1,t=t.substring(1);break;case 40:var r=1,o=t.length-1;return 41!==t.charCodeAt(t.length-1)&&(console.error("<ruta> rgx parse - expect group closing"),o++),void(e.match=new RegExp(t.substring(r,o)))}var i,l,s,u,a,c,h=t.split("/"),d=0,p=h.length,g=h[p-1];l=g.indexOf("?"),l>(1===p?-1:0)&&(i=g.substring(l+1),h[p-1]=g.substring(0,l));for(var m,v,y,b=!0,_=e.path=[];p>d;d++)if(s=h[d],""!==s){u=s.charCodeAt(0),c=s.charCodeAt(1),m=63===u,v=58===(m?c:u),a=0,m&&a++,v&&a++,0!==a&&(s=s.substring(a)),!m&&!b&&console.log("<ruta> strict part found after optional",t),m&&(b=!1);var x=s.indexOf("(");if(v&&-1!==x){var o=s.length-1;")"!==s[o]&&(o+=1),y=new RegExp(f(s.substring(x+1,o))),s=s.substring(0,x)}m||v?v&&_.push({alias:s,matcher:y,optional:m}):_.push(s)}if(i){var w=e.query={};h=i.split("&"),d=-1,p=h.length;for(var C,j,N,k;++d<p;)N=h[d],k=N.indexOf("="),-1!==k?(C=N.substring(0,k),j=N.substring(k+1),40===j.charCodeAt(0)&&(j=new RegExp(f(j))),w[C]=j):w[N]="";0===e.path.length&&(e.strict=!1)}},o=function(t,n){var o=n.indexOf("?"),i=-1===o?null:n.substring(o+1),l={path:n,params:null==i?{}:u(i,"&")};if(t.query)for(var s in t.query)if("?"===s[0]&&(s=s.substring(1)),":"===s[0]){var a=h(s),c=a.alias;l.params[c]=e(l.params,a.matcher)}if(-1!==o&&(n=n.substring(0,o)),null!=t.path)for(var f,d,p=r(n),g=t.path,m=g.length,v=p.length,y=0;v>y;y++)if(f=p[y],d=m>y?g[y]:null){if("string"==typeof d)continue;if(d.alias){l.params[d.alias]=f;continue}}return l}}();var i,l;!function(){function e(e,t){for(var n in e)if(t.test(n))return!0;return!1}i=function(e,t,n){for(var r,i=p(e),s=0,u=t.length;u>s;s++)if(r=t[s],l(i,r,n))return r.current=o(r,e),r;return null},l=function(t,n,r){if(null!=r&&null!=n.method&&n.method!==r)return!1;if(n.match)return n.match.test("string"==typeof t?t:d(t));if("string"==typeof t&&(t=p(t)),n.query){var o,i,l=t.query;if(null==l)return!1;for(o in n.query){i=n.query[o];var s=o[0];if(":"!==s){if("?"!==s)if("string"!=typeof i){if(i.test&&!i.test(l[o]))return!1}else{if(null==l[o])return!1;if(i&&l[o]!==i)return!1}}else{var u=h(o);if(null==u||e(l,u.matcher)===!1)return!1}}}var a=n.path,c=a.length;if(0===c)return n.strict?0===t.path.length:!0;for(var f,g=0,m=t.path.length;m>g;g++){if(f=a[g],g>=c)return n.strict!==!0;if("string"==typeof f){if(t.path[g]===f)continue;return!1}if(f.matcher&&f.matcher.test(t.path[g])===!1)return!1;if(f.optional)return!0;if(!f.alias)return!1}return c>g?a[g].optional===!0:!0}}();return e.prototype={path:null,query:null,value:null,current:null},t.prototype={add:function(t,n){return this.routes.push(new e(t,n)),this},get:function(e,t){return i(e,this.routes,t)},clear:function(){return this.routes.length=0,this}},t.parse=function(e,t){var r={};return n(r,e),o(r,t)},t}(),v=function(){function e(e){if("undefined"==typeof window||"onhashchange"in window==!1)return null;var t=this;return t.listener=e,window.onhashchange=function(){t.changed(location.hash)},t}function t(e){if("undefined"==typeof window)return null;if(!window.history||!window.history.pushState)return null;var t=this;return t.listener=e,t.initial=location.pathname,window.onpopstate=function(){return t.initial===location.pathname?void(t.initial=null):void t.changed()},t}function n(n,r){if(this.collection=n||new m,r){var o="hash"===r?e:t;this.emitter=new o(this)}null==this.emitter&&(this.emitter=new t(this)),null==this.emitter&&(this.emitter=new e(this)),null==this.emitter&&console.error("Router can not be initialized - (nor History API / nor Hashchage")}return"undefined"==typeof window?function(){}:(function(){function t(e){return e.replace(/^[!#/]+/,"/")}e.prototype={navigate:function(e){return null==e?void this.changed(location.hash):void(location.hash=e)},changed:function(e){this.listener.changed(t(e))},current:function(){return t(location.hash)}}}(),function(){t.prototype={navigate:function(e){return null==e?void this.changed():(history.pushState({},null,e),void this.changed())},changed:function(){this.listener.changed(location.pathname+location.search)},current:function(){return location.pathname+location.search}}}(),n.prototype={changed:function(e){var t=this.collection.get(e);t&&this.action(t)},action:function(e){"function"==typeof e.value&&e.value(e)},navigate:function(e){this.emitter.navigate(e)},current:function(){var e=this.emitter.current();return this.collection.get(e)}},n)}(),y=new m,b={Collection:m,setRouterType:function(e){return null==g&&(g=new v(y,e)),this},setStrictBehaviour:function(e){s=e},add:function(e,n){return t(),y.add(e,n)},get:function(e){return y.get(e)},navigate:function(e){t().navigate(e)},current:function(){return t().current()},parse:m.parse,$utils:{pathFromCLI:i}};return function(){function e(e){e.preventDefault(),e.stopPropagation(),b.navigate(this.href)}l.registerAttrHandler("x-dynamic",function(t,n,r,o,i){i.onclick=e},"client")}(),b}),function(e){"use strict";function t(e,t){if("object"!=typeof e||null==t)return e;for(var n,r=e,o=t.split("."),i=o.length,l=0;i>l;l++)if(n=o[l],r=r[n],null==r)return r;return r}function n(e,t){for(var n in t)t[n]&&(e[n]=t[n]);return e}function r(e,n,r,o){if("function"==typeof n)return n(e)?e:null;if("undefined"==typeof r)return e==n?e:null;var i=null!=n?t(e,n):e,l=r,s=o;switch(l){case">":return i>s?e:null;case"<":return s>i?e:null;case">=":return i>=s?e:null;case"<=":return s>=i?e:null;case"!=":return i!=s?e:null;case"==":return i==s?e:null}return console.error("InvalidArgumentException: arr.js:check",arguments),null}function o(e){this.items=e}function i(e){o.prototype[e]=function(){var t=arguments.length,n=s[e](this.items,t>0?arguments[0]:null,t>1?arguments[1]:null,t>2?arguments[2]:null,t>3?arguments[3]:null);return n instanceof Array?(this.items=n,this):n}}var l=e.ruqq||(e.ruqq={}),s={where:function(e,t,n,o){var i=[];if(null==e)return i;for(var l,s=0,u=e.length;u>s;s++)l=e[s],null!=r(l,t,n,o)&&i.push(l);return i},each:"undefined"!=typeof Array.prototype.forEach?function(e,t){return null==e?e:(e.forEach(t),e)}:function(e,t){if(null==e)return e;for(var n=0,r=e.length;r>n;n++)t(e[n]);return e},remove:function(e,t,n,o){for(var i=0,l=e.length;l>i;i++)null!=r(e[i],t,n,o)&&(e.splice(i,1),i--,l--);return e},invoke:function(){for(var e=Array.prototype.slice.call(arguments),t=e.shift(),n=e.shift(),r=[],o=0;o<t.length;o++)r.push("function"==typeof t[o][n]?t[o][n].apply(t[o],e):null);return r},last:function(e,t,n,o){if(null==e)return null;
if(null==t)return e[e.length-1];for(var i=e.length;i>-1;--i)if(null!=r(e[i],t,n,o))return e[i];return null},first:function(e,t,n,o){if(null==t)return e[0];for(var i=0,l=e.length;l>i;i++)if(null!=r(e[i],t,n,o))return e[i];return null},any:function(e,t,n,o){for(var i=0,l=e.length;l>i;i++)if(null!=r(e[i],t,n,o))return!0;return!1},isIn:function(e,t){for(var n=0;n<e.length;n++)if(t==e[n])return!0;return!1},map:"undefined"!=typeof Array.prototype.map?function(e,t){return null==e?[]:e.map(t)}:function(e,t){var n=[];if(null==e)return n;for(var r=0,o=e.length;o>r;r++)n.push(t(e[r],r));return n},aggr:function(e,t,n){for(var r=0,o=e.length;o>r;r++){var i=n(e[r],t,r);null!=i&&(t=i)}return t},select:function(e,t){if(null==e)return[];for(var n,r=[],o=0,i=e.length;i>o;o++)if(n=e[o],"string"==typeof t)r.push(n[t]);else if("function"==typeof t)r.push(t(n));else if(t instanceof Array){for(var l={},s=0;s<t.length;s++)l[t[s]]=e[o][t[s]];r.push(l)}return r},indexOf:function(e,t,n,o){for(var i=0,l=e.length;l>i;i++)if(null!=r(e[i],t,n,o))return i;return-1},count:function(e,t,n,o){for(var i=0,l=0,s=e.length;s>l;l++)null!=r(e[l],t,n,o)&&i++;return i},distinct:function(e,t){var n=[];if(null==e)return n;for(var r=0,o=e.length;o>r;r++){for(var i=!0,l=0;l<n.length;l++)if(t&&t(e[r],n[l])||null==t&&e[r]==n[l]){i=!1;break}i&&n.push(e[r])}return n},groupBy:function(e,t){for(var n,r,o,i=[],l=e.length,s=-1,u={};++s<l;)if(u[s]!==!0){for(o=e[s],n=[o],r=s;++r<l;)u[r]!==!0&&t(o,e[r])&&(u[r]=!0,n.push(e[r]));i.push(n)}return i}};s.each(["min","max"],function(e){s[e]=function(n,r){if(null==n)return null;for(var o=null,i=0,l=n.length;l>i;i++){var s=t(n[i],r);null!=o?"max"===e&&s>o?o=s:"min"===e&&o>s&&(o=s):o=s}return o}}),l.arr=function(e){return new o(e)},n(l.arr,s);for(var u in s)i(u)}("undefined"!=typeof window?window:global),function(e,t){"use strict";null==e&&(e="undefined"!=typeof window&&"undefined"!=typeof document?window:global),null==e.net&&(e.net={}),e.net.Uri=t(e)}(this,function(){"use strict";function e(e){return e&&"object"==typeof e&&"function"==typeof e.combine}function t(){for(var e,t="",n=0,r=arguments.length;r>n;n++)e=arguments[n],e&&(t?("/"!==t[t.length-1]&&(t+="/"),t+="/"===e[0]?e.substring(1):e):t=e);return t}function n(e){return"/"===e[e.length-1]?e.substring(0,e.length-1):e}function r(e){var t,n=new p;for(t in e)"string"==typeof e[t]&&(n[t]=e[t]);return n}function o(e){return e.replace(/\\/g,"/").replace(/^\.\//,"").replace(/^(\w+):\/([^\/])/,"/$1:/$2")}function i(e){return d.test(e)&&"/"===e[0]?e.substring(1):e}function l(e){var t=c.exec(e.value);null==t&&"/"===e.value[0]&&(e.protocol="file"),null!=t&&(e.protocol=t[1],e.value=e.value.substring(t[0].length))}function s(e){if(null!=e.protocol){if("file"===e.protocol){var t=d.exec(e.value);return void(t&&(e.host=t[1],e.value=e.value.substring(e.host.length)))}var n=e.value.indexOf("/",2);e.host=~n?e.value.substring(0,n):e.value,e.value=e.value.replace(e.host,"")}}function u(e){var t=e.value.indexOf("?");-1!==t&&(e.search=e.value.substring(t),e.value=e.value.substring(0,t))}function a(e){var t=f.exec(e.value),r=null==t?null:t[1];null!=r&&(e.file=r,e.value=e.value.substring(0,e.value.length-r.length),e.value=n(e.value),t=h.exec(r),e.extension=null==t?null:t[1])}var c=/^([a-zA-Z]+):\/\//,f=/([^\/]+(\.[\w\d]+)?)$/i,h=/\.([\w\d]+)$/i,d=/(^\/?\w+:)\/[^\/]/,p=function(t){return null==t?this:e(t)?t.combine(""):(t=o(t),this.value=t,l(this),s(this),u(this),a(this),this.path=n(this.value),/^[\w]+:\//.test(this.path)&&(this.path="/"+this.path),this)};return p.prototype={cdUp:function(){return this.path?"/"===this.path?this:/^\/?[a-zA-Z]+:\/?$/.test(this.path)?this:(this.path=this.path.replace(/\/?[^\/]+\/?$/i,""),this):this},combine:function(o){if(e(o)&&(o=o.toString()),!o)return r(this);if(d.test(o))return new p(o);var i=r(this);if(i.value=o,u(i),a(i),!i.value)return i;if(o=i.value.replace(/^\.\//i,""),"/"===o[0])return i.path=o,i;for(;/^(\.\.\/?)/gi.test(o);)i.cdUp(),o=o.substring(3);return i.path=n(t(i.path,o)),i},toString:function(){var e=this.protocol?this.protocol+"://":"";return e+=t(this.host,this.path,this.file)+(this.search||""),this.file||this.search||(e+="/"),e},toPathAndQuery:function(){return t(this.path,this.file)+(this.search||"")},toRelativeString:function(e){if("string"==typeof e&&(e=new p(e)),0===this.path.indexOf(e.path)){var n=this.path?this.path.replace(e.path,""):"";return"/"===n[0]&&(n=n.substring(1)),t(n,this.file)+(this.search||"")}for(var r=this.path.split("/"),o=e.path.split("/"),i="",l=0,s=Math.min(r.length,o.length);s>l&&r[l]===o[l];l++);if(l>0&&(i=r.splice(0,l).join("/")),i){for(var u,a="",c=e.path;c;){if(0==this.path.indexOf(c)){u=this.path.replace(c,"");break}c=c.replace(/\/?[^\/]+\/?$/i,""),a+="../"}return t(a,u,this.file)}return this.toString()},toLocalFile:function(){var e=t(this.host,this.path,this.file);return i(e)},toLocalDir:function(){var e=t(this.host,this.path,"/");return i(e)},toDir:function(){var e=this.protocol?this.protocol+"://":"";return e+t(this.host,this.path,"/")},isRelative:function(){return!(this.protocol||this.host)},getName:function(){return this.file.replace("."+this.extension,"")}},p.combinePathes=t,p.combine=t,p}),function(){var e={};String.format=function(t){if(~t.indexOf("#{")){for(var n="",r=0,o=arguments[1];;){var i=t.indexOf("#{",r);if(-1==i)break;n+=t.substring(r,i);var l=t.indexOf("}",i);n+=Object.getProperty(o,t.substring(i+2,l)),r=++l}return n+=t.substring(r)}for(var s=1;s<arguments.length;s++){var u=e[s]||(e[s]=new RegExp("%"+s,"g"));t=t.replace(u,arguments[s])}return t},Object.defaults=function(e,t){for(var n in t)null==e[n]&&(e[n]=t[n]);return e},Object.clear=function(e,t){if(t instanceof Array)for(var n,r=0,o=t.length;o>r;r++)n=t[r],n in e&&delete e[n];else if("object"==typeof t)for(var i in t)i in e&&delete e[i];return e},Object.extend=function(e,t){if(null==e&&(e={}),null==t)return e;for(var n in t)null!=t[n]&&(e[n]=t[n]);return e},Object.getProperty=function(e,t){if("."===t)return e;for(var n=e,r="string"==typeof t?t.split("."):t,o=-1,i=r.length;null!=n&&++o<i;)n=n[r[o]];return n},Object.setProperty=function(e,t,n){for(var r=t.split("."),o=e,i=r[r.length-1];r.length>1;){var l=r.shift();o=o[l]||(o[l]={})}o[i]=n},Object.lazyProperty=function(e,t,n){if("object"!=typeof t){for(var r=t.split("."),o=e,i=r[r.length-1];r.length>1;){var l=r.shift();o=o[l]||(o[l]={})}r=null,o.__defineGetter__(i,function(){return delete o[i],o[i]=n(),n=null,o[i]})}else for(var s in t)Object.lazyProperty(e,s,t[s])},Object.clone=function(e){if(null==e)return null;switch(typeof e){case"number":case"string":case"function":return e}if(e instanceof Array){for(var t=[],n=0,r=e.length;r>n;n++)t[n]=Object.clone(e[n]);return t}var o=e.constructor;if("function"==typeof o&&(o===String||o===Number||o===RegExp||o===Date))return new o(e);var i={};for(var l in e)i[l]=Object.clone(e[l]);return i},Object.observe=function(e,t,n){if(null==e.__observers&&Object.defineProperty(e,"__observers",{value:{},enumerable:!1}),e.__observers[t])return void e.__observers[t].push(n);(e.__observers[t]||(e.__observers[t]=[])).push(n);var r=t.split("."),o=e,i=t;r.length>1&&(i=r.pop(),o=Object.getProperty(e,r));var l=o[i];Object.defineProperty(o,i,{get:function(){return l},set:function(n){l=n;for(var r=e.__observers[t],o=0,i=r.length;i>o;o++)r[o](n)}})},Date.format=function(e,t){function n(e){return e>9?e:"0"+e}t||(t="MM/dd/yyyy"),t=t.replace("MM",n(e.getMonth()+1));var r=e.getFullYear();return t.indexOf("yyyy")>-1?t=t.replace("yyyy",r):t.indexOf("yy")>-1&&(t=t.replace("yy",r.toString().substr(2,2))),t=t.replace("dd",n(e.getDate())),t.indexOf("HH")>-1&&(t=t.replace("HH",n(e.getHours()))),t.indexOf("mm")>-1&&(t=t.replace("mm",n(e.getMinutes()))),t.indexOf("ss")>-1&&(t=t.replace("ss",n(e.getSeconds()))),t},RegExp.fromString=function(e,t){return new RegExp(e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),t)},Function.invoke=function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),n=e.shift();return function(){return t[n].apply(t,e)}}}(),function(e){function t(){}function n(){}function r(e,t,n){if(e instanceof Array){for(var o,i=[],l=0,s=e.length;s>l;l++)o=r(e[l],t,n),e[l].tagName===u&&s-1>l&&e[l+1].tagName===a&&(l+=1,null==o&&(o=r(e[l].nodes,t,n))),null!=o&&(o instanceof Array?i=i.concat(o):i.push(o));return i}if(null!=e.content)return{content:e.content,type:e.type};if(e.tagName===u){var c=e.attr.id?t[e.attr.id]:n;return c?null==e.nodes?c:r(e.nodes,t,c):null}var f={tagName:e.tagName||e.compoName,attr:e.attr,type:e.type,controller:e.controller};return e.nodes&&(f.nodes=r(e.nodes,t,n)),f}function o(e,t){if(null==t&&(t={}),e instanceof Array){for(var n=e,r=0,l=n.length;l>r;r++)o(n[r],t);return t}var u=e.tagName;if(null!=u&&u===s){var a=e.attr.id;!a&&console.error("@content has no id specified",e),t[a]&&console.error("@content already exists",a),t[a]=i(e)}return null!=e.nodes&&o(e.nodes,t),t}function i(e){for(var t,n=e.parent;null!=n&&n.tagName!==c;){var r={type:n.type,tagName:n.tagName,attr:n.attr,controller:n.controller,nodes:null};null==t?(t=r,t.nodes=e.nodes):t.nodes=[r],n=n.parent}return null!=t?t:e.nodes}var l=e.mask||Mask,s="@content",u="@placeholder",a="@else",c="layout:view",f="layout:master",h={};t.prototype={constructor:t,render:function(){h[this.attr.id]=this}},l.registerHandler(f,t),n.prototype={constructor:n,renderStart:function(){var e=h[this.attr.master];return null==e?void console.error("Master Layout is not defined for",this):(null==this.contents&&(this.contents=o(this.nodes),Object.keys&&0===Object.keys(this.contents).length&&console.warn("no contents: @content #someID")),void(this.nodes=r(e,this.contents).nodes))}},l.registerHandler(c,n)}(this),globals.atma=this}).call({},"undefined"!=typeof global?global:window);