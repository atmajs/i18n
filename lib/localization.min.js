(function(n,r){"use strict";var e,t;"undefined"==typeof exports||n!==exports&&null!=n||(e=t=global),null==e&&(e="undefined"==typeof window?global:window),null==t&&(t=n||e),r(e,t)})(this,function(n,r){"use strict";function e(n,r,e){var t=r.exec(n);return t&&t[e]?t[e]:null}function t(){var r=e(n.location.search,/language=(\w+)/,1);return null==r&&(r=e(n.navigator.language,/^(\w+)/,1)),r=r.toLowerCase(),-1===m.indexOf(r)&&(r=m[0]),r}function o(n){var r=n.getHeader("Accept-Language");if(!r)return m[0];r=r.replace(/\s*/g,"");for(var e,t=r.split(","),o=0,u=t.length;u>o;o++)if(e=t[o].split(";")[0],-1!==m.indexOf(e))return e;return m[0]}function u(){return u=h(t()),u.apply(null,arguments)}function a(){return console.error('<localizer> In node env. please call $L.fromReq(req)("someKey")'),h(m[0])}function i(){return d.ajax(l()).done(function(n){for(var r in n.load)x[r]=n.load[r]})}function l(){if(g){var n=[];return m.forEach(function(r,e){n[e]=v.replace("%%",r)}),n}return[v.replace("%%",t())]}function f(n,r,e){return w(e.req,n,r)}function s(n,r){return w(n,r)}var c=n.atma||n;null==c.mask&&(c=require("atma-libs/exports"));var p=c.mask,d=c.include,g="undefined"==typeof document,m=["en"],v="/localization/%%.json",x={},b=d.params;b&&(b.path&&(v=b.path),b.support&&(m=b.support.split(","))),logger.log(b);var y;(function(){function n(n,e){for(var t,o=!0,u=0,a=n.length,i="";a>u;u++)o!==!0?(o=!0,t=n[u],i+="number"!=typeof t?r(e[t.index+1],t.spec):e[t+1]):(o=!1,i+=n[u]);return i}function r(){return console.error("<str: format-type> not implemented yet"),"<not implemented yet>"}var e;(function(){function n(n){var r,e,t=n.indexOf(":");return-1===t?r=parseInt(n,10):(r=parseInt(n.substring(0,t),10),e=n.substring(t+1)),isNaN(r)?(console.error("<str:format> argument index could not be parsed",n),-1):null==e?r:{index:r,spec:e}}var r={};e=function(e){if(r[e])return r[e];for(var t,o,u=0,a=0,i=[];t=e.indexOf("{",u),-1!==t;)if(!(t>0&&92===e.charCodeAt(t-1))){if(i[a++]=e.substring(u,t),u=t,o=e.indexOf("}",t),-1===o){console.error("<str:format> interpolation end quote not found",e);break}i[a++]=n(e.substring(u+1,o)),u=o+1}return i[a]=e.substring(u),i}})(),y=function(r,t){var o=e(r),u=arguments;return arguments.length>2?u=arguments:null!=t&&"object"!=typeof t&&(u=arguments),n(o,u)}})();var h=function(n){function r(r){var e=n[r];return null==e&&console.error("<localization> Translation is not defined for",r),function(n){if(null==e)return n;var r=e[n];return null==r?(console.error("<localization> No translation for",n),n):y(r,arguments)}}var e={};return function(n){return null==e[n]?e[n]=r(n):e[n]}}(x);a.fromReq=function(n){var r=n.lang||(n.lang=o(n));return h(r)};var w=g?a:u;p.registerUtil("L",g?f:s),i(),r.$L=w});