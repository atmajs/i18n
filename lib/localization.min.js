!function(n,r){"use strict";var t,e;"undefined"==typeof exports||n!==exports&&null!=n||(t=e=global),null==t&&(t="undefined"==typeof window?global:window),null==e&&(e=n||t),r(t,e)}(this,function(n,r){"use strict";function t(n,r,t){var e=r.exec(n);return e&&e[t]?e[t]:null}function e(){return e=b(g()),e.apply(null,arguments)}function o(){return console.error('<localizer> In node env. please call $L.fromReq(req)("someKey")'),b(L[0])}var a=Array.prototype.slice,i="undefined"==typeof document,u=n.atma||n;null==u.mask&&i&&(u=require("atma-libs/exports"));var l=u.mask,f=u.include,c=i?require("atma-formatter"):window.Formatter||l&&l.$utils.format;if(null==c)throw Error("atma-formatter is not preloaded.");var s,p,d;!function(){s=function(n,r){for(var t=r.split("."),e=t.length,o=-1;++o<e;){if(null==n)return null;n=n[t[o]]}return n},p=function(n,r,t){for(var e,o=r.split("."),a=o.length,i=-1;++i<a-1;)e=o[i],null==n[e]&&(n[e]={}),n=n[e];n[o[i]]=t},d=function(n,r){if(null==n&&(n={}),null==r)return n;var t,e;for(e in r)t=r[e],null!=t&&(n[e]=t);return n}}();var v;!function(){v=function(){var n=a.call(arguments);n.unshift("<i18n>"),console.log.apply(console,n)}}();var g,m;!function(){function r(n){return t(n,/language=(\w+)/,1)}g=function(){var e=r(n.location.search);return null==e&&(e=t(n.navigator.language,/^(\w+)/,1)),e=e.toLowerCase(),y(e)?e:L[0]},m=function(n){var t,e,o=n.url.indexOf("?");if(-1!==o){var a=n.url.substring(n.url);if(t=r(a),y(t))return t}if(e=n.getHeader("Accept-Language"),!e)return L[0];e=e.replace(/\s*/g,"").toLowerCase();for(var i,u,l=e.split(","),f=l.length,c=-1;++c<f;)if(u=l[c],i=u.indexOf(";"),t=-1===i?u:u.substring(0,i),y(t))return t;return L[0]}}();var h,y,w,x={},L=["en"];!function(n){y=function(n){return-1!==L.indexOf(n)},h=function(r,t){return null==n[r]?n[r]=t:d(n[r],t)},w=function(n){var r=f&&f.route&&f.route.params;if(null!=r){r.support&&(L=r.support.split(","));var t={supported:L};return r.path||r.directory?(t.path=r.path,t.directory=r.directory,void q.load(t,n)):void(n&&n())}}}(x);var q;!function(){var r={};r.file=function(n,r){function t(){if(i){var r=[];return L.forEach(function(t,e){r[e]=n.replace("%%",t)}),r}return[n.replace("%%",g())]}function e(n,r){var t=new XMLHttpRequest;t.onload=function(){var n;try{n=JSON.parse(t.responseText)}catch(e){v("Should be json",e)}finally{r(n)}},t.open("get",n,!0),t.send()}if(null==f&&i===!1){var o=g(),a=n.replace("%%",o);return void e(a,function(n){h(o,n),r()})}return f.ajax(t()).done(function(n){for(var t in n.ajax)h(t,n.ajax[t]);r&&r()})},r.directory=function(r,t){var e=n.io||n.atma&&u.io,o=e&&e.glob;if(null==o){try{e=require("atma-io")}catch(a){throw v("run `npm i atma-io -save`"),a}o=e.glob}var i=[];o.readFiles(r).forEach(function(n){var r=n.uri.getName(),t=n.read();if("string"==typeof t)try{t=JSON.parse(t)}catch(e){return void v("Failed to load translations",n.uri.toLocalFile())}h(r,t)}),0===i.length&&v("No translations",r),t()},q={load:function(n,t){if(n.support&&(L=n.support),n.path)return i===!1||-1!==n.path.indexOf("%%")?r.file(n.path,t):r.directory(n.path,t);if(n.mongo)throw Error("i18n Mongosource not implemented");return console.error("Unknown source",n),null},loadSingle:function(n,r,t){function e(){t(S.fromReq(n))}r.support&&(L=r.support);var o=m(n);return y(o)?void t(S.fromReq(n)):r.path?void this.load({path:r.path.replace("%%",o)},e):void console.error("<Single Load: implemented `config.path` only>")}}}();var b;!function(n){function r(r){var t=n[r];null==t&&console.error("<localization> Translation is not defined for",r);var e=function(n){var r,e=null==t?n:t[n];return null==e&&(console.error("<localization> No translation for",n),e=n),1===arguments.length?e:(r=a.call(arguments),r[0]=e,c.apply(null,r))};return e.lang=r,e}b=function(n){return null==t[n]?t[n]=r(n):t[n]};var t={}}(x),o.fromReq=function(n){if(n.$L)return n.$L;var r=m(n),t=b(r);return n.$L=t};var S=i?o:e;if(null!=l){var O,R;!function(){function n(n,t){return n.apply(null,r(t))}function r(n){var r=n[0].trim(),e=n[1],o=n[2],a=n[3];switch(r.charCodeAt(0)){case 34:case 39:return t(r,e,o,a)}var i=r.indexOf(",");return-1===i?[r]:(n=t(r.substring(i+1),e,o,a),n.unshift(r.substring(0,i)),n)}O=function(){return S.fromReq(ctx.req)(key,model)},R=function(){return n(S,arguments)};var t=l.Utils.Expression.evalStatements}(),l.registerUtil("L",i?O:R)}S.load=q.load,S.loadSingle=q.loadSingle,w(),r.$L=S});