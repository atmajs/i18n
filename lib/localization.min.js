!function(r,n){"use strict";var t,e;"undefined"==typeof exports||r!==exports&&null!=r||(t=e=global),null==t&&(t="undefined"==typeof window?global:window),null==e&&(e=r||t),n(t,e)}(this,function(r,n){"use strict";function t(r,n,t){var e=n.exec(r);return e&&e[t]?e[t]:null}function e(){return e=L(g()),e.apply(null,arguments)}function o(){return console.error('<localizer> In node env. please call $L.fromReq(req)("someKey")'),L(b[0])}var a=Array.prototype.slice,u="undefined"==typeof document,i=r.atma||r;null==i.mask&&u&&(i=require("atma-libs/exports"));var l=i.mask,c=i.include,f=u?require("atma-formatter"):window.Formatter||l&&l.$utils.format;if(null==f)throw Error("atma-formatter is not preloaded.");var s,p,d;!function(){s=function(r,n){for(var t=n.split("."),e=t.length,o=-1;++o<e;){if(null==r)return null;r=r[t[o]]}return r},p=function(r,n,t){for(var e,o=n.split("."),a=o.length,u=-1;++u<a-1;)e=o[u],null==r[e]&&(r[e]={}),r=r[e];r[o[u]]=t},d=function(r,n){if(null==r&&(r={}),null==n)return r;var t,e;for(e in n)t=n[e],null!=t&&(r[e]=t);return r}}();var v;!function(){v=function(){var r=a.call(arguments);r.unshift("<i18n>"),console.log.apply(console,r)}}();var g,m;!function(){function n(r){return t(r,/language=(\w+)/,1)}g=function(){var e=n(r.location.search);return null==e&&(e=t(r.navigator.language,/^(\w+)/,1)),e=e.toLowerCase(),y(e)?e:b[0]},m=function(r){var t,e,o=r.url.indexOf("?");if(-1!==o){var a=r.url.substring(r.url);if(t=n(a),y(t))return t}if(e=r.getHeader("Accept-Language"),!e)return b[0];e=e.replace(/\s*/g,"").toLowerCase();for(var u,i,l=e.split(","),c=l.length,f=-1;++f<c;)if(i=l[f],u=i.indexOf(";"),t=-1===u?i:i.substring(0,u),y(t))return t;return b[0]}}();var h,y,w,x={},b=["en"];!function(r){y=function(r){return-1!==b.indexOf(r)},h=function(n,t){return null==r[n]?r[n]=t:d(r[n],t)},w=function(r){var n=c&&c.route&&c.route.params;if(null!=n){n.support&&(b=n.support.split(","));var t={supported:b};return n.path||n.directory?(t.path=n.path,t.directory=n.directory,void q.load(t,r)):void(r&&r())}}}(x);var q;!function(){var n={};n.file=function(r,n){function t(){if(u){var n=[];return b.forEach(function(t,e){n[e]=r.replace("%%",t)}),n}return[r.replace("%%",g())]}function e(r,n){var t=new XMLHttpRequest;t.onload=function(){var r;try{r=JSON.parse(t.responseText)}catch(e){v("Should be json",e)}finally{n(r)}},t.open("get",r,!0),t.send()}if(null==c&&u===!1){var o=g(),a=r.replace("%%",o);return void e(a,function(r){h(o,r),n()})}return c.ajax(t()).done(function(r){for(var t in r.ajax)h(t,r.ajax[t]);n&&n()})},n.directory=function(n,t){var e=r.io||r.atma&&i.io,o=e&&e.glob;if(null==o){try{e=require("atma-io")}catch(a){throw v("run `npm i atma-io -save`"),a}o=e.glob}var u=[];o.readFiles(n).forEach(function(r){var n=r.uri.getName(),t=r.read();if("string"==typeof t)try{t=JSON.parse(t)}catch(e){return void v("Failed to load translations",r.uri.toLocalFile())}h(n,t)}),0===u.length&&v("No translations",n),t()},q={load:function(r,t){if(r.support&&(b=r.support),r.path)return u===!1||-1!==r.path.indexOf("%%")?n.file(r.path,t):n.directory(r.path,t);if(r.mongo)throw Error("i18n Mongosource not implemented");return console.error("Unknown source",r),null}}}();var L;!function(r){function n(n){var t=r[n];return null==t&&console.error("<localization> Translation is not defined for",n),function(r){var n,e=null==t?r:t[r];return null==e&&(console.error("<localization> No translation for",r),e=r),1===arguments.length?e:(n=a.call(arguments),n[0]=e,f.apply(null,n))}}L=function(r){return null==t[r]?t[r]=n(r):t[r]};var t={}}(x),o.fromReq=function(r){if(r.localizer)return r.localizer;var n=m(r),t=L(n);return r.localizer=t};var O=u?o:e;if(null!=l){var z,E;!function(){function r(r,t){return r.apply(null,n(t))}function n(r){var n=r[0].trim(),e=r[1],o=r[2],a=r[3];switch(n.charCodeAt(0)){case 34:case 39:return t(n,e,o,a)}var u=n.indexOf(",");return-1===u?[n]:(r=t(n.substring(u+1),e,o,a),r.unshift(n.substring(0,u)),r)}z=function(){return O.fromReq(ctx.req)(key,model)},E=function(){return r(O,arguments)};var t=l.Utils.Expression.evalStatements}(),l.registerUtil("L",u?z:E)}O.load=q.load,w(),n.$L=O});